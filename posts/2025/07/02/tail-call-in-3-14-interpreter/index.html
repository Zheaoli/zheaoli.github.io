<!DOCTYPE html><html lang=en data-theme=auto><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Python 3.14 的进一步性能进化: Tail Call Interpreter | Manjusaka</title><meta name=author content=Manjusaka><meta name=copyright content=Manjusaka><meta name=format-detection content="telephone=no"><meta name=theme-color content=ffffff><meta name=description content="最近做安全做的我头晕脑胀，来点轻松的换换脑子，让自己放松下 Python 3.14 正式引入了一个新的机制叫作 Tail Call Interpreter（Made by Ken Jin），这无疑又是一个奠定未来基础的重大工作"><meta property=og:type content=article><meta property=og:title content="Python 3.14 的进一步性能进化: Tail Call Interpreter"><meta property=og:url content=https://www.manjusaka.blog/posts/2025/07/02/tail-call-in-3-14-interpreter/index.html><meta property=og:site_name content=Manjusaka><meta property=og:description content="最近做安全做的我头晕脑胀，来点轻松的换换脑子，让自己放松下 Python 3.14 正式引入了一个新的机制叫作 Tail Call Interpreter（Made by Ken Jin），这无疑又是一个奠定未来基础的重大工作"><meta property=og:locale content=en_US><meta property=og:image content=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg><meta property=article:published_time content=2025-07-02T15:49:00.000Z><meta property=article:modified_time content=2025-08-10T20:52:26.906Z><meta property=article:author content=Manjusaka><meta property=article:tag content=编程><meta property=article:tag content=Linux><meta property=article:tag content=Python><meta property=article:tag content=笔记><meta property=article:tag content=水文><meta name=twitter:card content=summary><meta name=twitter:image content="https://avatars.githubusercontent.com/u/7054676?v=4"><meta name=twitter:creator content=@Manjusaka_Lee><meta name=twitter:site content=https://twitter.com/Manjusaka_Lee><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python 3.14 的进一步性能进化: Tail Call Interpreter",
  "url": "https://www.manjusaka.blog/posts/2025/07/02/tail-call-in-3-14-interpreter/",
  "image": "https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg",
  "datePublished": "2025-07-02T15:49:00.000Z",
  "dateModified": "2025-08-10T20:52:26.906Z",
  "author": [
    {
      "@type": "Person",
      "name": "Manjusaka",
      "url": "https://github.com/Zheaoli"
    }
  ]
}</script><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/7054676?v=4"><link rel=canonical href=https://www.manjusaka.blog/posts/2025/07/02/tail-call-in-3-14-interpreter/index.html><link rel=preconnect href=//cdn.jsdelivr.net><link rel=preconnect href=//www.google-analytics.com crossorigin=""><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css media=print onload='this.media="all"'><script>(()=>{let t={set:(e,t,a)=>{a&&(a=Date.now()+864e5*a,localStorage.setItem(e,JSON.stringify({value:t,expiry:a})))},get:e=>{var t=localStorage.getItem(e);if(t){var{value:t,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return t;localStorage.removeItem(e)}}},a=(window.btf={saveToLocal:t,getScript:(o,r={})=>new Promise((e,t)=>{let a=document.createElement("script");a.src=o,a.async=!0,Object.entries(r).forEach(([e,t])=>a.setAttribute(e,t)),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),getCSS:(o,r)=>new Promise((e,t)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,r&&(a.id=r),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),addGlobalFn:(e,t,a=!1,o=window)=>{var r;e.startsWith("pjax")||((r=o.globalFn||{})[e]=r[e]||{},r[e][a||Object.keys(r[e]).length]=t,o.globalFn=r)}},()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")}),o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};btf.activateDarkMode=a,btf.activateLightMode=o;var r=t.get("theme"),n=window.matchMedia("(prefers-color-scheme: dark)"),d=window.matchMedia("(prefers-color-scheme: light)"),d=(void 0===r?((!d.matches&&(n.matches||(d=(new Date).getHours())<=6||18<=d)?a:o)(),n.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?a:o)()})):("light"===r?o:a)(),t.get("aside-status"));void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async=async src="https://www.googletagmanager.com/gtag/js?id=UA-154407994-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-154407994-1"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","UA-154407994-1",{page_path:window.location.pathname})},"google_analytics")</script><script>let GLOBAL_CONFIG={root:"/",algolia:{appId:"DL1RURGHTB",indexName:"manjusaka.blog",hitsPerPage:6,languages:{input_placeholder:"Search",hits_empty:"No results found for: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!0,post:!0},runtime:"",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:{limitCount:100,languages:{author:"Author: Manjusaka",link:"Link: ",source:"Source: Manjusaka",info:"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},lightbox:"null",Snackbar:{chs_to_cht:"You have switched to Traditional Chinese",cht_to_chs:"You have switched to Simplified Chinese",day_to_night:"You have switched to Dark Mode",night_to_day:"You have switched to Light Mode",bgLight:"#59C173",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!0,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"Python 3.14 的进一步性能进化: Tail Call Interpreter",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/assets/font-awesome-animation.min.css media=defer onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/tag_plugins.css media=defer onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/assets/carousel-touch.js></script><meta name=generator content="Hexo 7.3.0"><link rel=alternate href=/atom.xml title=Manjusaka type=application/atom+xml></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>Loading...</div></div></div><script>(()=>{let e=document.getElementById("loading-box"),d=document.body;const o=()=>{d.style.overflow="",e.classList.add("loaded")},l=()=>{d.style.overflow="hidden",e.classList.remove("loaded")};l(),window.addEventListener("load",o)})()</script><div id=web_bg style="background-image:url('/url(https:/cdn.jsdelivr.net/gh/youngjuning/images@main/1680450445599.png)')"></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class="site-data text-center"><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>104</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>60</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>41</div></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div></div></div><div class="post type-tags" id=body-wrap><header class=post-bg id=page-header style=background-image:url(https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg)><nav id=nav><span id=blog-info><a class=nav-site-title href=/ ><img class=site-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4# image" alt=Logo><span class=site-name>Manjusaka</span></a><a class=nav-page-title href=/ ><span class=site-name>Python 3.14 的进一步性能进化: Tail Call Interpreter</span><span class=site-name><i class="fa-solid fa-circle-arrow-left"></i><span> Back to Home</span></span></a></span><div id=menus><div id=search-button><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div><div id=toggle-menu><span class=site-page><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id=post-info><h1 class=post-title>Python 3.14 的进一步性能进化: Tail Call Interpreter<a class=post-edit-link href=https://github.com/Zheaoli/Zheaoli.github.io/edit/main/source/_posts/tail-call-in-3-14-interpreter.md rel="external nofollow noreferrer" title=Edit target=_blank><i class="fas fa-pencil-alt"></i></a></h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class=post-meta-label>Created</span><time datetime=2025-07-02T15:49:00.000Z title="Created 2025-07-02 23:49:00">2025-07-02</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/ >编程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/Python/ >Python</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>Word Count:</span><span class=word-count>3.8k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>Reading Time:</span><span>18mins</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>Post Views:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class="container post-content" id=article-container><div id=post-outdate-notice data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-08-11 04:52:26&quot;}" hidden></div><p>最近做安全做的我头晕脑胀，来点轻松的换换脑子，让自己放松下</p><p>Python 3.14 正式引入了一个新的机制叫作 Tail Call Interpreter（Made by Ken Jin），这无疑又是一个奠定未来基础的重大工作</p><span id=more></span><h2 id=正文><a href=#正文 class=headerlink title=正文></a>正文</h2><p>在聊 Python 3.14 的 Tail Call Interpreter 之前，我们先要来聊 C 语言中最基本的语法 switch-case</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>switch</span> (x) &#123;</span><br><span class=line>    <span class=keyword>case</span> <span class=number>1</span>:</span><br><span class=line>        <span class=comment>// do something</span></span><br><span class=line>        <span class=keyword>break</span>;</span><br><span class=line>    <span class=keyword>case</span> <span class=number>2</span>:</span><br><span class=line>        <span class=comment>// do something else</span></span><br><span class=line>        <span class=keyword>break</span>;</span><br><span class=line>    <span class=keyword>default</span>:</span><br><span class=line>        <span class=comment>// do default thing</span></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>对于这样的代码我们最终的汇编会是什么样的呢？可能大家第一反应是先 cmp 然后 je ，不等式秒了，我们编译一个版本来看看</p><p>对于这样一段代码</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=type>void</span> <span class="title function_">small_switch</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(x) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>1</span>: <span class=built_in>printf</span>(<span class=string>&quot;One\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>2</span>: <span class=built_in>printf</span>(<span class=string>&quot;Two\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>3</span>: <span class=built_in>printf</span>(<span class=string>&quot;Three\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>最终汇编的产物会是这样的</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line>00000000000011f0 &lt;small_switch&gt;:</span><br><span class=line>    11f0:	83 ff 02             	cmp    $0x2,%edi</span><br><span class=line>    11f3:	74 2b                	je     1220 &lt;small_switch+0x30&gt;</span><br><span class=line>    11f5:	83 ff 03             	cmp    $0x3,%edi</span><br><span class=line>    11f8:	74 16                	je     1210 &lt;small_switch+0x20&gt;</span><br><span class=line>    11fa:	83 ff 01             	cmp    $0x1,%edi</span><br><span class=line>    11fd:	75 31                	jne    1230 &lt;small_switch+0x40&gt;</span><br><span class=line>    11ff:	48 8d 3d fe 0d 00 00 	lea    0xdfe(%rip),%rdi        # 2004 &lt;_IO_stdin_used+0x4&gt;</span><br><span class=line>    1206:	e9 25 fe ff ff       	jmp    1030 &lt;puts@plt&gt;</span><br><span class=line>    120b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class=line>    1210:	48 8d 3d f5 0d 00 00 	lea    0xdf5(%rip),%rdi        # 200c &lt;_IO_stdin_used+0xc&gt;</span><br><span class=line>    1217:	e9 14 fe ff ff       	jmp    1030 &lt;puts@plt&gt;</span><br><span class=line>    121c:	0f 1f 40 00          	nopl   0x0(%rax)</span><br><span class=line>    1220:	48 8d 3d e1 0d 00 00 	lea    0xde1(%rip),%rdi        # 2008 &lt;_IO_stdin_used+0x8&gt;</span><br><span class=line>    1227:	e9 04 fe ff ff       	jmp    1030 &lt;puts@plt&gt;</span><br><span class=line>    122c:	0f 1f 40 00          	nopl   0x0(%rax)</span><br><span class=line>    1230:	48 8d 3d db 0d 00 00 	lea    0xddb(%rip),%rdi        # 2012 &lt;_IO_stdin_used+0x12&gt;</span><br><span class=line>    1237:	e9 f4 fd ff ff       	jmp    1030 &lt;puts@plt&gt;</span><br><span class=line>    123c:	0f 1f 40 00          	nopl   0x0(%rax)</span><br></pre></td></tr></table></figure><p>我们能看到整体如我们所预期的一样，不断的 cmp 然后不断的 je，然后我们评估一下这里的复杂度呢？哦，时间复杂度 O(n) 秒了。</p><p>卧槽，那对于 Python 这样一个超大的 switch case 的结构，岂不是每次都是一个 O(n) ？这不得原地升天？</p><p>其实不是，通常来说，编译器会根据数据的类型和规模来用不同的方案处理 switch case 的结构</p><p>我们来准备几组例子</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br></pre></td><td class=code><pre><span class=line><span class=type>void</span> <span class="title function_">small_switch</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(x) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>1</span>: <span class=built_in>printf</span>(<span class=string>&quot;One\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>2</span>: <span class=built_in>printf</span>(<span class=string>&quot;Two\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>3</span>: <span class=built_in>printf</span>(<span class=string>&quot;Three\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">dense_switch</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(x) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>10</span>: <span class=built_in>printf</span>(<span class=string>&quot;Ten\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>11</span>: <span class=built_in>printf</span>(<span class=string>&quot;Eleven\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>12</span>: <span class=built_in>printf</span>(<span class=string>&quot;Twelve\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>13</span>: <span class=built_in>printf</span>(<span class=string>&quot;Thirteen\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>14</span>: <span class=built_in>printf</span>(<span class=string>&quot;Fourteen\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>15</span>: <span class=built_in>printf</span>(<span class=string>&quot;Fifteen\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>16</span>: <span class=built_in>printf</span>(<span class=string>&quot;Sixteen\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>17</span>: <span class=built_in>printf</span>(<span class=string>&quot;Seventeen\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">sparse_switch</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(x) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>1</span>: <span class=built_in>printf</span>(<span class=string>&quot;One\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>100</span>: <span class=built_in>printf</span>(<span class=string>&quot;Hundred\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>1000</span>: <span class=built_in>printf</span>(<span class=string>&quot;Thousand\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>10000</span>: <span class=built_in>printf</span>(<span class=string>&quot;Ten thousand\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">large_dense_switch</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(x) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>1</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 1\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>2</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 2\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>3</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 3\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>4</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 4\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>5</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 5\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>6</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 6\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>7</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 7\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>8</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 8\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>9</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 9\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>10</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 10\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>11</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 11\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>12</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 12\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>13</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 13\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>14</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 14\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>15</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 15\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>16</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 16\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>17</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 17\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>18</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 18\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>19</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 19\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>20</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 20\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">mixed_switch</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(x) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>1</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 1\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>2</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 2\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>3</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 3\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>case</span> <span class=number>50</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 50\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>case</span> <span class=number>100</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 100\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>101</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 101\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=number>102</span>: <span class=built_in>printf</span>(<span class=string>&quot;Case 102\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">char_switch</span><span class=params>(<span class=type>char</span> c)</span> &#123;</span><br><span class=line>    <span class=keyword>switch</span>(c) &#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>&#x27;a&#x27;</span>: <span class=built_in>printf</span>(<span class=string>&quot;Letter a\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>&#x27;b&#x27;</span>: <span class=built_in>printf</span>(<span class=string>&quot;Letter b\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>&#x27;c&#x27;</span>: <span class=built_in>printf</span>(<span class=string>&quot;Letter c\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>&#x27;d&#x27;</span>: <span class=built_in>printf</span>(<span class=string>&quot;Letter d\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>&#x27;e&#x27;</span>: <span class=built_in>printf</span>(<span class=string>&quot;Letter e\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>: <span class=built_in>printf</span>(<span class=string>&quot;Other char\n&quot;</span>); <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br></pre></td></tr></table></figure><p>然后我们反汇编以下，看下结果（这里我只把关键的部分贴出来）</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br></pre></td><td class=code><pre><span class=line>00000000000011f0 &lt;small_switch&gt;:</span><br><span class=line>    11f0:	83 ff 02             	cmp    $0x2,%edi      # 比较是否为2</span><br><span class=line>    11f3:	74 2b                	je     1220            # 跳转到case 2</span><br><span class=line>    11f5:	83 ff 03             	cmp    $0x3,%edi      # 比较是否为3</span><br><span class=line>    11f8:	74 16                	je     1210            # 跳转到case 3</span><br><span class=line>    11fa:	83 ff 01             	cmp    $0x1,%edi      # 比较是否为1</span><br><span class=line>    11fd:	75 31                	jne    1230            # 不是则跳转到default</span><br><span class=line></span><br><span class=line>0000000000001240 &lt;dense_switch&gt;:</span><br><span class=line>    1240:	83 ef 0a             	sub    $0xa,%edi      # 减去10 (最小case值)</span><br><span class=line>    1243:	83 ff 07             	cmp    $0x7,%edi      # 比较范围 (17-10=7)</span><br><span class=line>    1246:	0f 87 90 00 00 00    	ja     12dc           # 超出范围跳转default</span><br><span class=line>    124c:	48 8d 15 15 0f 00 00 	lea    0xf15(%rip),%rdx # 加载跳转表地址</span><br><span class=line>    1253:	48 63 04 ba          	movslq (%rdx,%rdi,4),%rax # 获取偏移量</span><br><span class=line>    1257:	48 01 d0             	add    %rdx,%rax      # 计算目标地址</span><br><span class=line>    125a:	ff e0                	jmp    *%rax          # 间接跳转</span><br><span class=line></span><br><span class=line>00000000000012f0 &lt;sparse_switch&gt;:</span><br><span class=line>    12f0:	81 ff e8 03 00 00    	cmp    $0x3e8,%edi    # 比较1000</span><br><span class=line>    12f6:	74 40                	je     1338           # 等于则跳转</span><br><span class=line>    12f8:	7f 16                	jg     1310           # 大于1000则继续检查</span><br><span class=line>    12fa:	83 ff 01             	cmp    $0x1,%edi      # 小于1000，检查1</span><br><span class=line>    12fd:	74 49                	je     1348           </span><br><span class=line>    12ff:	83 ff 64             	cmp    $0x64,%edi     # 检查100</span><br><span class=line>    1302:	75 24                	jne    1328           # 都不是则default</span><br><span class=line>    ...</span><br><span class=line>    1310:	81 ff 10 27 00 00    	cmp    $0x2710,%edi   # 检查10000</span><br><span class=line></span><br><span class=line>0000000000001360 &lt;large_dense_switch&gt;:</span><br><span class=line>    1360:	83 ff 14             	cmp    $0x14,%edi     # 检查是否≤20</span><br><span class=line>    1363:	0f 87 53 01 00 00    	ja     14bc           # 超出范围</span><br><span class=line>    1369:	48 8d 15 18 0e 00 00 	lea    0xe18(%rip),%rdx # 跳转表地址</span><br><span class=line>    1372:	48 63 04 ba          	movslq (%rdx,%rdi,4),%rax # 直接索引</span><br><span class=line>    1376:	48 01 d0             	add    %rdx,%rax</span><br><span class=line>    1379:	ff e0                	jmp    *%rax</span><br><span class=line></span><br><span class=line>00000000000014d0 &lt;mixed_switch&gt;:</span><br><span class=line>    14d0:	83 ff 32             	cmp    $0x32,%edi     # 比较50</span><br><span class=line>    14d3:	74 7b                	je     1550</span><br><span class=line>    14d5:	7f 29                	jg     1500           # &gt;50的情况</span><br><span class=line>    14d7:	83 ff 02             	cmp    $0x2,%edi      # ≤50，检查小值</span><br><span class=line>    14da:	74 64                	je     1540</span><br><span class=line>    14dc:	83 ff 03             	cmp    $0x3,%edi</span><br><span class=line>    ...</span><br><span class=line>    1500:	83 ff 65             	cmp    $0x65,%edi     # &gt;50，检查100,101,102</span><br><span class=line>    1503:	74 5b                	je     1560</span><br><span class=line></span><br><span class=line>0000000000001580 &lt;char_switch&gt;:</span><br><span class=line>    1580:	83 ef 61             	sub    $0x61,%edi     # 减去&#x27;a&#x27;的ASCII值</span><br><span class=line>    1583:	40 80 ff 04          	cmp    $0x4,%dil      # 检查是否≤4 (a-e)</span><br><span class=line>    1587:	77 63                	ja     15ec</span><br><span class=line>    1589:	48 8d 15 4c 0c 00 00 	lea    0xc4c(%rip),%rdx</span><br><span class=line>    1590:	40 0f b6 ff          	movzbl %dil,%edi      # 零扩展到32位</span><br><span class=line>    1594:	48 63 04 ba          	movslq (%rdx,%rdi,4),%rax</span><br><span class=line></span><br></pre></td></tr></table></figure><p>我们这里能看到编译器根据数据的不同类型来处理了 switch case 的结构，这里我用一个表格总结一下</p><div class=table-container><table><thead><tr><th>Switch类型</th><th>Case数量</th><th>分布特点</th><th>编译器策略</th><th>时间复杂度</th></tr></thead><tbody><tr><td>small_switch</td><td>3个</td><td>连续(1,2,3)</td><td>线性比较</td><td>O(n)</td></tr><tr><td>dense_switch</td><td>8个</td><td>连续(10-17)</td><td>偏移跳转表</td><td>O(1)</td></tr><tr><td>sparse_switch</td><td>4个</td><td>稀疏(1,100,1000,10000)</td><td>二分查找</td><td>O(log n)</td></tr><tr><td>large_dense_switch</td><td>20个</td><td>连续(1-20)</td><td>标准跳转表</td><td>O(1)</td></tr><tr><td>mixed_switch</td><td>7个</td><td>部分连续</td><td>嵌套比较</td><td>O(log n)</td></tr><tr><td>char_switch</td><td>5个</td><td>连续(‘a’-‘e’)</td><td>字符偏移表</td><td>O(1)</td></tr></tbody></table></div><p>OK，这里我们发现，Switch-case 最终的实现因为数据类型的不一样，会导致我们最终的代码存在一个不可预测性。那么我们有没有办法来优化这个问题呢？答案是有的。</p><p>我们来看下面一段代码</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">basic_computed_goto</span><span class=params>(<span class=type>int</span> operation)</span> &#123;</span><br><span class=line>    <span class=type>static</span> <span class=type>void</span>* jump_table[] = &#123;</span><br><span class=line>        &amp;&amp;op_add,   </span><br><span class=line>        &amp;&amp;op_sub,   </span><br><span class=line>        &amp;&amp;op_mul,   </span><br><span class=line>        &amp;&amp;op_div,   </span><br><span class=line>        &amp;&amp;op_mod,   </span><br><span class=line>        &amp;&amp;op_default</span><br><span class=line>    &#125;;</span><br><span class=line>    </span><br><span class=line>    <span class=type>int</span> a = <span class=number>10</span>, b = <span class=number>3</span>;</span><br><span class=line>    <span class=type>int</span> result;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>if</span> (operation &lt; <span class=number>0</span> || operation &gt; <span class=number>4</span>) &#123;</span><br><span class=line>        operation = <span class=number>5</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;Operation %d: a=%d, b=%d -&gt; &quot;</span>, operation, a, b);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>goto</span> *jump_table[operation];</span><br><span class=line>    </span><br><span class=line>op_add:</span><br><span class=line>    result = a + b;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;ADD: %d\n&quot;</span>, result);</span><br><span class=line>    <span class=keyword>return</span>;</span><br><span class=line>    </span><br><span class=line>op_sub:</span><br><span class=line>    result = a - b;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;SUB: %d\n&quot;</span>, result);</span><br><span class=line>    <span class=keyword>return</span>;</span><br><span class=line>    </span><br><span class=line>op_mul:</span><br><span class=line>    result = a * b;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;MUL: %d\n&quot;</span>, result);</span><br><span class=line>    <span class=keyword>return</span>;</span><br><span class=line>    </span><br><span class=line>op_div:</span><br><span class=line>    <span class=keyword>if</span> (b != <span class=number>0</span>) &#123;</span><br><span class=line>        result = a / b;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;DIV: %d\n&quot;</span>, result);</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;DIV: Error (division by zero)\n&quot;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span>;</span><br><span class=line>    </span><br><span class=line>op_mod:</span><br><span class=line>    <span class=keyword>if</span> (b != <span class=number>0</span>) &#123;</span><br><span class=line>        result = a % b;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;MOD: %d\n&quot;</span>, result);</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;MOD: Error (division by zero)\n&quot;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span>;</span><br><span class=line>    </span><br><span class=line>op_default:</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;Unknown operation\n&quot;</span>);</span><br><span class=line>    <span class=keyword>return</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>我们能看到这里核心的一个操作是将我们 Switch-cased 的每个 case 都变成了一个标签，然后我们通过一个 jump_table 来直接跳转到对应的标签上, 我们来看一下最关键位置的汇编</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>11d3:	48 8d 05 c6 2b 00 00 	lea    0x2bc6(%rip),%rax        # 3da0 &lt;jump_table.0&gt;</span><br><span class=line>11da:	ff 24 d8             	jmp    *(%rax,%rbx,8)</span><br></pre></td></tr></table></figure><p>这里我们可以总结出来使用 Computed Goto 相较于传统的 switch-case 有以下几点优势</p><ol><li>减少分支预测 fallback 的代价</li><li>指令缓存局部性上更优</li><li>减少了 cmp 指令的数量和开销</li></ol><p>那么具体能有多快呢？可以参见 CPython 引入的 Computed Goto 的一个测试结果，大概是整体提升了15% 左右</p><p>那么 Computed Goto 的方式就是完美的吗？其实也不是，目前 CPython 的解释器 ceval.c 也是目前最大的一个 switch case 中存在几个典型问题</p><ol><li>Computed Goto 作为 clang 和 gcc 特化的功能，那么其余平台受益的可能性较小</li><li>目前 Computed Goto 其实并不成熟，在同一个编译器不同的版本可能会有不同的问题</li><li>超大型的 switch case 会导致编译器对于 switch case 的优化不够好</li><li>我们无法使用 perf 精确的去对我们整个过程中 per opcode 的开销进行定量分析，这在于让 Python 变得更快的大背景下将会是一个很大的问题</li></ol><p>1，3，4 都很好理解，我们来看一下2的一个例子（感谢 Ken Jin 提供的例子）</p><p>在 GCC 11 的时候，switch-case 某个部分会正常的代码</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>738f: movq	%r13, %r15</span><br><span class=line>7392: movzbl	%ah, %ebx</span><br><span class=line>7395: movzbl	%al, %eax</span><br><span class=line>7398: movq	(,%rax,8), %rax</span><br><span class=line>73a0: movl	%ebx, -0x248(%rbp)</span><br><span class=line>73a6: jmpq	*%rax</span><br></pre></td></tr></table></figure><p>而在 GCC 13-15Beta 的时候，则会产生这样的代码</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line>747a: movzbl	%ah, %ebx</span><br><span class=line>747d: movzbl	%al, %eax</span><br><span class=line>7480: movl	%ebx, -0x248(%rbp)</span><br><span class=line>7486: movq	(,%rax,8), %rax</span><br><span class=line>748e: jmp	0x72a0 &lt;_PyEval_EvalFrameDefault+0x970&gt;</span><br><span class=line></span><br><span class=line>72a0: movq	%r15, %xmm0</span><br><span class=line>72a5: movq	%r13, %xmm3</span><br><span class=line>72aa: movq	%r15, %rbx</span><br><span class=line>72ad: punpcklqdq	%xmm3, %xmm0</span><br><span class=line>72b1: movhlps	%xmm0, %xmm2</span><br><span class=line>72b4: movq	%xmm2, %r10</span><br><span class=line>72b9: movq	%r10, %r11</span><br><span class=line>72bc: jmpq	*%rax</span><br></pre></td></tr></table></figure><p>我们能发现，额外的寄存器被引入了。体系结构 101，额外的寄存器意味着额外的开销。寄存器是很贵的！</p><p>那么我们有没有办法来迭代上面的超大的 Switch case 呢？估计有同学在想，既然上面的 switch case 超级大，那么我们将其拆分为多个小的函数<br>这样编译器可以有足够的上下文来优化，同时我们的 perf 也可以精确的去分析每个函数的开销，岂不美哉？</p><p>但是又有同学反对了，函数调用会触发 call 的指令，会带来额外的寄存器入栈和出栈的开销，这样会不会又变慢了呢？</p><p>那么能不能优化一下呢？答案是可以的，很多同学可能会想到了，tail call</p><p>假设我们有这样一段代码</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>__attribute__((noinline)) <span class=type>void</span> <span class="title function_">g</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;Value: %d\n&quot;</span>, x);</span><br><span class=line>&#125;;</span><br><span class=line><span class=type>void</span> <span class="title function_">f</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    <span class=keyword>return</span> g(x);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>我们能看到这样一段汇编</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br></pre></td><td class=code><pre><span class=line>0000000000001140 &lt;g&gt;:</span><br><span class=line>    1140:	55                   	push   %rbp</span><br><span class=line>    1141:	48 89 e5             	mov    %rsp,%rbp</span><br><span class=line>    1144:	48 83 ec 10          	sub    $0x10,%rsp</span><br><span class=line>    1148:	89 7d fc             	mov    %edi,-0x4(%rbp)</span><br><span class=line>    114b:	8b 75 fc             	mov    -0x4(%rbp),%esi</span><br><span class=line>    114e:	48 8d 3d af 0e 00 00 	lea    0xeaf(%rip),%rdi        # 2004 &lt;_IO_stdin_used+0x4&gt;</span><br><span class=line>    1155:	b0 00                	mov    $0x0,%al</span><br><span class=line>    1157:	e8 d4 fe ff ff       	call   1030 &lt;printf@plt&gt;</span><br><span class=line>    115c:	48 83 c4 10          	add    $0x10,%rsp</span><br><span class=line>    1160:	5d                   	pop    %rbp</span><br><span class=line>    1161:	c3                   	ret</span><br><span class=line>    1162:	66 66 66 66 66 2e 0f 	data16 data16 data16 data16 cs nopw 0x0(%rax,%rax,1)</span><br><span class=line>    1169:	1f 84 00 00 00 00 00 </span><br><span class=line></span><br><span class=line>0000000000001170 &lt;f&gt;:</span><br><span class=line>    1170:	55                   	push   %rbp</span><br><span class=line>    1171:	48 89 e5             	mov    %rsp,%rbp</span><br><span class=line>    1174:	48 83 ec 10          	sub    $0x10,%rsp</span><br><span class=line>    1178:	89 7d fc             	mov    %edi,-0x4(%rbp)</span><br><span class=line>    117b:	8b 7d fc             	mov    -0x4(%rbp),%edi</span><br><span class=line>    117e:	e8 bd ff ff ff       	call   1140 &lt;g&gt;</span><br><span class=line>    1183:	48 83 c4 10          	add    $0x10,%rsp</span><br><span class=line>    1187:	5d                   	pop    %rbp</span><br><span class=line>    1188:	c3                   	ret</span><br><span class=line>    1189:	0f 1f 80 00 00 00 00 	nopl   0x0(%rax)</span><br></pre></td></tr></table></figure><p>其中 <code>call 1140 &lt;g&gt;</code> 指令非常显眼。这也是函数调用本身的开销的一个重要来源</p><p>在现在编译器中，存在一种特殊的优化叫作尾递归，即当函数的最后一步是调用另一个函数时，编译器可以优化掉这个调用的开销</p><p>我们来测试一下</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line>__attribute__((preserve_none)) <span class=type>void</span> <span class="title function_">g</span><span class=params>(<span class=type>int</span> x)</span>;</span><br><span class=line>__attribute__((noinline, preserve_none)) <span class=type>void</span> <span class="title function_">g</span><span class=params>(<span class=type>int</span> x)</span>&#123;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;Value: %d\n&quot;</span>, x);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>__attribute__((preserve_none)) <span class=type>void</span> <span class="title function_">f</span><span class=params>(<span class=type>int</span> x)</span> &#123;</span><br><span class=line>    [[clang::musttail]] <span class=keyword>return</span> g(x);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span> &#123;</span><br><span class=line>    f(<span class=number>42</span>);</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>我们来看下相关汇编</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br></pre></td><td class=code><pre><span class=line>0000000000001140 &lt;g&gt;:</span><br><span class=line>    1140:	55                   	push   %rbp</span><br><span class=line>    1141:	48 89 e5             	mov    %rsp,%rbp</span><br><span class=line>    1144:	48 83 ec 10          	sub    $0x10,%rsp</span><br><span class=line>    1148:	44 89 65 fc          	mov    %r12d,-0x4(%rbp)</span><br><span class=line>    114c:	8b 75 fc             	mov    -0x4(%rbp),%esi</span><br><span class=line>    114f:	48 8d 3d ae 0e 00 00 	lea    0xeae(%rip),%rdi        # 2004 &lt;_IO_stdin_used+0x4&gt;</span><br><span class=line>    1156:	31 c0                	xor    %eax,%eax</span><br><span class=line>    1158:	e8 d3 fe ff ff       	call   1030 &lt;printf@plt&gt;</span><br><span class=line>    115d:	48 83 c4 10          	add    $0x10,%rsp</span><br><span class=line>    1161:	5d                   	pop    %rbp</span><br><span class=line>    1162:	c3                   	ret</span><br><span class=line>    1163:	66 66 66 66 2e 0f 1f 	data16 data16 data16 cs nopw 0x0(%rax,%rax,1)</span><br><span class=line>    116a:	84 00 00 00 00 00 </span><br><span class=line></span><br><span class=line>0000000000001170 &lt;f&gt;:</span><br><span class=line>    1170:	55                   	push   %rbp</span><br><span class=line>    1171:	48 89 e5             	mov    %rsp,%rbp</span><br><span class=line>    1174:	44 89 65 fc          	mov    %r12d,-0x4(%rbp)</span><br><span class=line>    1178:	44 8b 65 fc          	mov    -0x4(%rbp),%r12d</span><br><span class=line>    117c:	5d                   	pop    %rbp</span><br><span class=line>    117d:	e9 be ff ff ff       	jmp    1140 &lt;g&gt;</span><br><span class=line>    1182:	66 66 66 66 66 2e 0f 	data16 data16 data16 data16 cs nopw 0x0(%rax,%rax,1)</span><br><span class=line>    1189:	1f 84 00 00 00 00 00 </span><br></pre></td></tr></table></figure><p>我们能看到，<code>f</code> 函数的最后一步是 <code>jmp 1140 &lt;g&gt;</code>，而不是 <code>call 1140 &lt;g&gt;</code>，这就意味着我们在调用 <code>g</code> 函数的时候不会有额外的寄存器分配等传统 call 指令带来的开销。</p><p>可能有同学回过味来了，那么这里在做尾递归处理后，感觉完全可以当作一种高性能 Goto 来看嘛。</p><p>Bingo，这里其实思路也是差不多这样的，在77年的一篇论文《Debunking the ‘Expensive Procedure Call’ Myth, or, Procedure Call Implementations Considered Harmful, or, Lambda: The Ultimate GOTO》就提到了，高效的过程调用可以和 Goto 性能相近，而在实现上会更简洁。</p><p>在 Python 3.14 中，Tail Call Interpreter 的实现就是基于这个思路的。</p><p>我们能看到我们对于 opcode 进行 dispatch 的宏进行了尾递归的处理</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#   <span class=keyword>define</span> Py_MUSTTAIL [[clang::musttail]]</span></span><br><span class=line><span class=meta>#   <span class=keyword>define</span> Py_PRESERVE_NONE_CC __attribute__((preserve_none))</span></span><br><span class=line>    Py_PRESERVE_NONE_CC <span class=keyword>typedef</span> PyObject* (*py_tail_call_funcptr)(TAIL_CALL_PARAMS);</span><br><span class=line></span><br><span class=line><span class=meta>#   <span class=keyword>define</span> TARGET(op) Py_PRESERVE_NONE_CC PyObject *_TAIL_CALL_##op(TAIL_CALL_PARAMS)</span></span><br><span class=line><span class=meta>#   <span class=keyword>define</span> DISPATCH_GOTO() \</span></span><br><span class=line><span class=meta>        do &#123; \</span></span><br><span class=line><span class=meta>            Py_MUSTTAIL return (INSTRUCTION_TABLE[opcode])(TAIL_CALL_ARGS); \</span></span><br><span class=line><span class=meta>        &#125; while (0)</span></span><br><span class=line><span class=meta>#   <span class=keyword>define</span> JUMP_TO_LABEL(name) \</span></span><br><span class=line><span class=meta>        do &#123; \</span></span><br><span class=line><span class=meta>            Py_MUSTTAIL return (_TAIL_CALL_##name)(TAIL_CALL_ARGS); \</span></span><br><span class=line><span class=meta>        &#125; while (0)</span></span><br><span class=line><span class=meta>#   <span class=keyword>ifdef</span> Py_STATS</span></span><br><span class=line><span class=meta>#       <span class=keyword>define</span> JUMP_TO_PREDICTED(name) \</span></span><br><span class=line><span class=meta>            do &#123; \</span></span><br><span class=line><span class=meta>                Py_MUSTTAIL return (_TAIL_CALL_##name)(frame, stack_pointer, tstate, this_instr, oparg, lastopcode); \</span></span><br><span class=line><span class=meta>            &#125; while (0)</span></span><br><span class=line><span class=meta>#   <span class=keyword>else</span></span></span><br><span class=line><span class=meta>#       <span class=keyword>define</span> JUMP_TO_PREDICTED(name) \</span></span><br><span class=line><span class=meta>            do &#123; \</span></span><br><span class=line><span class=meta>                Py_MUSTTAIL return (_TAIL_CALL_##name)(frame, stack_pointer, tstate, this_instr, oparg); \</span></span><br><span class=line><span class=meta>            &#125; while (0)</span></span><br><span class=line><span class=meta>#   <span class=keyword>endif</span></span></span><br><span class=line><span class=meta>#    <span class=keyword>define</span> LABEL(name) TARGET(name)</span></span><br></pre></td></tr></table></figure><p>那么在保证我们基线性能和 Compute GOTO 甚至更优一点的同时，我们可以得到如下的一些好处</p><ol><li>更广泛的平台支持</li><li>将 case 拆分后，编译器更不容易犯错，整体的性能的可预测性更强</li><li>happy perf</li><li>以及我可以用 eBPF 之类的工具做更多的骚操作（</li></ol><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><p>这篇文章差不多就是这样，虽然说是只介绍 Python 3.14 的 Tail Call Interpreter，但是还是完整的介绍了一些整个的一个演进思路</p><p>这也带给我一个启发，很多时候，可预测性真的是非常重要的一个特性。</p><p>这算是 3.14 中和 remote debug 一起并列为我最喜欢的两个feature，可观测性万岁！</p></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class=post-copyright-info><a href=https://github.com/Zheaoli rel="external nofollow noreferrer">Manjusaka</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class=post-copyright-info><a href=https://www.manjusaka.blog/posts/2025/07/02/tail-call-in-3-14-interpreter/ >https://www.manjusaka.blog/posts/2025/07/02/tail-call-in-3-14-interpreter/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class=post-copyright-info>All articles on this blog are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel="external nofollow noreferrer">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/%E7%BC%96%E7%A8%8B/ >编程</a><a class=post-meta__tags href=/tags/Linux/ >Linux</a><a class=post-meta__tags href=/tags/Python/ >Python</a><a class=post-meta__tags href=/tags/%E7%AC%94%E8%AE%B0/ >笔记</a><a class=post-meta__tags href=/tags/%E6%B0%B4%E6%96%87/ >水文</a></div><div class=post-share><div class=social-share data-image=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js defer=defer></script></div></div><div class=ads-wrap><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-7962287588031867 data-ad-slot=2542544532></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class=pagination-post id=pagination><a class="pagination-related full-width" href=/posts/2025/07/02/tail-call-in-3-14-interpreter-en/ title="Further Performance Evolution in Python 3.14: Tail Call Interpreter"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class=info-1><div class=info-item-1>Next</div><div class=info-item-2>Further Performance Evolution in Python 3.14: Tail Call Interpreter</div></div><div class=info-2><div class=info-item-1>I’ve been overwhelmed by security work lately, so let me switch to something lighter to relax my mind. Python 3.14 has officially introduced a new mechanism called Tail Call Interpreter (Made by Ken Jin), which is undoubtedly another major milestone that lays the foundation for the future. Main ContentBefore discussing Python 3.14’s Tail Call Interpreter, we need to talk about the most basic syntax in C - switch-case. 12345678910switch (x) &#123; case 1: // do something brea...</div></div></div></a></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class=relatedPosts-list><a class=pagination-related href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2025-04-26</div><div class=info-item-2>Python 3.14: Python 世界的一大步</div></div><div class=info-2><div class=info-item-1>Python 3.14 目前主要的一些主要的特性其实已经固定了，在我看来，Python 3.14 是一个未来很多年的一个核心版本。因为其确定了是时代的 Python调试生态的基准，这篇文章将会来聊聊这个 Python 世界中的史诗级改进 正文在我们日常调试 Python 代码的时候，我们经常会遇到这样一个问题，我们需要采样当前的 Python Runtime 的状态，进而进一步调试我们的 Python 进程 常见的手段莫过于两种 通过 eBPF + UProbe 等手段来触发 通过 process_vm_readv 等 Syscall 来直接整块读取内存 无论这两种方式都有一个核心的问题，我们怎么样来解析内存中的数据？ 用 https://github.com/jschwinger233/perf-examples/blob/main/cpython310_backtrace/bpf.c 来做一个例子，在之前的很多年的时候，我们会怎么做 123456789101112131415161718192021222324252627282930313233343536373839...</div></div></div></a><a class=pagination-related href=/posts/2024/01/03/a-simple-introduction-about-python-jit/ title="简单聊聊 Python 3.13 的 JIT 方案"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2024-01-04</div><div class=info-item-2>简单聊聊 Python 3.13 的 JIT 方案</div></div><div class=info-2><div class=info-item-1>Python 3.13 的 JIT 方案最终确定了，我觉得可以说又新又好。所以深夜水一篇水文，来聊聊这个 JIT 方案 这篇文章可能会有些枯燥，所以如果对此不感兴趣的同学可以直接 x 掉 基础知识在聊 Python 3.13 具体的实现之前，我们需要来了解下它所采用的 JIT 方案的基础知识 JIT 本身的定义我相信阅读这篇文章的同学已经非常了解了，所以此处不再赘述。JIT 核心分为两大块 代码的 profile，以确定热点路径，尽可能的减少 JIT 的 fallback 汇编代码的生成 本文主要会聊代码的生成部分 在此之前，Python 生态里一个 JIT 的实现，Pyston/Pypy，他们所采取的方案其实是和 LuaJIT 的方式类似，开发者手写汇编来完成代码的特化，然后依赖 DynASM 执行相关的代码 这种方式主要的缺陷在于 手写汇编带来的心智负担 对于平台的兼容性 为了给大家一个直观的感受，我给出一个我之前写过的汇编的例子来作为演示 首先，我需要实现的功能很简单，用 C 来描述应该是这样的 123456int main(int argc, char *arg...</div></div></div></a><a class=pagination-related href=/posts/2023/10/29/the-most-important-thing-in-python-3-12/ title="Python 3.12：一个被人忽略的史诗级版本"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2023-10-30</div><div class=info-item-2>Python 3.12：一个被人忽略的史诗级版本</div></div><div class=info-2><div class=info-item-1>Python 3.12 已经发布了一段时间，所以写篇水文来聊一聊这个常常被人忽略的史诗级版本。 正文Python 3.12 绝对是一个史诗级版本，在我心目中，它对于 Python 的意义，大于 “async/await” 的 Python 3.5 和 “Type Hint” 的 Python 3.6 对于 Python 的意义。 或者我们可以这么说在未来数年的时间里，Python 后续的很多意义重大的变更，其都能上溯到 Python 3.12。 理解我这一个观点，我们来说一下 Python 的几大痛点： Python 的可调试性，可观测性问题。历史上 Python 中做 Cost 的消耗极大，同时没有足够的手段可以从旁路去观察 Python 的运行时行为 Python GIL 问题，这个老生长谈了，不多说 Python 的 C API/ABI 问题，之前暴露的 C API/ABI 通常和 CPython VM 实现细节耦合，导致跨版本兼容性会是一个问题 而这样一些问题，Python 3.12 上都有了极大的进步 PEP 669， GH-96143 极大提升了 Python ...</div></div></div></a><a class=pagination-related href=/posts/2023/10/05/the-perf-feature-python-312/ title="聊聊 Python 3.12 中 perf 的原生支持"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2023-10-05</div><div class=info-item-2>聊聊 Python 3.12 中 perf 的原生支持</div></div><div class=info-2><div class=info-item-1>好久没写 Python 相关的文章了，但是 Python 3.12 perf 原生支持的这个特性非常的棒，思路又新又好了属于是，所以写篇水文来聊聊这个特性 正文先聊聊 Python 的栈帧在聊今天的正式内容之前我们需要理解 Python 在内存中的布局 对于传统的 native application 而言，大家对于其内存布局应该是比较熟悉的，这里以 x86-64 的一张图来说明其栈帧结构 但是对于 CPython 来说，其 Native Code 执行的只是 VM 一层的代码。其在 VM 内单独抽象了一套类似 native 的栈帧结构。 其核心结构如下 1234567891011121314151617181920212223242526272829303132333435363738struct _frame &#123; PyObject_HEAD PyFrameObject *f_back; /* previous frame, or NULL */ struct _PyInterpreterFrame *f_frame; /* point...</div></div></div></a><a class=pagination-related href=/posts/2024/02/10/CVE-2024-21626/ title="简单聊聊 CVE-2024-21626"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2024-02-11</div><div class=info-item-2>简单聊聊 CVE-2024-21626</div></div><div class=info-2><div class=info-item-1>本来这篇文章应该在初一凌晨发的，但是拖延癌晚期，所以到现在才发，得反思下了 背景众所周知，容器逃逸并不是什么令人稀奇的问题了（不被逃逸的容器才是稀奇），2月初，runc 社区正式公布了一个船新的逃逸 CVE，参见 https://github.com/opencontainers/runc/security/advisories/GHSA-xr7r-f8xq-vfvv，版本横跨 1.0 到 1.1.11 这个 CVE 的核心特性在于“可以通过镜像分发的方式，成本很低的进行逃逸” 我们先来复现一下这个问题 我自己的环境是这样 看这篇博客的同学可以参考下面方式进行环境准备， 按照自己的发行版确保安装了，Docker, libseccomp, golang 按照下面方式进行环境安装 1234567891011git clone https://github.com/opencontainers/runcgit checkout v1.1.0-rc.1makesudo rm -rf $(which runc)sudo make installsudo systemctl rest...</div></div></div></a><a class=pagination-related href=/posts/2021/11/22/a-litte-introduction-about-nohdr-filed-in-skbuff/ title="聊聊 sk_buff 中一个冷门字段: nohdr"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2021-11-22</div><div class=info-item-2>聊聊 sk_buff 中一个冷门字段: nohdr</div></div><div class=info-2><div class=info-item-1>今天遇到一个很有意思的问题，“nohdr 字段到底有什么用”，在这里写个水文简单记录一下 正文前情提要首先来说，不管介绍再冷门的字段，既然涉及到 SKBUFF ，那么就得先来对 sk_buff 做个简单的介绍 简而言之，sk_buff 是 Linux 网络子系统的核心数据结构，从链路层到我们最终对数据包的操作，背后都离不开 sk_buff sk_buff 要完全讲解基本就相当于把 Linux 网络系统完全讲解了，所以讲完是不可能讲完的，这辈子都不可能的！ 简单聊几个关键，可能会帮助大家理解我们本文提到的冷门字段 nohdr 的关键字段吧 首先来讲，最重要的三个字段：data ，mac 和 nh ，分别代表着当前 sk_buff 的数据区的起始地址，L2 header 的起始地址，L3 Header 的起始地址。用一个图方便大家理解 看了图的同学可能会有点明白了，实际上在内核里，也是一层一层的通过指针偏移，不断的添加新的 header 来处理网络请求。和我们直觉相符。可能有同学会问，我既然知道 L3 Header 的起始地址，IP 之类的 L3 协议的 header 长度是固...</div></div></div></a></div></div><hr class=custom-hr><div id=post-comment><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class=comment-wrap><div><div id=disqus_thread></div></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info text-center"><div class=avatar-img><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info-name>Manjusaka</div><div class=author-info-description>热忱之心不可磨灭</div><div class=site-data><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>104</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>60</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>41</div></a></div><a id=card-info-btn href=https://github.com/Zheaoli rel="external nofollow noreferrer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class=card-info-social-icons><a class=social-icon href=https://github.com/ZheaoLi rel="external nofollow noreferrer" target=_blank title=Github><i class="fab fa-github"></i></a><a class=social-icon href=mailto:me@manjusaka.me rel="external nofollow noreferrer" target=_blank title=Email><i class="fas fa-envelope"></i></a><a class=social-icon href=https://twitter.com/Manjusaka_Lee rel="external nofollow noreferrer" target=_blank title=推特><i class="fab fa-twitter"></i></a><a class=social-icon href=/atom.xml target=_blank title=RSS><i class="fa-solid fa-feed"></i></a></div></div><div class="card-widget card-announcement"><div class=item-headline><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class=announcement_content>This is my Blog</div></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>Contents</span><span class=toc-percentage></span></div><div class="toc-content is-expand"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%AD%A3%E6%96%87><span class=toc-number>1.</span> <span class=toc-text>正文</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-number>2.</span> <span class=toc-text>总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>Recent Posts</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/posts/2025/07/02/tail-call-in-3-14-interpreter-en/ title="Further Performance Evolution in Python 3.14: Tail Call Interpreter"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Further Performance Evolution in Python 3.14: Tail Call Interpreter"></a><div class=content><a class=title href=/posts/2025/07/02/tail-call-in-3-14-interpreter-en/ title="Further Performance Evolution in Python 3.14: Tail Call Interpreter">Further Performance Evolution in Python 3.14: Tail Call Interpreter</a><time datetime=2025-07-02T15:49:00.000Z title="Created 2025-07-02 23:49:00">2025-07-02</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/07/02/tail-call-in-3-14-interpreter/ title="Python 3.14 的进一步性能进化: Tail Call Interpreter"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Python 3.14 的进一步性能进化: Tail Call Interpreter"></a><div class=content><a class=title href=/posts/2025/07/02/tail-call-in-3-14-interpreter/ title="Python 3.14 的进一步性能进化: Tail Call Interpreter">Python 3.14 的进一步性能进化: Tail Call Interpreter</a><time datetime=2025-07-02T15:49:00.000Z title="Created 2025-07-02 23:49:00">2025-07-02</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Python 3.14: Python 世界的一大步"></a><div class=content><a class=title href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步">Python 3.14: Python 世界的一大步</a><time datetime=2025-04-26T14:49:00.000Z title="Created 2025-04-26 22:49:00">2025-04-26</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/ title=简单聊聊常见的负载均衡算法><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=/images/pixai-1860500966642493859-3.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单聊聊常见的负载均衡算法></a><div class=content><a class=title href=/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/ title=简单聊聊常见的负载均衡算法>简单聊聊常见的负载均衡算法</a><time datetime=2025-03-23T12:00:00.000Z title="Created 2025-03-23 20:00:00">2025-03-23</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/02/03/a-little-thought-about-translation-about-yuru-camp/ title=简单吐槽一下摇曳露营的台配><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单吐槽一下摇曳露营的台配></a><div class=content><a class=title href=/posts/2025/02/03/a-little-thought-about-translation-about-yuru-camp/ title=简单吐槽一下摇曳露营的台配>简单吐槽一下摇曳露营的台配</a><time datetime=2025-02-03T18:00:00.000Z title="Created 2025-02-04 02:00:00">2025-02-04</time></div></div></div></div><div class="card-widget ads-wrap"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7962287588031867 data-ad-slot=1257383027 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id=footer><div class=footer-other><div class=footer-copyright><span class=copyright>&copy;2020 - 2025 By Manjusaka</span></div></div></footer></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title="Reading Mode"><i class="fas fa-book-open"></i></button><button id=translateLink type=button title="Toggle Between Traditional and Simplified Chinese">简</button><button id=darkmode type=button title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id=hide-aside-btn type=button title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id=rightside-config-show><button id=darkmode type=button title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id=translateLink type=button title="Toggle Between Traditional and Simplified Chinese">简</button><button id=readmode type=button title="Reading Mode"><i class="fas fa-book-open"></i></button><button id=go-up type=button title="Back to Top"><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src=https://www.manjusaka.blog/js/utils.js></script><script src=https://www.manjusaka.blog/js/main.js></script><script src=https://www.manjusaka.blog/js/tw_cn.js></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js></script><script src=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js></script><div class=js-pjax><script>(()=>{var e=()=>{var e;0!==(e=document.querySelectorAll("pre > code.mermaid")).length&&e.forEach(e=>{var t=document.createElement("pre"),d=(t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent,document.createElement("div"));d.className="mermaid-wrap",d.appendChild(t),e.parentNode.replaceWith(d)});let t=document.querySelectorAll("#article-container .mermaid-wrap");0!==t.length&&(e=()=>(e=>{window.loadMermaid=!0;document.documentElement.getAttribute("data-theme");e.forEach((e,t)=>{let d=e.firstElementChild;e=`%%{init:{ 'theme':'default'}}%%
`+d.textContent,t=mermaid.render("mermaid-"+t,e);let n=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof t?n(t):t.then(({svg:e})=>n(e))})})(t),btf.addGlobalFn("themeChange",e,"mermaid"),window.loadMermaid?e():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(e))};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{let s="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,n=e=>{window.DISQUS&&window.DISQUS.reset({reload:!0,config:e})};var e=(e,t)=>{s&&(window.shuoshuoComment.destroyDisqus=()=>{e.children.length&&(e.innerHTML="",e.classList.add("no-comment"))}),window.disqus_identifier=s?t:"/posts/2025/07/02/tail-call-in-3-14-interpreter/",window.disqus_url=s?location.origin+t:"https://www.manjusaka.blog/posts/2025/07/02/tail-call-in-3-14-interpreter/";function i(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title="Python 3.14 的进一步性能进化: Tail Call Interpreter"}window.DISQUS?n(i):((t=document.createElement("script")).src="https://manjusakablog.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),document.head.appendChild(t)),btf.addGlobalFn("themeChange",()=>n(i),"disqus")};s?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script defer=defer id=fluttering_ribbon mobile=false src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js></script><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=algolia-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>Search</span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=search-wrap><div id=algolia-search-input></div><hr><div id=algolia-search-results><div id=algolia-hits></div><div id=algolia-pagination></div><div id=algolia-info><div class=algolia-stats></div><div class=algolia-poweredBy></div></div></div></div></div><div id=search-mask></div><script src=https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js></script><script src=https://www.manjusaka.blog/js/search/algolia.js></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var s=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),s.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/12/31/at-the-end-of-2024/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-12-31</span><a class="blog-slider__title" href="/posts/2024/12/31/at-the-end-of-2024/" alt="">本当の僕らをありがとう</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2024/12/31/at-the-end-of-2024/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-02-20</span><a class="blog-slider__title" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">简单聊聊奥特曼中很有趣的细节</a><div class="blog-slider__text">ヒーロが必要なんだよ，金城君。ヒーローが必要なんだ！</div><a class="blog-slider__button" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/29/per-aspera-ad-astra/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-29</span><a class="blog-slider__title" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">Per aspera, Ad astra</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-24</span><a class="blog-slider__title" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">开源可能没你想的那么难</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/Zheaoli/yuque-py/assets/7054676/ea9460a2-e351-4b73-9f82-7aef6cd20c33" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-25</span><a class="blog-slider__title" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">聊聊公益和助学</a><div class="blog-slider__text">很多时候，帮助人不需要那么多理由</div><a class="blog-slider__button" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-28</span><a class="blog-slider__title" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">家庭 Homelab 升级计划: v2</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://user-images.githubusercontent.com/7054676/228287041-c86e7928-0da8-4097-b7ff-e575faa8cf8c.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-19</span><a class="blog-slider__title" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">为什么奥特曼是我的信仰</a><div class="blog-slider__text">優しさを失わないでくれ。弱い者を労り互いに助け合い。</div><a class="blog-slider__button" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/16/how-do-I-build-homelab/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-16</span><a class="blog-slider__title" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">家庭 Homelab 升级计划</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer=defer src=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js></script><script defer=defer data-pjax src=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js></script><script async src=//at.alicdn.com/t/font_2032782_8d5kxvn09md.js></script></body></html>
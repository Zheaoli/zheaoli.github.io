<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>继续爆论容器中的一号进程 - Manjusaka</title><meta description="上周的文章聊了关于容器中的一号进程的一些概况后，在我师父某川(可以去 GitHub 找他玩，jschwinger23) 的指导与配合下，我们一起对目前主流的被广泛使用的两个容器中一号进程的实现 dumb-init 和 tini 做了一番探究，继续写个水文来爆论一番。"><meta property="og:type" content="blog"><meta property="og:title" content="继续爆论容器中的一号进程"><meta property="og:url" content="http://manjusaka.itscoder.com/posts/2021/02/28/damn-the-init-process/"><meta property="og:site_name" content="Manjusaka"><meta property="og:description" content="上周的文章聊了关于容器中的一号进程的一些概况后，在我师父某川(可以去 GitHub 找他玩，jschwinger23) 的指导与配合下，我们一起对目前主流的被广泛使用的两个容器中一号进程的实现 dumb-init 和 tini 做了一番探究，继续写个水文来爆论一番。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109394863-29ce2b80-7964-11eb-88aa-4e1f6e2e3e00.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109394942-a9f49100-7964-11eb-8fa5-5d676e512081.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109394966-d8726c00-7964-11eb-9e18-f99a0a64b5cd.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109396500-dca28780-796c-11eb-9ae1-37be10affbb0.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109396545-1f645f80-796d-11eb-9205-7735e5fd3685.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109396563-3440f300-796d-11eb-82ed-94693d49cfc8.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109397059-c649fb00-796f-11eb-8206-02af6d9dc02b.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109397207-9818eb00-7970-11eb-8dbb-35ccbe5d26cf.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109397254-d31b1e80-7970-11eb-9bf2-fcc3e12ca77c.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109397971-b54fb880-7974-11eb-9899-0d71af5ad835.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398085-648c8f80-7975-11eb-8b08-21fb0c0399fa.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398094-75d59c00-7975-11eb-8d42-ee062609e152.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398106-871ea880-7975-11eb-94a8-0b25374fa79e.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398222-83d7ec80-7976-11eb-88e9-4e7231b2c90d.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398244-aa962300-7976-11eb-9c4f-7ca7dbe1b833.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398251-bc77c600-7976-11eb-8b24-d5bb60c1ce96.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398257-cac5e200-7976-11eb-9921-457195ee052c.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398735-96075a00-7979-11eb-85e9-f8ab99c3d5f5.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398751-b1726500-7979-11eb-8398-0069c4f3a2aa.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398764-c4853500-7979-11eb-981f-a5ea65ae7572.png"><meta property="og:image" content="https://user-images.githubusercontent.com/7054676/109398777-d666d800-7979-11eb-972a-37cf82e371d4.png"><meta property="article:published_time" content="2021-02-28T03:00:00.000Z"><meta property="article:modified_time" content="2021-04-19T14:27:27.149Z"><meta property="article:author" content="Manjusaka"><meta property="article:tag" content="编程"><meta property="article:tag" content="笔记"><meta property="article:tag" content="水文"><meta property="article:tag" content="Linux"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://user-images.githubusercontent.com/7054676/109394863-29ce2b80-7964-11eb-88aa-4e1f6e2e3e00.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://manjusaka.itscoder.com/posts/2021/02/28/damn-the-init-process/"},"headline":"Manjusaka","image":["https://user-images.githubusercontent.com/7054676/109394863-29ce2b80-7964-11eb-88aa-4e1f6e2e3e00.png","https://user-images.githubusercontent.com/7054676/109394942-a9f49100-7964-11eb-8fa5-5d676e512081.png","https://user-images.githubusercontent.com/7054676/109394966-d8726c00-7964-11eb-9e18-f99a0a64b5cd.png","https://user-images.githubusercontent.com/7054676/109396500-dca28780-796c-11eb-9ae1-37be10affbb0.png","https://user-images.githubusercontent.com/7054676/109396545-1f645f80-796d-11eb-9205-7735e5fd3685.png","https://user-images.githubusercontent.com/7054676/109396563-3440f300-796d-11eb-82ed-94693d49cfc8.png","https://user-images.githubusercontent.com/7054676/109397059-c649fb00-796f-11eb-8206-02af6d9dc02b.png","https://user-images.githubusercontent.com/7054676/109397207-9818eb00-7970-11eb-8dbb-35ccbe5d26cf.png","https://user-images.githubusercontent.com/7054676/109397254-d31b1e80-7970-11eb-9bf2-fcc3e12ca77c.png","https://user-images.githubusercontent.com/7054676/109397971-b54fb880-7974-11eb-9899-0d71af5ad835.png","https://user-images.githubusercontent.com/7054676/109398085-648c8f80-7975-11eb-8b08-21fb0c0399fa.png","https://user-images.githubusercontent.com/7054676/109398094-75d59c00-7975-11eb-8d42-ee062609e152.png","https://user-images.githubusercontent.com/7054676/109398106-871ea880-7975-11eb-94a8-0b25374fa79e.png","https://user-images.githubusercontent.com/7054676/109398222-83d7ec80-7976-11eb-88e9-4e7231b2c90d.png","https://user-images.githubusercontent.com/7054676/109398244-aa962300-7976-11eb-9c4f-7ca7dbe1b833.png","https://user-images.githubusercontent.com/7054676/109398251-bc77c600-7976-11eb-8b24-d5bb60c1ce96.png","https://user-images.githubusercontent.com/7054676/109398257-cac5e200-7976-11eb-9921-457195ee052c.png","https://user-images.githubusercontent.com/7054676/109398735-96075a00-7979-11eb-85e9-f8ab99c3d5f5.png","https://user-images.githubusercontent.com/7054676/109398751-b1726500-7979-11eb-8398-0069c4f3a2aa.png","https://user-images.githubusercontent.com/7054676/109398764-c4853500-7979-11eb-981f-a5ea65ae7572.png","https://user-images.githubusercontent.com/7054676/109398777-d666d800-7979-11eb-972a-37cf82e371d4.png"],"datePublished":"2021-02-28T03:00:00.000Z","dateModified":"2021-04-19T14:27:27.149Z","author":{"@type":"Person","name":"Manjusaka"},"description":"上周的文章聊了关于容器中的一号进程的一些概况后，在我师父某川(可以去 GitHub 找他玩，jschwinger23) 的指导与配合下，我们一起对目前主流的被广泛使用的两个容器中一号进程的实现 dumb-init 和 tini 做了一番探究，继续写个水文来爆论一番。"}</script><link rel="canonical" href="http://manjusaka.itscoder.com/posts/2021/02/28/damn-the-init-process/"><link rel="icon" href="https://user-images.githubusercontent.com/7054676/56820343-2fe1b580-687e-11e9-8f6f-778df3a8eafd.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?56ca085ae4b8a4667f041cdd04856321";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-154407994-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-154407994-1');</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Manjusaka" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://user-images.githubusercontent.com/7054676/56820277-0a54ac00-687e-11e9-9f34-f79089938638.png" alt="Manjusaka" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/.">主页</a><a class="navbar-item" href="/archives">文章</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/atom.xml">订阅</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Zheaoli"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-02-28T03:00:00.000Z" title="2021-02-28T03:00:00.000Z">2021-02-28</time></span><span class="level-item"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a><span> / </span><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Linux/">Linux</a></span><span class="level-item">31 minutes read (About 4628 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">继续爆论容器中的一号进程</h1><div class="content"><p>上周的文章聊了关于容器中的一号进程的一些概况后，在我师父某川(可以去 GitHub 找他玩，<a target="_blank" rel="noopener" href="https://github.com/jschwinger23">jschwinger23</a>) 的指导与配合下，我们一起对目前主流的被广泛使用的两个容器中一号进程的实现 dumb-init 和 tini 做了一番探究，继续写个水文来爆论一番。</p>
<span id="more"></span>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="我们为什么需要一个一号进程，我们希望的一号进程需要承担怎样的职责？"><a href="#我们为什么需要一个一号进程，我们希望的一号进程需要承担怎样的职责？" class="headerlink" title="我们为什么需要一个一号进程，我们希望的一号进程需要承担怎样的职责？"></a>我们为什么需要一个一号进程，我们希望的一号进程需要承担怎样的职责？</h3><p>在继续聊关于 dumb-init 和 tini 的相关爆论之前，我们需要来 review 一个问题。我们为什么需要一个一号进程？以及我们所选择的一号进程需要承担怎么样的职责</p>
<p>其实我们在容器场景下需要一号进程托管在前面实际上有两种主要的场景，</p>
<ol>
<li><p>对于容器内 Graceful Upgrade 二进制这种场景，主流的一种做法之一是 fork 一个新的进程，exec 新的二进制文件，新进程处理新链接，老进程处理老链接。（Nginx 就采用这种方案）</p>
</li>
<li><p>没有正确的处理信号转发以及进程回收的情况</p>
</li>
<li><p>一些如同 calico-node 的场景么，我们出于方便打包的考虑，将多个二进制运行在同一容器中</p>
</li>
</ol>
<p>对于第一种其实需要说的没有太多，我们来看一下第二点的测试</p>
<p>我们先准备一个最简单 Python 文件，<strong>demo1.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>

<p>然后依照常规，我们开始用一个 bash 脚本裹一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">python /root/demo1.py</span><br></pre></td></tr></table></figure>

<p>最后编写 Dockerfile </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> demo1.py /root/demo1.py</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> demo1.sh /root/demo1.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;/root/demo1.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>构建后开始执行，我们先来看一下进程结构</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109394863-29ce2b80-7964-11eb-88aa-4e1f6e2e3e00.png" alt="进程结构"></p>
<p>没有问题，现在我们用 <strong>strace</strong> 来 trace 一下，2049962、2050009 这两个进程，然后对 2049962 这个 bash 进程发 *<em>SIGTERM</em>＊ 信号</p>
<p>我们来看下结果</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109394942-a9f49100-7964-11eb-8fa5-5d676e512081.png" alt="2049962进程的 trace 结果"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109394966-d8726c00-7964-11eb-9e18-f99a0a64b5cd.png" alt="2050009进程的 trace 结果"></p>
<p>我们能清晰看到 2049962 进程在接到 <strong>SIGTERM</strong> 的时候，没有将其转发给 2050009 进程。在我们手动 SIGKILL 2049962 后， 2050009 也随即退出，这里可能有人会有点疑惑，为什么 2049962 退出后，2050009 也会退出呢？</p>
<p>这里是由于 pid namespace 本身的特性，我们来看看，<a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man7/pid_namespaces.7.html">pid_namespaces</a> 中的相关介绍</p>
<blockquote>
<p>If the “init” process of a PID namespace terminates, the kernel terminates all of the processes in the namespace via a SIGKILL signal.  </p>
</blockquote>
<p>当当前 pid ns 内的一号进程退出的时候，内核直接 SIGKILL 伺候该 pid ns 内的剩余进程</p>
<p>OK，在我们结合容器调度框架后，那么在生产上实际会出现很多的坑，来看一段我之前的吐槽</p>
<blockquote>
<p>我们一个测试服务，Spring Cloud 的，在下线后，节点无法从注册中心摘除，然后百思不得其解，最后查到问题，，<br>本质上是这样，POD 被摘除的时候，K8S Scheduler 会给 POD 的 ENTRYPOINT 发一个 SIGTERM 信号，然后等待三十秒（默认的 graceful shutdown 超时实践)，还没响应就会 SIGKILL 直接杀<br>问题在于，我们 Eureka 版的服务是通过 start.sh 来启动的，ENTRYPOINT [“/home/admin/start.sh”]，容器里默认是 /bin/sh 是 fork/exec 模式，导致我服务进程没法正确的收到 SIGTERM 信号，然后一直没结束就被 SIGKILL 了</p>
</blockquote>
<p>刺激不刺激。除了信号转发无法正常处理以外，我们应用程序常见的一个常见处理的问题就是 Z 进程的出现，即子进程结束之后，无法正确的回收。比如早期 puppeteer 臭名昭著的 Z 进程问题。 在这种情况下，除了应用程序本身的问题以外，另外可能的原因是在守护进程这样的场景下，孤儿进程 re-parent 之后的进程，不具备回收子进程的功能</p>
<p>OK 在回顾完上面我们常见的问题后，我们来 review 一下我们对于容器内一号进程所需要承担的职责</p>
<ol>
<li><p>信号的转发</p>
</li>
<li><p>Z 进程的回收</p>
</li>
</ol>
<p>而在目前，在容器场景下，大家主要使用两个方案来作为自己的容器内一号进程，<a target="_blank" rel="noopener" href="https://github.com/Yelp/dumb-init">dumb-init</a> 和 <a target="_blank" rel="noopener" href="https://github.com/krallin/tini">tini</a>。这两个方案对于容器内孤儿与 Z 进程的处理都算是 OK。但是信号转发的实现上一言难尽。那么接下来</p>
<p>爆论时间！</p>
<h3 id="拉跨的-dumb-init"><a href="#拉跨的-dumb-init" class="headerlink" title="拉跨的 dumb-init"></a>拉跨的 dumb-init</h3><p>某种程度上来说，<strong>dumb-init</strong> 这货完全是属于虚假宣传的典范。代码实现非常糙</p>
<p>来看看官方的宣传</p>
<blockquote>
<p>dumb-init runs as PID 1, acting like a simple init system. It launches a single process and then proxies all received signals to a session rooted at that child process.</p>
</blockquote>
<p>这里，dumb-init 说自己使用了 Linux 中的进程 Session，我们都知道，一个进程 Session 在默认情况下，共享一个 Process Group Id 。那么我们这里可以理解为，dumb-init 能将信号完全转发到进程组中的每个进程上。听起来很美好是不是？</p>
<p>我们先来测试一下吧</p>
<p>测试代码如下，<strong>demo2.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    cpid = os.fork()</span><br><span class="line">time.sleep(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>Dockerfile 如下</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> wget -O /usr/<span class="built_in">local</span>/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_x86_64</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /usr/<span class="built_in">local</span>/bin/dumb-init</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> demo2.py /root/demo2.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/local/bin/dumb-init&quot;</span>, <span class="string">&quot;--&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;/root/demo2.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>构建，开跑，先来看下进程结构</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109396500-dca28780-796c-11eb-9ae1-37be10affbb0.png" alt="demo2 的进程结构"></p>
<p>然后老规矩，strace 2103908、2103909、2103910 这三个进程，然后我们对 <strong>dumb-init</strong> 的进程做一下发送 SIGTERM 的操作吧</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109396545-1f645f80-796d-11eb-9205-7735e5fd3685.png" alt="strace 2103908"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109396563-3440f300-796d-11eb-82ed-94693d49cfc8.png" alt="strace 2103909"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109397059-c649fb00-796f-11eb-8206-02af6d9dc02b.png" alt="strace 2103910"></p>
<p>诶？dumb-init 老师，发生了甚么事？为什么 2103909 直接被 SIGKILL 了，而没有收到 SIGTERM</p>
<p>这里我们要来看下 dumb-init 的关键实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handle_signal</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;</span><br><span class="line">    DEBUG(<span class="string">&quot;Received signal %d.\n&quot;</span>, signum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (signal_temporary_ignores[signum] == <span class="number">1</span>) &#123;</span><br><span class="line">        DEBUG(<span class="string">&quot;Ignoring tty hand-off signal %d.\n&quot;</span>, signum);</span><br><span class="line">        signal_temporary_ignores[signum] = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (signum == SIGCHLD) &#123;</span><br><span class="line">        <span class="keyword">int</span> status, exit_status;</span><br><span class="line">        <span class="keyword">pid_t</span> killed_pid;</span><br><span class="line">        <span class="keyword">while</span> ((killed_pid = waitpid(<span class="number">-1</span>, &amp;status, WNOHANG)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (WIFEXITED(status)) &#123;</span><br><span class="line">                exit_status = WEXITSTATUS(status);</span><br><span class="line">                DEBUG(<span class="string">&quot;A child with PID %d exited with exit status %d.\n&quot;</span>, killed_pid, exit_status);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                assert(WIFSIGNALED(status));</span><br><span class="line">                exit_status = <span class="number">128</span> + WTERMSIG(status);</span><br><span class="line">                DEBUG(<span class="string">&quot;A child with PID %d was terminated by signal %d.\n&quot;</span>, killed_pid, exit_status - <span class="number">128</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (killed_pid == child_pid) &#123;</span><br><span class="line">                forward_signal(SIGTERM);  <span class="comment">// send SIGTERM to any remaining children</span></span><br><span class="line">                DEBUG(<span class="string">&quot;Child exited with status %d. Goodbye.\n&quot;</span>, exit_status);</span><br><span class="line">                <span class="built_in">exit</span>(exit_status);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        forward_signal(signum);</span><br><span class="line">        <span class="keyword">if</span> (signum == SIGTSTP || signum == SIGTTOU || signum == SIGTTIN) &#123;</span><br><span class="line">            DEBUG(<span class="string">&quot;Suspending self due to TTY signal.\n&quot;</span>);</span><br><span class="line">            kill(getpid(), SIGSTOP);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是 dumb-init 老师处理信号的代码，在收到信号后，将除 SIGCHLD 的信号做转发（注意 SIGKILL 是不可 handle 信号），我们来看看信号转发的逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forward_signal</span><span class="params">(<span class="keyword">int</span> signum)</span> </span>&#123;</span><br><span class="line">    signum = translate_signal(signum);</span><br><span class="line">    <span class="keyword">if</span> (signum != <span class="number">0</span>) &#123;</span><br><span class="line">        kill(use_setsid ? -child_pid : child_pid, signum);</span><br><span class="line">        DEBUG(<span class="string">&quot;Forwarded signal %d to children.\n&quot;</span>, signum);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        DEBUG(<span class="string">&quot;Not forwarding signal %d to children (ignored).\n&quot;</span>, signum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下直接 kill 发送信号，其中 -child_pid 是这样一个特性：</p>
<blockquote>
<p>If pid is less than -1, then sig is sent to every process in the process group whose ID is -pid.</p>
</blockquote>
<p>直接转发进程组，看起来没啥问题啊？那么上面是甚么原因呢？我们再来复习下上一段话，kill 给进程组发信号的逻辑是 <strong>sig is sent to every process</strong> ，懂了，一个 O(N) 的遍历嘛。没啥问题啊？好了，不卖关子，这里 dumb-init 的实现存在一个 race-condition</p>
<p>我们刚刚说了，kill 进程组的行为是一个 O(N) 的遍历，那么必然会有进程先收到信号，而有进程后收到信号。以 SIGTERM 为例，假设我们 dumb-init 的子进程先收到 SIGTERM，优雅退出后，dumb-init 收到 SIGCHLD 的信号，然后 wait_pid 拿到子进程 ID，判断是自己直接托管的进程后，自杀退出。好了，由于 dumb-init 是我们当前 pid ns 内的 init 进程，再来复习下 pid ns 的特性。</p>
<blockquote>
<p>If the “init” process of a PID namespace terminates, the kernel terminates all of the processes in the namespace via a SIGKILL signal. </p>
</blockquote>
<p>在 dumb-init 自杀以后，剩余进程将直接被内核 SIGKILL 伺候。也就导致了我们上面看到的，子进程没有收到转发的信号！</p>
<p>所以这里加粗处理一下，<strong>dumb-init 所承诺的，能将信号转发到所有进程上，完全是虚假宣传！</strong></p>
<p>而且请注意，dumb-init 宣称自己能管理一个 Session 内的进程！但是实际上他们只做了一个进程组的信号转发！完全是虚假宣称！Fake News！</p>
<p>而且如上面所提到的，在我们热更新二进制这样的场景下，dumb-init 在进程退出后直接自杀。和不使用一号进程完全没有差别！</p>
<p>我们可以来测试一下，测试代码 demo3.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pid = os.fork()</span><br><span class="line">time.sleep(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>fork 一个进程，总共两个进程</p>
<p>Dockerfile 如下</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> wget -O /usr/<span class="built_in">local</span>/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_x86_64</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /usr/<span class="built_in">local</span>/bin/dumb-init</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> demo3.py /root/demo3.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/local/bin/dumb-init&quot;</span>, <span class="string">&quot;--&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;/root/demo3.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>构建，执行，先看看进程结构</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109397207-9818eb00-7970-11eb-8dbb-35ccbe5d26cf.png" alt="demo3 进程结构"></p>
<p>然后模拟老进程退出，我们直接 SIGKILL 掉 2134836，然后我们看看 2134837 的 strace 的结果</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109397254-d31b1e80-7970-11eb-9bf2-fcc3e12ca77c.png" alt="strace 2134837"></p>
<p>如预期一样，在 dumb-init 自杀后，2134837 被内核 SIGKILL 了</p>
<p>所以跟我复习一遍 <strong>dumb-init</strong> 拉跨！好了，我们接着聊 tini 的实现</p>
<h3 id="态度友好的聊聊-tini"><a href="#态度友好的聊聊-tini" class="headerlink" title="态度友好的聊聊 tini"></a>态度友好的聊聊 tini</h3><p>平心而论，tini 的实现，虽然也还有坑，但是比 <strong>dumb-init</strong> 细腻到不知道哪里去了，我们直接来先看下代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">	<span class="comment">/* Wait for one signal, and forward it */</span></span><br><span class="line">	<span class="keyword">if</span> (wait_and_forward_signal(&amp;parent_sigset, child_pid)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Now, reap zombies */</span></span><br><span class="line">	<span class="keyword">if</span> (reap_zombies(child_pid, &amp;child_exitcode)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (child_exitcode != <span class="number">-1</span>) &#123;</span><br><span class="line">		PRINT_TRACE(<span class="string">&quot;Exiting: child has exited&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> child_exitcode;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先 tini 没有设置 signal handler ，不断循环 <code>wait_and_forward_signal</code> 和 <code>reap_zombies</code> 这两个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wait_and_forward_signal</span><span class="params">(<span class="keyword">sigset_t</span> <span class="keyword">const</span>* <span class="keyword">const</span> parent_sigset_ptr, <span class="keyword">pid_t</span> <span class="keyword">const</span> child_pid)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">siginfo_t</span> sig;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (sigtimedwait(parent_sigset_ptr, &amp;sig, &amp;ts) == <span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">switch</span> (errno) &#123;</span><br><span class="line">			<span class="keyword">case</span> EAGAIN:</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> EINTR:</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				PRINT_FATAL(<span class="string">&quot;Unexpected error in sigtimedwait: &#x27;%s&#x27;&quot;</span>, strerror(errno));</span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">/* There is a signal to handle here */</span></span><br><span class="line">		<span class="keyword">switch</span> (sig.si_signo) &#123;</span><br><span class="line">			<span class="keyword">case</span> SIGCHLD:</span><br><span class="line">				<span class="comment">/* Special-cased, as we don&#x27;t forward SIGCHLD. Instead, we&#x27;ll</span></span><br><span class="line"><span class="comment">				 * fallthrough to reaping processes.</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">				PRINT_DEBUG(<span class="string">&quot;Received SIGCHLD&quot;</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				PRINT_DEBUG(<span class="string">&quot;Passing signal: &#x27;%s&#x27;&quot;</span>, strsignal(sig.si_signo));</span><br><span class="line">				<span class="comment">/* Forward anything else */</span></span><br><span class="line">				<span class="keyword">if</span> (kill(kill_process_group ? -child_pid : child_pid, sig.si_signo)) &#123;</span><br><span class="line">					<span class="keyword">if</span> (errno == ESRCH) &#123;</span><br><span class="line">						PRINT_WARNING(<span class="string">&quot;Child was dead when forwarding signal&quot;</span>);</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						PRINT_FATAL(<span class="string">&quot;Unexpected error when forwarding signal: &#x27;%s&#x27;&quot;</span>, strerror(errno));</span><br><span class="line">						<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用 <code>sigtimedwait</code> 这个函数来接收信号，然后过滤掉 <code>SIGCHLD</code> 转发。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">reap_zombies</span><span class="params">(<span class="keyword">const</span> <span class="keyword">pid_t</span> child_pid, <span class="keyword">int</span>* <span class="keyword">const</span> child_exitcode_ptr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">pid_t</span> current_pid;</span><br><span class="line">	<span class="keyword">int</span> current_status;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		current_pid = waitpid(<span class="number">-1</span>, &amp;current_status, WNOHANG);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> (current_pid) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">				<span class="keyword">if</span> (errno == ECHILD) &#123;</span><br><span class="line">					PRINT_TRACE(<span class="string">&quot;No child to wait&quot;</span>);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				PRINT_FATAL(<span class="string">&quot;Error while waiting for pids: &#x27;%s&#x27;&quot;</span>, strerror(errno));</span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">				PRINT_TRACE(<span class="string">&quot;No child to reap&quot;</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="comment">/* A child was reaped. Check whether it&#x27;s the main one. If it is, then</span></span><br><span class="line"><span class="comment">				 * set the exit_code, which will cause us to exit once we&#x27;ve reaped everyone else.</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">				PRINT_DEBUG(<span class="string">&quot;Reaped child with pid: &#x27;%i&#x27;&quot;</span>, current_pid);</span><br><span class="line">				<span class="keyword">if</span> (current_pid == child_pid) &#123;</span><br><span class="line">					<span class="keyword">if</span> (WIFEXITED(current_status)) &#123;</span><br><span class="line">						<span class="comment">/* Our process exited normally. */</span></span><br><span class="line">						PRINT_INFO(<span class="string">&quot;Main child exited normally (with status &#x27;%i&#x27;)&quot;</span>, WEXITSTATUS(current_status));</span><br><span class="line">						*child_exitcode_ptr = WEXITSTATUS(current_status);</span><br><span class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (WIFSIGNALED(current_status)) &#123;</span><br><span class="line">						<span class="comment">/* Our process was terminated. Emulate what sh / bash</span></span><br><span class="line"><span class="comment">						 * would do, which is to return 128 + signal number.</span></span><br><span class="line"><span class="comment">						 */</span></span><br><span class="line">						PRINT_INFO(<span class="string">&quot;Main child exited with signal (with signal &#x27;%s&#x27;)&quot;</span>, strsignal(WTERMSIG(current_status)));</span><br><span class="line">						*child_exitcode_ptr = <span class="number">128</span> + WTERMSIG(current_status);</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						PRINT_FATAL(<span class="string">&quot;Main child exited for unknown reason&quot;</span>);</span><br><span class="line">						<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// Be safe, ensure the status code is indeed between 0 and 255.</span></span><br><span class="line">					*child_exitcode_ptr = *child_exitcode_ptr % (STATUS_MAX - STATUS_MIN + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// If this exitcode was remapped, then set it to 0.</span></span><br><span class="line">					INT32_BITFIELD_CHECK_BOUNDS(expect_status, *child_exitcode_ptr);</span><br><span class="line">					<span class="keyword">if</span> (INT32_BITFIELD_TEST(expect_status, *child_exitcode_ptr)) &#123;</span><br><span class="line">						*child_exitcode_ptr = <span class="number">0</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (warn_on_reap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">					PRINT_WARNING(<span class="string">&quot;Reaped zombie process with pid=%i&quot;</span>, current_pid);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Check if other childs have been reaped.</span></span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* If we make it here, that&#x27;s because we did not continue in the switch case. */</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>reap_zombies</code> 函数中，不断利用 <code>waitpid</code> 这个函数来处理进程，在没有子进程等待处理或者遇到其余系统错误时退出循环。</p>
<p>注意这里 tini 和 dumb-init 的的实现差异，dumb-init 在回收自己的入口子进程后便会自杀。而 tini 将会在所有自己的子进程退出之后，结束循环，然后判断是否自杀。</p>
<p>那么我们这里来测试一下</p>
<p>还是 demo2 的例子，我们来测试一下孙进程的例子</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> demo2.py /root/demo2.py</span></span><br><span class="line"><span class="keyword">ENV</span> TINI_VERSION v0.<span class="number">19.0</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> https://github.com/krallin/tini/releases/download/<span class="variable">$&#123;TINI_VERSION&#125;</span>/tini /tini</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /tini</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [ <span class="string">&quot;/tini&quot;</span>,<span class="string">&quot;-s&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;--&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;/root/demo2.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>然后构建，执行，进程结构如下</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109397971-b54fb880-7974-11eb-9899-0d71af5ad835.png" alt="demo2-tini 进程结构图"></p>
<p>然后，老规矩，strace , kill 发 SIGTERM 看一下，</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398085-648c8f80-7975-11eb-8b08-21fb0c0399fa.png" alt="strace 2160093"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398094-75d59c00-7975-11eb-8d42-ee062609e152.png" alt="strace 2160094"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398106-871ea880-7975-11eb-94a8-0b25374fa79e.png" alt="strace 2160095"></p>
<p>嗯，如预期一样，那么 tini 的实现是不是没有问题了呢，我们再来准备一个例子,demo4.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    signal.signal(<span class="number">15</span>, <span class="keyword">lambda</span> _, __: time.sleep(<span class="number">1</span>))</span><br><span class="line">    cpid = os.fork()</span><br><span class="line">time.sleep(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>这里我们用 <code>time.sleep(1)</code> 来模拟，程序接到 SIGTERM 后需要优雅处理，然后我们还是准备下 dockefile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> demo4.py /root/demo4.py</span></span><br><span class="line"><span class="keyword">ENV</span> TINI_VERSION v0.<span class="number">19.0</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> https://github.com/krallin/tini/releases/download/<span class="variable">$&#123;TINI_VERSION&#125;</span>/tini /tini</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /tini</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [ <span class="string">&quot;/tini&quot;</span>,<span class="string">&quot;-s&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;--&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;/root/demo4.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>然后构建，允许，看进程结构，啪的一下很快啊</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398222-83d7ec80-7976-11eb-88e9-4e7231b2c90d.png" alt="demo4 进程结构"></p>
<p>然后 strace ，发 SIGTERM 一条龙服务，</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398244-aa962300-7976-11eb-9c4f-7ca7dbe1b833.png" alt="strace 2173315"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398251-bc77c600-7976-11eb-8b24-d5bb60c1ce96.png" alt="strace 2173316"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398257-cac5e200-7976-11eb-9921-457195ee052c.png" alt="strace 2173317"></p>
<p>然后我们发现，2173316 和 2173317 这两个进程，成功接收到 SIGTERM 的信号后，在处理中，被 SIGKILL 了。那么这是为甚么呢？实际上这里也存在一个潜在的 race condition</p>
<p>当我们开启 tini 的使用。2173315 退出后，2173316 将被 re-parent ，</p>
<p>按照内核的 re-parent 流程，2173317 re-parent 到 tini 进程。</p>
<p>但是，tini 在使用 <code>waitpid</code> 的时候，使用了 <code>WNOHANG</code> 这个选项，那么这里如果在执行 waitpid 时，子进程还未结束，那么将立刻返回0。从而退出循环，开始自杀流程。</p>
<p>刺激不刺激，关于这点，我师父和我提了一个 issue: <a target="_blank" rel="noopener" href="https://github.com/krallin/tini/issues/180">tini Exits Too Early Leading to Graceful Termination Failure</a></p>
<p>然后，我也做了一版修复，具体可以参考<a target="_blank" rel="noopener" href="https://github.com/Zheaoli/tini/commit/f5286c205d948a6cbb07fa8dca9e763bdb3ebe61">use new threading to run waipid</a>（还在 PoC，没写单测，处理也有点糙）</p>
<p>实际上思路很简单 ，我们不使用 <code>waitpid</code> 中的 <code>WNOHANG</code> 选项，将其变为阻塞的调用，然后用一个新的线程来做 <code>waitpid</code> 的处理</p>
<p>构建一版测试效果如下</p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398735-96075a00-7979-11eb-85e9-f8ab99c3d5f5.png" alt="demo5 进程结构"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398751-b1726500-7979-11eb-8398-0069c4f3a2aa.png" alt="strace 1808102"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398764-c4853500-7979-11eb-981f-a5ea65ae7572.png" alt="strace 1808104"></p>
<p><img src="https://user-images.githubusercontent.com/7054676/109398777-d666d800-7979-11eb-972a-37cf82e371d4.png" alt="strace 1808105"></p>
<p>嗯，如预期一样，测试没有问题。</p>
<p>当然这里实际上可能细心的朋友发现，原本的 tini 也没法处理二进制更新的情况，原因和 demo5 里的原因一致。这里大家可以去测试一下</p>
<p>实际上这里我的处理很过于粗糙和暴力，我们实际上只要保证让 tini 的退出条件变成<strong>一定要等到 waitpid()=-1 &amp;&amp; errno==EHILD再退出</strong>。具体的实现手段大家可以一起来思考（实际上还不少</p>
<p>最后来总结一下问题的核心：</p>
<p>无论是 dumb-init 还是 tini 在现行的实现里，都犯了同一个错误，即在容器这个特殊的场景下，都没有等待所有子孙进程的退出再退出。其实解决方案很简单，退出条件一定要是 <strong>waitpid()=-1 &amp;&amp; errno==EHILD</strong></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文吐槽了 dumb-init 和 tini。dumb—init 实现属实拉跨，tini 的实现细腻了很多。但是 tini 依旧存在不可靠的行为，以及我们所期待的 fork 二进制更新这种使用一号进程的场景在 dumb-init 和 tini 上都没法实现。而且 dumb-init 和 tini 目前也还有一个共通的局限性。即无法处理子进程进程组逃逸的情况。（比如十个子进程各自逃逸到一个进程组中）。</p>
<p>而且在文中的测试中，我们用 <code>time.sleep(1)</code> 来模拟 Graceful Shutdown 的行为，tini 也已经无法满足需求了。。So。。。。</p>
<p>所以归根到底一句话，应用的信号，进程回收这些基础行为应该应用自决。任何管杀不管埋而寄托于一号进程的行为，都是对于生产的不负责任。（如果你们实在想要一个一号进程，还是用 tini 吧，千万别用 dumb-init)</p>
<p>所以 exec 裸起大法好，不用一号进程平安保！</p>
<p>差不多水文就这样吧，这篇水文从提出问题到验证结论，到 patch PoC 报销了我快一个星期的业余时间（本文初稿在凌晨4点过写完）。最后感谢某川同学和我一起搞了几个凌晨三点过。最后，祝大家看的愉快。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>继续爆论容器中的一号进程</p><p><a href="http://manjusaka.itscoder.com/posts/2021/02/28/damn-the-init-process/">http://manjusaka.itscoder.com/posts/2021/02/28/damn-the-init-process/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Manjusaka</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-02-28</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-04-19</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E7%BC%96%E7%A8%8B/">编程</a><a class="link-muted mr-2" rel="tag" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="link-muted mr-2" rel="tag" href="/tags/%E6%B0%B4%E6%96%87/">水文</a><a class="link-muted mr-2" rel="tag" href="/tags/Linux/">Linux</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/2021/04/11/a-simple-introduce-about-ci-cd/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">当我们在聊 CI/CD 时，我们在聊什么？</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/2021/02/13/a-simple-introduction-about-the-init-process-in-container/"><span class="level-item">简单聊聊容器中的一号进程</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://manjusaka.itscoder.com/posts/2021/02/28/damn-the-init-process/';
            this.page.identifier = '/posts/2021/02/28/damn-the-init-process/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'manjusakablog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://user-images.githubusercontent.com/7054676/56820343-2fe1b580-687e-11e9-8f6f-778df3a8eafd.png" alt="Manjusaka"></figure><p class="title is-size-4 is-block line-height-inherit">Manjusaka</p><p class="is-size-6 is-block">Stay simple &amp;&amp; Stay Naive</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">58</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">28</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">45</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="/" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Zheaoli"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Manjusaka_Lee"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Telegram" href="https://t.me/ManjusakaL"><i class="fab fa-telegram"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex" href="#正文"><span class="mr-2">1</span><span>正文</span></a><ul class="menu-list"><li><a class="is-flex" href="#我们为什么需要一个一号进程，我们希望的一号进程需要承担怎样的职责？"><span class="mr-2">1.1</span><span>我们为什么需要一个一号进程，我们希望的一号进程需要承担怎样的职责？</span></a></li><li><a class="is-flex" href="#拉跨的-dumb-init"><span class="mr-2">1.2</span><span>拉跨的 dumb-init</span></a></li><li><a class="is-flex" href="#态度友好的聊聊-tini"><span class="mr-2">1.3</span><span>态度友好的聊聊 tini</span></a></li></ul></li><li><a class="is-flex" href="#总结"><span class="mr-2">2</span><span>总结</span></a></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://pythonhunter.org/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">捕蛇者说</span></span><span class="level-right"><span class="level-item tag">pythonhunter.org</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://laike9m.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">laike9m&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">laike9m.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://darkof.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Adam Wen&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">darkof.me</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://www.kawabangga.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">卡瓦邦噶</span></span><span class="level-right"><span class="level-item tag">www.kawabangga.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://jaeger.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">写代码的猴子</span></span><span class="level-right"><span class="level-item tag">jaeger.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://www.kilerd.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">你好，耳先生</span></span><span class="level-right"><span class="level-item tag">www.kilerd.me</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://brucezz.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">小天</span></span><span class="level-right"><span class="level-item tag">brucezz.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://yongyu.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">用语</span></span><span class="level-right"><span class="level-item tag">yongyu.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://showzeng.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">showzeng</span></span><span class="level-right"><span class="level-item tag">showzeng.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://extremej.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">extremej</span></span><span class="level-right"><span class="level-item tag">extremej.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://melodyxxx.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">melodyxxx</span></span><span class="level-right"><span class="level-item tag">melodyxxx.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://melo.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">melo</span></span><span class="level-right"><span class="level-item tag">melo.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://hymane.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">hymane</span></span><span class="level-right"><span class="level-item tag">hymane.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://imxie.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">imxie</span></span><span class="level-right"><span class="level-item tag">imxie.itscoder.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://www.iamlj.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Jing&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">www.iamlj.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://xiaxichen.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">夏溪辰</span></span><span class="level-right"><span class="level-item tag">xiaxichen.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://ymkiux.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ymkiux</span></span><span class="level-right"><span class="level-item tag">ymkiux.github.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/%E4%BA%BA%E7%94%9F/"><span class="level-start"><span class="level-item">人生</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E4%BA%BA%E7%94%9F/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E4%BA%BA%E9%97%B4%E4%B8%96/"><span class="level-start"><span class="level-item">人间世</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E5%B7%A5%E5%85%B7/%E8%BE%93%E5%85%A5%E6%B3%95/"><span class="level-start"><span class="level-item">输入法</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E5%B7%A5%E5%85%B7/%E8%BE%93%E5%85%A5%E6%B3%95/Rime/"><span class="level-start"><span class="level-item">Rime</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%94%9F%E6%B4%BB/"><span class="level-start"><span class="level-item">生活</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%94%9F%E6%B4%BB/%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81/"><span class="level-start"><span class="level-item">电子产品</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%A4%BE%E4%BC%9A/"><span class="level-start"><span class="level-item">社会</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%A4%BE%E4%BC%9A/PKU/"><span class="level-start"><span class="level-item">PKU</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">编程</span></span><span class="level-end"><span class="level-item tag">46</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/Linux/Kernel/"><span class="level-start"><span class="level-item">Kernel</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/Python/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/Python/PEP484/"><span class="level-start"><span class="level-item">PEP484</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/Python/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/leetcode/"><span class="level-start"><span class="level-item">leetcode</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/leetcode/%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">刷题</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/%E6%B0%B4%E6%96%87/"><span class="level-start"><span class="level-item">水文</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/%E6%B0%B4%E6%96%87/%E8%AE%BA%E6%96%87/"><span class="level-start"><span class="level-item">论文</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">网络编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/%E7%BF%BB%E8%AF%91/"><span class="level-start"><span class="level-item">翻译</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/%E9%9A%8F%E6%83%B3/"><span class="level-start"><span class="level-item">随想</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/"><span class="level-start"><span class="level-item">总结</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/%E7%A7%80%E6%81%A9%E7%88%B1/"><span class="level-start"><span class="level-item">秀恩爱</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-04-17T17:09:00.000Z">2021-04-17</time></p><p class="title is-6"><a class="link-muted" href="/posts/2021/04/17/how-to-tracing-package-in-the-linux-kernel/">利用动态 tracing 技术来 trace 内核中的网络请求</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a> / <a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Linux/">Linux</a> / <a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Linux/Kernel/">Kernel</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-04-11T15:09:00.000Z">2021-04-11</time></p><p class="title is-6"><a class="link-muted" href="/posts/2021/04/11/a-simple-introduce-about-ci-cd/">当我们在聊 CI/CD 时，我们在聊什么？</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a> / <a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/%E6%9D%82%E8%AE%B0/">杂记</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-28T03:00:00.000Z">2021-02-28</time></p><p class="title is-6"><a class="link-muted" href="/posts/2021/02/28/damn-the-init-process/">继续爆论容器中的一号进程</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a> / <a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-13T17:00:00.000Z">2021-02-13</time></p><p class="title is-6"><a class="link-muted" href="/posts/2021/02/13/a-simple-introduction-about-the-init-process-in-container/">简单聊聊容器中的一号进程</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a> / <a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-11T13:00:00.000Z">2021-02-11</time></p><p class="title is-6"><a class="link-muted" href="/posts/2021/02/11/do-anything-you-want/">但行好事，莫问前程</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a> / <a class="link-muted" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/">总结</a> / <a class="link-muted" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/%E7%A7%80%E6%81%A9%E7%88%B1/">秀恩爱</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/07/"><span class="level-start"><span class="level-item">July 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/02/"><span class="level-start"><span class="level-item">February 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/12/"><span class="level-start"><span class="level-item">December 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/11/"><span class="level-start"><span class="level-item">November 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/10/"><span class="level-start"><span class="level-item">October 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/09/"><span class="level-start"><span class="level-item">September 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/08/"><span class="level-start"><span class="level-item">August 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/07/"><span class="level-start"><span class="level-item">July 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Apple/"><span class="tag">Apple</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Flask/"><span class="tag">Flask</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Objective-C/"><span class="tag">Objective-C</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PEP/"><span class="tag">PEP</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PEP484/"><span class="tag">PEP484</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PKU/"><span class="tag">PKU</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">26</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SystemTap/"><span class="tag">SystemTap</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unix/"><span class="tag">Unix</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/async/"><span class="tag">async</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/eBPF/"><span class="tag">eBPF</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leetcode/"><span class="tag">leetcode</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"><span class="tag">云原生</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F/"><span class="tag">人生</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E9%97%B4%E4%B8%96/"><span class="tag">人间世</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"><span class="tag">分布式</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%B7%E9%A2%98/"><span class="tag">刷题</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%8F%E7%A8%8B/"><span class="tag">协程</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%90%90%E6%A7%BD/"><span class="tag">吐槽</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/"><span class="tag">工具</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="tag">并发编程</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%80%BB%E7%BB%93/"><span class="tag">总结</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%98%E9%87%91%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92/"><span class="tag">掘金翻译计划</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%AE%B0/"><span class="tag">杂记</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B0%B4%E6%96%87/"><span class="tag">水文</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><span class="tag">源码剖析</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><span class="tag">源码阅读</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81/"><span class="tag">电子产品</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A4%BE%E4%BC%9A/"><span class="tag">社会</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A7%80%E6%81%A9%E7%88%B1/"><span class="tag">秀恩爱</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AC%94%E8%AE%B0/"><span class="tag">笔记</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B/"><span class="tag">编程</span><span class="tag is-grey-lightest">45</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/"><span class="tag">编程技巧</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="tag">网络编程</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BA%E6%96%87/"><span class="tag">论文</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AF%84%E6%B5%8B/"><span class="tag">评测</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BE%93%E5%85%A5%E6%B3%95/"><span class="tag">输入法</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E6%83%B3/"><span class="tag">随想</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E7%AC%94/"><span class="tag">随笔</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%BB%91%E9%AD%94%E6%B3%95/"><span class="tag">黑魔法</span><span class="tag is-grey-lightest">2</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://user-images.githubusercontent.com/7054676/56820277-0a54ac00-687e-11e9-9f34-f79089938638.png" alt="Manjusaka" height="28"></a><p class="size-small"><span>&copy; 2021 Manjusaka</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Zheaoli/manjusaka-blog"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>
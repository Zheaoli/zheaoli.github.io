<!DOCTYPE html><html lang=en data-theme=auto><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>简单聊聊进程中的信号处理 V2 | Manjusaka</title><meta name=author content=Manjusaka><meta name=copyright content=Manjusaka><meta name=format-detection content="telephone=no"><meta name=theme-color content=ffffff><meta name=description content="上次写了一个水文简单聊聊进程中的信号处理 ，师父看了后把我怒斥了一顿，表示上篇水文中的例子太 old style, too simple ,too naive。如果未来出了偏差，我也要负泽任的。吓得我连和妹子周年庆的文章都没写，先赶紧来重新水一篇文章，聊聊更优秀，更方便的信号处理方式"><meta property=og:type content=article><meta property=og:title content="简单聊聊进程中的信号处理 V2"><meta property=og:url content=https://www.manjusaka.blog/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/index.html><meta property=og:site_name content=Manjusaka><meta property=og:description content="上次写了一个水文简单聊聊进程中的信号处理 ，师父看了后把我怒斥了一顿，表示上篇水文中的例子太 old style, too simple ,too naive。如果未来出了偏差，我也要负泽任的。吓得我连和妹子周年庆的文章都没写，先赶紧来重新水一篇文章，聊聊更优秀，更方便的信号处理方式"><meta property=og:locale content=en_US><meta property=og:image content=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg><meta property=article:published_time content=2020-11-07T13:09:00.000Z><meta property=article:modified_time content=2025-05-25T18:20:19.580Z><meta property=article:author content=Manjusaka><meta property=article:tag content=编程><meta property=article:tag content=Linux><meta property=article:tag content=笔记><meta property=article:tag content=水文><meta name=twitter:card content=summary><meta name=twitter:image content="https://avatars.githubusercontent.com/u/7054676?v=4"><meta name=twitter:creator content=@Manjusaka_Lee><meta name=twitter:site content=https://twitter.com/Manjusaka_Lee><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "简单聊聊进程中的信号处理 V2",
  "url": "https://www.manjusaka.blog/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/",
  "image": "https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg",
  "datePublished": "2020-11-07T13:09:00.000Z",
  "dateModified": "2025-05-25T18:20:19.580Z",
  "author": [
    {
      "@type": "Person",
      "name": "Manjusaka",
      "url": "https://github.com/Zheaoli"
    }
  ]
}</script><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/7054676?v=4"><link rel=canonical href=https://www.manjusaka.blog/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/index.html><link rel=preconnect href=//cdn.jsdelivr.net><link rel=preconnect href=//www.google-analytics.com crossorigin=""><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css media=print onload='this.media="all"'><script>(()=>{let t={set:(e,t,a)=>{a&&(a=Date.now()+864e5*a,localStorage.setItem(e,JSON.stringify({value:t,expiry:a})))},get:e=>{var t=localStorage.getItem(e);if(t){var{value:t,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return t;localStorage.removeItem(e)}}},a=(window.btf={saveToLocal:t,getScript:(o,r={})=>new Promise((e,t)=>{let a=document.createElement("script");a.src=o,a.async=!0,Object.entries(r).forEach(([e,t])=>a.setAttribute(e,t)),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),getCSS:(o,r)=>new Promise((e,t)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,r&&(a.id=r),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),addGlobalFn:(e,t,a=!1,o=window)=>{var r;e.startsWith("pjax")||((r=o.globalFn||{})[e]=r[e]||{},r[e][a||Object.keys(r[e]).length]=t,o.globalFn=r)}},()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")}),o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};btf.activateDarkMode=a,btf.activateLightMode=o;var r=t.get("theme"),n=window.matchMedia("(prefers-color-scheme: dark)"),d=window.matchMedia("(prefers-color-scheme: light)"),d=(void 0===r?((!d.matches&&(n.matches||(d=(new Date).getHours())<=6||18<=d)?a:o)(),n.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?a:o)()})):("light"===r?o:a)(),t.get("aside-status"));void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async=async src="https://www.googletagmanager.com/gtag/js?id=UA-154407994-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-154407994-1"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","UA-154407994-1",{page_path:window.location.pathname})},"google_analytics")</script><script>let GLOBAL_CONFIG={root:"/",algolia:{appId:"DL1RURGHTB",indexName:"manjusaka.blog",hitsPerPage:6,languages:{input_placeholder:"Search",hits_empty:"No results found for: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!0,post:!0},runtime:"",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:{limitCount:100,languages:{author:"Author: Manjusaka",link:"Link: ",source:"Source: Manjusaka",info:"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},lightbox:"null",Snackbar:{chs_to_cht:"You have switched to Traditional Chinese",cht_to_chs:"You have switched to Simplified Chinese",day_to_night:"You have switched to Dark Mode",night_to_day:"You have switched to Light Mode",bgLight:"#59C173",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!0,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"简单聊聊进程中的信号处理 V2",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/assets/font-awesome-animation.min.css media=defer onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/tag_plugins.css media=defer onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/assets/carousel-touch.js></script><meta name=generator content="Hexo 7.3.0"><link rel=alternate href=/atom.xml title=Manjusaka type=application/atom+xml></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>Loading...</div></div></div><script>(()=>{let e=document.getElementById("loading-box"),d=document.body;const o=()=>{d.style.overflow="",e.classList.add("loaded")},l=()=>{d.style.overflow="hidden",e.classList.remove("loaded")};l(),window.addEventListener("load",o)})()</script><div id=web_bg style="background-image:url('url(https://cdn.jsdelivr.net/gh/youngjuning/images@main/1680450445599.png)')"></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class="site-data text-center"><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>102</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>58</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>39</div></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div></div></div><div class="post type-tags" id=body-wrap><header class=post-bg id=page-header style=background-image:url(https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg)><nav id=nav><span id=blog-info><a class=nav-site-title href=/ ><img class=site-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4# image" alt=Logo><span class=site-name>Manjusaka</span></a><a class=nav-page-title href=/ ><span class=site-name>简单聊聊进程中的信号处理 V2</span></a></span><div id=menus><div id=search-button><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div><div id=toggle-menu><span class=site-page><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id=post-info><h1 class=post-title>简单聊聊进程中的信号处理 V2<a class=post-edit-link href=https://github.com/Zheaoli/Zheaoli.github.io/edit/main/source/_posts/a-simple-introduction-about-signal-process-in-linux-v2.md rel="external nofollow noreferrer" title=Edit target=_blank><i class="fas fa-pencil-alt"></i></a></h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class=post-meta-label>Created</span><time datetime=2020-11-07T13:09:00.000Z title="Created 2020-11-07 21:09:00">2020-11-07</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/ >编程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/Linux/ >Linux</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>Word Count:</span><span class=word-count>2.4k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>Reading Time:</span><span>9mins</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>Post Views:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class="container post-content" id=article-container><div id=post-outdate-notice data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-05-26 02:20:19&quot;}" hidden></div><p>上次写了一个水文<a href=https://manjusaka.itscoder.com/posts/2020/10/24/a-simple-introduction-about-signal-process-in-linux/ rel="external nofollow noreferrer">简单聊聊进程中的信号处理</a> ，师父看了后把我怒斥了一顿，表示上篇水文中的例子太 old style, too simple ,too naive。如果未来出了偏差，我也要负泽任的。吓得我连和妹子周年庆的文章都没写，先赶紧来重新水一篇文章，聊聊更优秀，更方便的信号处理方式</p><span id=more></span><h2 id=前情提要><a href=#前情提要 class=headerlink title=前情提要></a>前情提要</h2><p>首先来看看，之前那篇文章中的例子</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;errno.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;signal.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;sys/wait.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;unistd.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">deletejob</span><span class=params>(<span class=type>pid_t</span> pid)</span> &#123; <span class=built_in>printf</span>(<span class=string>&quot;delete task %d\n&quot;</span>, pid); &#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">addjob</span><span class=params>(<span class=type>pid_t</span> pid)</span> &#123; <span class=built_in>printf</span>(<span class=string>&quot;add task %d\n&quot;</span>, pid); &#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">handler</span><span class=params>(<span class=type>int</span> sig)</span> &#123;</span><br><span class=line>  <span class=type>int</span> olderrno = errno;</span><br><span class=line>  <span class=type>sigset_t</span> mask_all, prev_all;</span><br><span class=line>  <span class=type>pid_t</span> pid;</span><br><span class=line>  sigfillset(&amp;mask_all);</span><br><span class=line>  <span class=keyword>while</span> ((pid = waitpid(<span class=number>-1</span>, <span class=literal>NULL</span>, <span class=number>0</span>)) &gt; <span class=number>0</span>) &#123;</span><br><span class=line>    sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev_all);</span><br><span class=line>    deletejob(pid);</span><br><span class=line>    sigprocmask(SIG_SETMASK, &amp;prev_all, <span class=literal>NULL</span>);</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=keyword>if</span> (errno != ECHILD) &#123;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;waitpid error&quot;</span>);</span><br><span class=line>  &#125;</span><br><span class=line>  errno = olderrno;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>(<span class=type>int</span> argc, <span class=type>char</span> **argv)</span> &#123;</span><br><span class=line>  <span class=type>int</span> pid;</span><br><span class=line>  <span class=type>sigset_t</span> mask_all, prev_all;</span><br><span class=line>  sigfillset(&amp;mask_all);</span><br><span class=line>  signal(SIGCHLD, handler);</span><br><span class=line>  <span class=keyword>while</span> (<span class=number>1</span>) &#123;</span><br><span class=line>    <span class=keyword>if</span> ((pid = fork()) == <span class=number>0</span>) &#123;</span><br><span class=line>      execve(<span class=string>&quot;/bin/date&quot;</span>, argv, <span class=literal>NULL</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev_all);</span><br><span class=line>    addjob(pid);</span><br><span class=line>    sigprocmask(SIG_SETMASK, &amp;prev_all, <span class=literal>NULL</span>);</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>再来复习下几个关键的 <code>syscall</code></p><ol><li><strong>signal</strong><a href=#refer-anchor-1><sup>1</sup></a>: 信号处理函数，使用者可以通过这个函数为当前进程指定具体信号的 Handler。当信号触发时，系统会调用具体的 Handler 进行对应的逻辑处理。</li><li><strong>sigfillset</strong><a href=#refer-anchor-2><sup>2</sup></a>: 用于操作 <strong>signal sets</strong>（信号集）的函数之一，这里的含义是将系统所有支持的信号量添加进一个信号集中</li><li><strong>fork</strong><a href=#refer-anchor-3><sup>3</sup></a>: 大家比较熟悉的一个 API 了，创建一个新的进程，并返回 <strong>pid</strong> 。如果是在父进程中，返回的 <strong>pid</strong> 是对应子进程的 <strong>pid</strong>。如果子进程中，<strong>pid</strong> 为0</li><li><strong>execve</strong><a href=#refer-anchor-4><sup>4</sup></a>: 执行一个特定的可执行文件</li><li><strong>sigprocmask</strong><a href=#refer-anchor-5><sup>5</sup></a>：设置进程的信号屏蔽集。当传入第一个参数为 <strong>SIG_BLOCK</strong> 时，函数会将当前进程的信号屏蔽集保存在第三个参数传入的信号集变量中，并将当前进程的信号屏蔽集设置为第二个参数传入的信号屏蔽集。当第一个参数为 <strong>SIG_SETMASK</strong> 时，函数会将当前进程的信号屏蔽集设置为第二个参数设置的值。</li><li><strong>wait_pid</strong><a href=#refer-anchor-6><sup>6</sup></a>: 做一个不精确的概括，回收并释放已终止的子进程的资源。</li></ol><p>好了，复习完关键点之后，开始进入本文的关键部分。</p><h2 id=更优雅的信号处理手段><a href=#更优雅的信号处理手段 class=headerlink title=更优雅的信号处理手段></a>更优雅的信号处理手段</h2><h3 id=更优雅的-handler><a href=#更优雅的-handler class=headerlink title="更优雅的 handler"></a>更优雅的 handler</h3><p>首先再来看看上面信号处理部分的代码</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=type>void</span> <span class="title function_">handler</span><span class=params>(<span class=type>int</span> sig)</span> &#123;</span><br><span class=line>  <span class=type>int</span> olderrno = errno;</span><br><span class=line>  <span class=type>sigset_t</span> mask_all, prev_all;</span><br><span class=line>  <span class=type>pid_t</span> pid;</span><br><span class=line>  sigfillset(&amp;mask_all);</span><br><span class=line>  <span class=keyword>while</span> ((pid = waitpid(<span class=number>-1</span>, <span class=literal>NULL</span>, <span class=number>0</span>)) &gt; <span class=number>0</span>) &#123;</span><br><span class=line>    sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev_all);</span><br><span class=line>    deletejob(pid);</span><br><span class=line>    sigprocmask(SIG_SETMASK, &amp;prev_all, <span class=literal>NULL</span>);</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=keyword>if</span> (errno != ECHILD) &#123;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;waitpid error&quot;</span>);</span><br><span class=line>  &#125;</span><br><span class=line>  errno = olderrno;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>这里我们为了保证 <code>handler</code> 不被其余的信号打断，所以我们在处理的时候使用 <code>sigprocmask</code> + <code>SIG_BLOCK</code> 来做信号屏蔽。这样看起来逻辑上没啥问题，但是有个问题。当我们有其余很多不同 <code>handler</code> 的时候，我们势必会生成很多重复冗余的代码。那么我们有没有更优雅的方法来保证我们的 <code>handler</code> 的安全呢？</p><p>有（超大声（好，很有精神！（逃。隆重介绍一个新的 <strong>syscall</strong> -&gt; <strong>sigaction</strong><a href=#refer-anchor-7><sup>7</sup></a></p><p>废话不多说，先上代码</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;errno.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;signal.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;sys/wait.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;unistd.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">deletejob</span><span class=params>(<span class=type>pid_t</span> pid)</span> &#123; <span class=built_in>printf</span>(<span class=string>&quot;delete task %d\n&quot;</span>, pid); &#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">addjob</span><span class=params>(<span class=type>pid_t</span> pid)</span> &#123; <span class=built_in>printf</span>(<span class=string>&quot;add task %d\n&quot;</span>, pid); &#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">handler</span><span class=params>(<span class=type>int</span> sig)</span> &#123;</span><br><span class=line>  <span class=type>int</span> olderrno = errno;</span><br><span class=line>  <span class=type>sigset_t</span> mask_all, prev_all;</span><br><span class=line>  <span class=type>pid_t</span> pid;</span><br><span class=line>  sigfillset(&amp;mask_all);</span><br><span class=line>  <span class=keyword>while</span> ((pid = waitpid(<span class=number>-1</span>, <span class=literal>NULL</span>, <span class=number>0</span>)) &gt; <span class=number>0</span>) &#123;</span><br><span class=line>    deletejob(pid);</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=keyword>if</span> (errno != ECHILD) &#123;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;waitpid error&quot;</span>);</span><br><span class=line>  &#125;</span><br><span class=line>  errno = olderrno;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>(<span class=type>int</span> argc, <span class=type>char</span> **argv)</span> &#123;</span><br><span class=line>  <span class=type>int</span> pid;</span><br><span class=line>  <span class=type>sigset_t</span> mask_all, prev_all;</span><br><span class=line>  sigfillset(&amp;mask_all);</span><br><span class=line>  <span class=class><span class=keyword>struct</span> <span class=title>sigaction</span> <span class=title>new_action</span>;</span></span><br><span class=line>  new_action.sa_handler=handler;</span><br><span class=line>  new_action.sa_mask=mask_all;</span><br><span class=line>  signal(SIGCHLD, handler);</span><br><span class=line>  <span class=keyword>while</span> (<span class=number>1</span>) &#123;</span><br><span class=line>    <span class=keyword>if</span> ((pid = fork()) == <span class=number>0</span>) &#123;</span><br><span class=line>      execve(<span class=string>&quot;/bin/date&quot;</span>, argv, <span class=literal>NULL</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev_all);</span><br><span class=line>    addjob(pid);</span><br><span class=line>    sigprocmask(SIG_SETMASK, &amp;prev_all, <span class=literal>NULL</span>);</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>好！很有精神！大家可能发现了，我们这段代码相较于之前的代码增加了关于 sigaction 相关的设置。难道？</p><p>yep，在 <strong>sigaction</strong> 中，我们可以通过设置 <code>sa_mask</code> 来设置当信号处理函数执行期间，进程将阻塞哪些信号。</p><p>你看，这样我们的代码是不是相较于之前更为优雅了。当然，<strong>sigaction</strong> 还有很多其余很有用的设置项，大家可以下来了解一下。</p><h3 id=更快速的信号处理方式><a href=#更快速的信号处理方式 class=headerlink title=更快速的信号处理方式></a>更快速的信号处理方式</h3><p>在我们上面的例子中，我们已经解决了优雅的设置信号处理函数这样的问题，那么我们现在又面临了一个全新的问题。</p><p>如上面所说，我们信号处理函数在执行时，我们选择阻塞了其余的信号。那么这里存在一个问题，当我们在信号处理函数中的逻辑耗时较长，且不需要原子性（即需要和信号处理函数保持同步），而且系统中的信号发生频率较高。那么我们这样的做法将会导致进程的信号队列不断增加，进而导致不可预料的后果。</p><p>那么我们这里有什么更好的方法来处理这件事呢？</p><p>假设，我们打开一个文件，在信号处理函数中只完成一件事，就是往这个文件中写一个特定的值。然后我们轮询这个文件，如果一旦发生变化，那么我们读取文件中的值，判断具体的信号，做具体的信号处理，这样是不是既保证了信号的妥投，又保证我们信号处理逻辑将阻塞信号的代价降至最低了？</p><p>当然，当然，社区知道大家嫌写代码难，所以专门给大家提供了一个船新的 <code>syscall</code> -&gt; <strong>signalfd</strong><a href=#refer-anchor-8><sup>8</sup></a></p><p>老规矩，先来看看例子</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;errno.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;signal.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;sys/epoll.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;sys/signalfd.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;sys/wait.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> MAXEVENTS 64</span></span><br><span class=line><span class=type>void</span> <span class="title function_">deletejob</span><span class=params>(<span class=type>pid_t</span> pid)</span> &#123; <span class=built_in>printf</span>(<span class=string>&quot;delete task %d\n&quot;</span>, pid); &#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">addjob</span><span class=params>(<span class=type>pid_t</span> pid)</span> &#123; <span class=built_in>printf</span>(<span class=string>&quot;add task %d\n&quot;</span>, pid); &#125;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>(<span class=type>int</span> argc, <span class=type>char</span> **argv)</span> &#123;</span><br><span class=line>  <span class=type>int</span> pid;</span><br><span class=line>  <span class=class><span class=keyword>struct</span> <span class=title>epoll_event</span> <span class=title>event</span>;</span></span><br><span class=line>  <span class=class><span class=keyword>struct</span> <span class=title>epoll_event</span> *<span class=title>events</span>;</span></span><br><span class=line>  <span class=type>sigset_t</span> mask;</span><br><span class=line>  sigemptyset(&amp;mask);</span><br><span class=line>  sigaddset(&amp;mask, SIGCHLD);</span><br><span class=line>  <span class=keyword>if</span> (sigprocmask(SIG_SETMASK, &amp;mask, <span class=literal>NULL</span>) &lt; <span class=number>0</span>) &#123;</span><br><span class=line>    perror(<span class=string>&quot;sigprocmask&quot;</span>);</span><br><span class=line>    <span class=keyword>return</span> <span class=number>1</span>;</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=type>int</span> sfd = signalfd(<span class=number>-1</span>, &amp;mask, <span class=number>0</span>);</span><br><span class=line>  <span class=type>int</span> epoll_fd = epoll_create(MAXEVENTS);</span><br><span class=line>  event.events = EPOLLIN | EPOLLEXCLUSIVE | EPOLLET;</span><br><span class=line>  event.data.fd = sfd;</span><br><span class=line>  <span class=type>int</span> s = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, sfd, &amp;event);</span><br><span class=line>  <span class=keyword>if</span> (s == <span class=number>-1</span>) &#123;</span><br><span class=line>    <span class=built_in>abort</span>();</span><br><span class=line>  &#125;</span><br><span class=line>  events = <span class=built_in>calloc</span>(MAXEVENTS, <span class=keyword>sizeof</span>(event));</span><br><span class=line>  <span class=keyword>while</span> (<span class=number>1</span>) &#123;</span><br><span class=line>    <span class=type>int</span> n = epoll_wait(epoll_fd, events, MAXEVENTS, <span class=number>1</span>);</span><br><span class=line>    <span class=keyword>if</span> (n == <span class=number>-1</span>) &#123;</span><br><span class=line>      <span class=keyword>if</span> (errno == EINTR) &#123;</span><br><span class=line>        <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;epoll EINTR error\n&quot;</span>);</span><br><span class=line>      &#125; <span class=keyword>else</span> <span class=keyword>if</span> (errno == EINVAL) &#123;</span><br><span class=line>        <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;epoll EINVAL error\n&quot;</span>);</span><br><span class=line>      &#125; <span class=keyword>else</span> <span class=keyword>if</span> (errno == EFAULT) &#123;</span><br><span class=line>        <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;epoll EFAULT error\n&quot;</span>);</span><br><span class=line>        <span class=built_in>exit</span>(<span class=number>-1</span>);</span><br><span class=line>      &#125; <span class=keyword>else</span> <span class=keyword>if</span> (errno == EBADF) &#123;</span><br><span class=line>        <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;epoll EBADF error\n&quot;</span>);</span><br><span class=line>        <span class=built_in>exit</span>(<span class=number>-1</span>);</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;%d\n&quot;</span>, n);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; n; i++) &#123;</span><br><span class=line>      <span class=keyword>if</span> ((events[i].events &amp; EPOLLERR) || (events[i].events &amp; EPOLLHUP) ||</span><br><span class=line>          (!(events[i].events &amp; EPOLLIN))) &#123;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;%d\n&quot;</span>, i);</span><br><span class=line>        <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;epoll err\n&quot;</span>);</span><br><span class=line>        close(events[i].data.fd);</span><br><span class=line>        <span class=keyword>continue</span>;</span><br><span class=line>      &#125; <span class=keyword>else</span> <span class=keyword>if</span> (sfd == events[i].data.fd) &#123;</span><br><span class=line>        <span class=keyword>struct</span> signalfd_siginfo si;</span><br><span class=line>        <span class=type>ssize_t</span> res = read(sfd, &amp;si, <span class=keyword>sizeof</span>(si));</span><br><span class=line>        <span class=keyword>if</span> (res &lt; <span class=number>0</span>) &#123;</span><br><span class=line>          <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;read error\n&quot;</span>);</span><br><span class=line>          <span class=keyword>continue</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>if</span> (res != <span class=keyword>sizeof</span>(si)) &#123;</span><br><span class=line>          <span class=built_in>fprintf</span>(<span class=built_in>stderr</span>, <span class=string>&quot;Something wrong\n&quot;</span>);</span><br><span class=line>          <span class=keyword>continue</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>if</span> (si.ssi_signo == SIGCHLD) &#123;</span><br><span class=line>          <span class=built_in>printf</span>(<span class=string>&quot;Got SIGCHLD\n&quot;</span>);</span><br><span class=line>          <span class=type>int</span> child_pid = waitpid(<span class=number>-1</span>, <span class=literal>NULL</span>, <span class=number>0</span>);</span><br><span class=line>          deletejob(child_pid);</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>if</span> ((pid = fork()) == <span class=number>0</span>) &#123;</span><br><span class=line>      execve(<span class=string>&quot;/bin/date&quot;</span>, argv, <span class=literal>NULL</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    addjob(pid);</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>好了，我们来介绍下这段代码中的一些关键点</p><ol><li>signalfd 是一类特殊的文件描述符，这个文件可读，可 <strong>select</strong> 。当我们指定的信号发生时，我们可以从返回的 fd 中读取到具体的信号值。</li><li><strong>signalfd</strong> 优先级比信号处理函数低。换句话说，假设我们为信号 <strong>SIGCHLD</strong> 注册了信号处理函数，同时也为其注册了 <strong>signalfd</strong> 那么当信号发生时，将优先调用信号处理函数。所以我们在使用 <strong>signalfd</strong> 时，需要利用 <strong>sigprocmask</strong> 设置进程的信号屏蔽集。</li><li>如前面所说，该文件描述符可 <strong>select</strong> ，换句话说，我们可以利用 <strong>select</strong><a href=#refer-anchor-9><sup>9</sup></a>, <strong>poll</strong><a href=#refer-anchor-10><sup>10</sup></a>, <strong>epoll</strong><a href=#refer-anchor-11><sup>11</sup></a><a href=#refer-anchor-12><sup>12</sup></a> 等函数来对 fd 进行监听。在上面的的代码中，我们就利用 <strong>epoll</strong> 对 <strong>signalfd</strong> 进行监听</li></ol><p>当然，这里额外要注意的一点是，很多语言不一定提供了官方的 <strong>signalfd</strong> 的 API（如 Python），但是也有可能提供了等价的替代品，典型的例子就是 Python 中的 <strong>signal.set_wakeup_fd</strong><a href=#refer-anchor-13><sup>13</sup></a></p><p>在这里也给大家留一个思考题：除了利用 <strong>signalfd</strong> ，还有什么方法可以实现高效，安全的信号处理？</p><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><p>私以为信号处理是作为一个研发的基本功，我们需要安全，可靠的处理在程序环境中遇到的各种信号。而系统也提供了很多设计很优秀的 API 来减轻研发的负担。但是我们要知道，信号本质上是通讯手段的一种。而其天生的弊端便是携带的信息较少。很多时候，当我们有很多高频的信息传递需要去做的时候，这个时候可能利用信号并不是一个很好的选择。当然这个并没有定论。只能 case by case 的去做 trade-off。</p><p>差不多就这样吧，本周第二篇水文混完（逃</p><h2 id=Reference><a href=#Reference class=headerlink title=Reference></a>Reference</h2><div id=refer-anchor-1></div><ul><li>[1]. <a href=https://man7.org/linux/man-pages/man7/signal.7.html rel="external nofollow noreferrer">Linux man page: signal</a></li></ul><div id=refer-anchor-2></div><ul><li>[2]. <a href=https://linux.die.net/man/3/sigfillset rel="external nofollow noreferrer">Linux man page: sigfillset</a></li></ul><div id=refer-anchor-3></div><ul><li>[3]. <a href=https://man7.org/linux/man-pages/man2/fork.2.html rel="external nofollow noreferrer">Linux man page: fork</a></li></ul><div id=refer-anchor-4></div><ul><li>[4]. <a href=https://man7.org/linux/man-pages/man2/execve.2.html rel="external nofollow noreferrer">Linux man page: execve</a></li></ul><div id=refer-anchor-5></div><ul><li>[5]. <a href=https://man7.org/linux/man-pages/man2/sigprocmask.2.html rel="external nofollow noreferrer">Linux man page: sigprocmask</a></li></ul><div id=refer-anchor-6></div><ul><li>[6]. <a href=https://linux.die.net/man/2/waitpid rel="external nofollow noreferrer">Linux man page: waitpid</a></li></ul><div id=refer-anchor-7></div><ul><li>[7]. <a href=https://www.man7.org/linux/man-pages/man2/sigaction.2.html rel="external nofollow noreferrer">Linux man page: sigaction</a></li></ul><div id=refer-anchor-8></div><ul><li>[8]. <a href=https://www.man7.org/linux/man-pages/man2/sigaction.2.html rel="external nofollow noreferrer">Linux man page: signalfd</a></li></ul><div id=refer-anchor-9></div><ul><li>[9]. <a href=https://man7.org/linux/man-pages/man2/select.2.html rel="external nofollow noreferrer">Linux man page: select</a></li></ul><div id=refer-anchor-10></div><ul><li>[10]. <a href=https://man7.org/linux/man-pages/man2/poll.2.html rel="external nofollow noreferrer">Linux man page: poll</a></li></ul><div id=refer-anchor-11></div><ul><li>[11]. <a href=https://man7.org/linux/man-pages/man2/epoll_ctl.2.html rel="external nofollow noreferrer">Linux man page: epoll_ctl</a></li></ul><div id=refer-anchor-12></div><ul><li>[12]. <a href=https://man7.org/linux/man-pages/man2/epoll_wait.2.html rel="external nofollow noreferrer">Linux man page: epoll_wait</a></li></ul><div id=refer-anchor-13></div><ul><li>[13]. <a href=https://docs.python.org/3/library/signal.html#signal.set_wakeup_fd rel="external nofollow noreferrer">Python Documentation: signal.set_wakeup_fd</a></li></ul></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class=post-copyright-info><a href=https://github.com/Zheaoli rel="external nofollow noreferrer">Manjusaka</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class=post-copyright-info><a href=https://www.manjusaka.blog/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/ >https://www.manjusaka.blog/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class=post-copyright-info>All articles on this blog are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel="external nofollow noreferrer">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/%E7%BC%96%E7%A8%8B/ >编程</a><a class=post-meta__tags href=/tags/Linux/ >Linux</a><a class=post-meta__tags href=/tags/%E7%AC%94%E8%AE%B0/ >笔记</a><a class=post-meta__tags href=/tags/%E6%B0%B4%E6%96%87/ >水文</a></div><div class=post-share><div class=social-share data-image=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js defer=defer></script></div></div><div class=ads-wrap><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-7962287588031867 data-ad-slot=2542544532></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class=pagination-post id=pagination><a class=pagination-related href=/posts/2020/11/06/why-mul-faster-than-bit-shift-sometimes-in-python/ title="为什么有些时候 Python 中乘法比位运算更快"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class=info><div class=info-1><div class=info-item-1>Previous</div><div class=info-item-2>为什么有些时候 Python 中乘法比位运算更快</div></div><div class=info-2><div class=info-item-1>我本来以为我不再会写水文了，但是突然发现自己现在也只能勉强写写水文才能维持生活这样子。那就继续写水文吧 某天，一个技术群里老哥提出了这样一个问题，为什么在一些情况下，Python 中的简单乘/除法比位运算要慢 首先秉持着实事求是的精神，我们先来验证一下 1234567891011In [33]: %timeit 1073741825*2 7.47 ns ± 0.0843 ns per loop (mean ± std. dev. of 7 runs,...</div></div></div></a><a class=pagination-related href=/posts/2020/12/31/fuck-the-cloud-native/ title=云原生时代的几个爆论><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class=info-1><div class=info-item-1>Next</div><div class=info-item-2>云原生时代的几个爆论</div></div><div class=info-2><div class=info-item-1>从去年调转到现在，做了一段时间的云原生，我突发奇想，想发表几个爆论来论述下我眼中的云原生来作为今年最后一篇技术博客。本文纯属个人向吐槽，与本人公司立场无关 概述云原生大概在 2014-2015 年开始左右，开始正式的提出了这个概念。2015 年 Google 主导成立了云原生计算基金会（Cloud Native Computing Foundation aka CNCF)。在 2018 年，CNCF 在 CNCF Cloud Native Definition v1.01 首次对云原生的概念有了一个认定 Cloud native technologies empower organizations to build and run scalable applications in modern, dynamic environments such as public, private, and hybrid clouds. Containers, service meshes, microservices, immutable infrastructure, and...</div></div></div></a></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class=relatedPosts-list><a class=pagination-related href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2025-04-26</div><div class=info-item-2>Python 3.14: Python 世界的一大步</div></div><div class=info-2><div class=info-item-1>Python 3.14 目前主要的一些主要的特性其实已经固定了，在我看来，Python 3.14 是一个未来很多年的一个核心版本。因为其确定了是时代的 Python调试生态的基准，这篇文章将会来聊聊这个 Python 世界中的史诗级改进 正文在我们日常调试 Python 代码的时候，我们经常会遇到这样一个问题，我们需要采样当前的 Python Runtime 的状态，进而进一步调试我们的 Python 进程 常见的手段莫过于两种 通过 eBPF + UProbe 等手段来触发 通过 process_vm_readv 等 Syscall 来直接整块读取内存 无论这两种方式都有一个核心的问题，我们怎么样来解析内存中的数据？ 用 https://github.com/jschwinger233/perf-examples/blob/main/cpython310_backtrace/bpf.c...</div></div></div></a><a class=pagination-related href=/posts/2024/02/10/CVE-2024-21626/ title="简单聊聊 CVE-2024-21626"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2024-02-11</div><div class=info-item-2>简单聊聊 CVE-2024-21626</div></div><div class=info-2><div class=info-item-1>本来这篇文章应该在初一凌晨发的，但是拖延癌晚期，所以到现在才发，得反思下了 背景众所周知，容器逃逸并不是什么令人稀奇的问题了（不被逃逸的容器才是稀奇），2月初，runc 社区正式公布了一个船新的逃逸 CVE，参见 https://github.com/opencontainers/runc/security/advisories/GHSA-xr7r-f8xq-vfvv，版本横跨 1.0 到 1.1.11 这个 CVE 的核心特性在于“可以通过镜像分发的方式，成本很低的进行逃逸” 我们先来复现一下这个问题 我自己的环境是这样 看这篇博客的同学可以参考下面方式进行环境准备， 按照自己的发行版确保安装了，Docker, libseccomp, golang 按照下面方式进行环境安装 1234567891011git clone https://github.com/opencontainers/runcgit checkout v1.1.0-rc.1makesudo rm -rf $(which runc)sudo make installsudo systemctl...</div></div></div></a><a class=pagination-related href=/posts/2021/11/22/a-litte-introduction-about-nohdr-filed-in-skbuff/ title="聊聊 sk_buff 中一个冷门字段: nohdr"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2021-11-22</div><div class=info-item-2>聊聊 sk_buff 中一个冷门字段: nohdr</div></div><div class=info-2><div class=info-item-1>今天遇到一个很有意思的问题，“nohdr 字段到底有什么用”，在这里写个水文简单记录一下 正文前情提要首先来说，不管介绍再冷门的字段，既然涉及到 SKBUFF ，那么就得先来对 sk_buff 做个简单的介绍 简而言之，sk_buff 是 Linux 网络子系统的核心数据结构，从链路层到我们最终对数据包的操作，背后都离不开 sk_buff sk_buff 要完全讲解基本就相当于把 Linux 网络系统完全讲解了，所以讲完是不可能讲完的，这辈子都不可能的！ 简单聊几个关键，可能会帮助大家理解我们本文提到的冷门字段 nohdr 的关键字段吧 首先来讲，最重要的三个字段：data ，mac 和 nh ，分别代表着当前 sk_buff 的数据区的起始地址，L2 header 的起始地址，L3 Header 的起始地址。用一个图方便大家理解 看了图的同学可能会有点明白了，实际上在内核里，也是一层一层的通过指针偏移，不断的添加新的 header 来处理网络请求。和我们直觉相符。可能有同学会问，我既然知道 L3 Header 的起始地址，IP 之类的 L3 协议的 header...</div></div></div></a><a class=pagination-related href=/posts/2023/08/26/a-little-bit-design-about-cpu-burst-in-k8s/ title="关于 CPU Burst 在 K8s 中的一些设计想法"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/08/15/10/sculpture-7776861_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2023-08-27</div><div class=info-item-2>关于 CPU Burst 在 K8s 中的一些设计想法</div></div><div class=info-2><div class=info-item-1>深夜看群友聊的我实在焦虑，起来随便写个水文压压惊 正文写这篇文章的原因是之前给 runc 提的 CPU Burst 支持的 PR [Carry #3205] libct/cg: add CFS bandwidth burst for CPU 终于开始有了新的动静了，这次换了一个国人的 reviewer，感觉要是运气好能在9月开始合并这个 PR。 如果这个 PR 被合并了，那么在 containerd/nerdctl 等其余项目上支持 CPU Burst 的工作就可以开始了。所以这篇文章就是想记录下我对于 CPU Burst 在 Kubernetes 内实现的一些想法，差不多可以当作自己写正式的 KEP(Kubernetes Enhancement Proposal) 草稿 主要分为两个部分来聊一下 CPU Burst 的一些背景 目前 Kubernetes 对于 CPU 资源切分的设计概要 CPU Burst 在 Kubernetes 中的一些设计想法 CPU Burst 的一些背景聊 CPU Burst 之前必须要先聊一下 Linux 里面关于 CGroup...</div></div></div></a><a class=pagination-related href=/posts/2023/08/22/a-little-bit-idea-about-unwind/ title=关于用户态栈回溯（Unwind）的一些杂记和想法><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2023-08-23</div><div class=info-item-2>关于用户态栈回溯（Unwind）的一些杂记和想法</div></div><div class=info-2><div class=info-item-1>随手记录一些关于用户态栈回溯（Unwind）的一些杂记和想法。 正文昨晚三点过刚吃完药躺在床上休息的时候，突然想到了 @yihong0618 的之前在群里的一个想法 我在想 eBPF 能不能 trace libpq 的协议，好像还没有人做过 我最开始的一个想法是 现在主流做法还是 ptrace 系的东西（gdb 那套），你要用 eBPF 去 trace libpq 肯定没问题，就和 Grey 用 uprobe 去 trace go 一样，手算 cast。但是这里另外一个问题是 libpq 的符号信息不一定够。我倾向你可以这样试一下，你改一下 libpq 源码，关键地方走 USDT（我看你之前用过） 不过后续我师父出来有了一个提醒 如果目标是 trace libpq.so 的调用情况，那应该目前就可以做到。.so 相比 executable 有几个优势： 它一定有动态符号表 它一定有 .eh_frameuprobe 恰好又是 attach to the binary offset 而不是 process address，所以第一个优势完美匹配...</div></div></div></a><a class=pagination-related href=/posts/2021/08/24/a-little-problem-about-posix-node-js-execsync/ title="关于 Node.js 中 execSync 的一点问题"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2021-08-24</div><div class=info-item-2>关于 Node.js 中 execSync 的一点问题</div></div><div class=info-2><div class=info-item-1>很久没写水文了，昨天帮人查了一个 Node.js 中 execSync 这个函数特殊行为的问题，很有趣，所以大概记录下来水一篇文章 背景首先老哥给了一张截图 首先基本问题可以抽象为在 Node.js 中利用 execSync 这个函数执行 ps -Af | grep -q -E -c &quot;\\-\\-user-data-dir=\\.+App&quot; 这样一条命令的时候，Node.js 时不时会报错。具体堆栈大概为 12345678910Uncaught Error: Command failed: ps -Af | grep -q -E -c &quot;\-\-user-data-dir=\.+App&quot; at checkExecSyncError (child_process.js:616:11) at Object.execSync (child_process.js:652:15) &#123; status: 1, signal: null, output: [ null, &lt;Buffer &gt;,...</div></div></div></a></div></div><hr class=custom-hr><div id=post-comment><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class=comment-wrap><div><div id=disqus_thread></div></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info text-center"><div class=avatar-img><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info-name>Manjusaka</div><div class=author-info-description>热忱之心不可磨灭</div><div class=site-data><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>102</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>58</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>39</div></a></div><a id=card-info-btn href=https://github.com/Zheaoli rel="external nofollow noreferrer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class=card-info-social-icons><a class=social-icon href=https://github.com/ZheaoLi rel="external nofollow noreferrer" target=_blank title=Github><i class="fab fa-github"></i></a><a class=social-icon href=mailto:me@manjusaka.me rel="external nofollow noreferrer" target=_blank title=Email><i class="fas fa-envelope"></i></a><a class=social-icon href=https://twitter.com/Manjusaka_Lee rel="external nofollow noreferrer" target=_blank title=推特><i class="fab fa-twitter"></i></a><a class=social-icon href=/atom.xml target=_blank title=RSS><i class="fa-solid fa-feed"></i></a></div></div><div class="card-widget card-announcement"><div class=item-headline><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class=announcement_content>This is my Blog</div></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>Contents</span><span class=toc-percentage></span></div><div class="toc-content is-expand"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81><span class=toc-number>1.</span> <span class=toc-text>前情提要</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%E6%89%8B%E6%AE%B5><span class=toc-number>2.</span> <span class=toc-text>更优雅的信号处理手段</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84-handler><span class=toc-number>2.1.</span> <span class=toc-text>更优雅的 handler</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9B%B4%E5%BF%AB%E9%80%9F%E7%9A%84%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F><span class=toc-number>2.2.</span> <span class=toc-text>更快速的信号处理方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-number>3.</span> <span class=toc-text>总结</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Reference><span class=toc-number>4.</span> <span class=toc-text>Reference</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>Recent Posts</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Python 3.14: Python 世界的一大步"></a><div class=content><a class=title href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步">Python 3.14: Python 世界的一大步</a><time datetime=2025-04-26T14:49:00.000Z title="Created 2025-04-26 22:49:00">2025-04-26</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/ title=简单聊聊常见的负载均衡算法><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=/images/pixai-1860500966642493859-3.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单聊聊常见的负载均衡算法></a><div class=content><a class=title href=/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/ title=简单聊聊常见的负载均衡算法>简单聊聊常见的负载均衡算法</a><time datetime=2025-03-23T12:00:00.000Z title="Created 2025-03-23 20:00:00">2025-03-23</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/02/03/a-little-thought-about-translation-about-yuru-camp/ title=简单吐槽一下摇曳露营的台配><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/08/15/10/sculpture-7776861_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单吐槽一下摇曳露营的台配></a><div class=content><a class=title href=/posts/2025/02/03/a-little-thought-about-translation-about-yuru-camp/ title=简单吐槽一下摇曳露营的台配>简单吐槽一下摇曳露营的台配</a><time datetime=2025-02-03T18:00:00.000Z title="Created 2025-02-04 02:00:00">2025-02-04</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/01/04/saka-is-baka/ title="Saka 馬鹿"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Saka 馬鹿"></a><div class=content><a class=title href=/posts/2025/01/04/saka-is-baka/ title="Saka 馬鹿">Saka 馬鹿</a><time datetime=2025-01-04T18:30:00.000Z title="Created 2025-01-05 02:30:00">2025-01-05</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2024/12/31/at-the-end-of-2024/ title=本当の僕らをありがとう><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt=本当の僕らをありがとう></a><div class=content><a class=title href=/posts/2024/12/31/at-the-end-of-2024/ title=本当の僕らをありがとう>本当の僕らをありがとう</a><time datetime=2024-12-31T15:00:00.000Z title="Created 2024-12-31 23:00:00">2024-12-31</time></div></div></div></div><div class="card-widget ads-wrap"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7962287588031867 data-ad-slot=1257383027 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id=footer><div id=footer-wrap><div class=copyright>&copy;2020 - 2025 By Manjusaka</div><div class=framework-info><span>Framework </span><a href=https://hexo.io rel="external nofollow noreferrer">Hexo 7.3.0</a><span class=footer-separator>|</span><span>Theme </span><a href=https://github.com/jerryc127/hexo-theme-butterfly rel="external nofollow noreferrer">Butterfly 5.3.5</a></div></div></footer></div><div id=rightside><div id=rightside-config-hide></div><div id=rightside-config-show><button id=darkmode type=button title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id=translateLink type=button title="Toggle Between Traditional and Simplified Chinese">简</button><button id=readmode type=button title="Reading Mode"><i class="fas fa-book-open"></i></button><button id=go-up type=button title="Back to Top"><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src=https://www.manjusaka.blog/js/utils.js></script><script src=https://www.manjusaka.blog/js/main.js></script><script src=https://www.manjusaka.blog/js/tw_cn.js></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js></script><script src=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js></script><div class=js-pjax><script>(()=>{var e=()=>{var e;0!==(e=document.querySelectorAll("pre > code.mermaid")).length&&e.forEach(e=>{var t=document.createElement("pre"),d=(t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent,document.createElement("div"));d.className="mermaid-wrap",d.appendChild(t),e.parentNode.replaceWith(d)});let t=document.querySelectorAll("#article-container .mermaid-wrap");0!==t.length&&(e=()=>(e=>{window.loadMermaid=!0;document.documentElement.getAttribute("data-theme");e.forEach((e,t)=>{let d=e.firstElementChild;e=`%%{init:{ 'theme':'default'}}%%
`+d.textContent,t=mermaid.render("mermaid-"+t,e);let n=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof t?n(t):t.then(({svg:e})=>n(e))})})(t),btf.addGlobalFn("themeChange",e,"mermaid"),window.loadMermaid?e():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(e))};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{let t="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,n=i=>{window.DISQUS&&window.DISQUS.reset({reload:!0,config:i})};var i=(i,s)=>{t&&(window.shuoshuoComment.destroyDisqus=()=>{i.children.length&&(i.innerHTML="",i.classList.add("no-comment"))}),window.disqus_identifier=t?s:"/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/",window.disqus_url=t?location.origin+s:"https://www.manjusaka.blog/posts/2020/11/07/a-simple-introduction-about-signal-process-in-linux-v2/";function e(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title="简单聊聊进程中的信号处理 V2"}window.DISQUS?n(e):((s=document.createElement("script")).src="https://manjusakablog.disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),document.head.appendChild(s)),btf.addGlobalFn("themeChange",()=>n(e),"disqus")};t?window.shuoshuoComment={loadComment:i}:i()})()</script></div><script defer=defer id=fluttering_ribbon mobile=false src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js></script><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=algolia-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>Search</span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=search-wrap><div id=algolia-search-input></div><hr><div id=algolia-search-results><div id=algolia-hits></div><div id=algolia-pagination></div><div id=algolia-info><div class=algolia-stats></div><div class=algolia-poweredBy></div></div></div></div></div><div id=search-mask></div><script src=https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js></script><script src=https://www.manjusaka.blog/js/search/algolia.js></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var s=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),s.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/12/31/at-the-end-of-2024/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-12-31</span><a class="blog-slider__title" href="/posts/2024/12/31/at-the-end-of-2024/" alt="">本当の僕らをありがとう</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2024/12/31/at-the-end-of-2024/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-02-20</span><a class="blog-slider__title" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">简单聊聊奥特曼中很有趣的细节</a><div class="blog-slider__text">ヒーロが必要なんだよ，金城君。ヒーローが必要なんだ！</div><a class="blog-slider__button" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/29/per-aspera-ad-astra/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-29</span><a class="blog-slider__title" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">Per aspera, Ad astra</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-24</span><a class="blog-slider__title" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">开源可能没你想的那么难</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/Zheaoli/yuque-py/assets/7054676/ea9460a2-e351-4b73-9f82-7aef6cd20c33" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-25</span><a class="blog-slider__title" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">聊聊公益和助学</a><div class="blog-slider__text">很多时候，帮助人不需要那么多理由</div><a class="blog-slider__button" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-28</span><a class="blog-slider__title" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">家庭 Homelab 升级计划: v2</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://user-images.githubusercontent.com/7054676/228287041-c86e7928-0da8-4097-b7ff-e575faa8cf8c.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-19</span><a class="blog-slider__title" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">为什么奥特曼是我的信仰</a><div class="blog-slider__text">優しさを失わないでくれ。弱い者を労り互いに助け合い。</div><a class="blog-slider__button" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/16/how-do-I-build-homelab/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-16</span><a class="blog-slider__title" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">家庭 Homelab 升级计划</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer=defer src=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js></script><script defer=defer data-pjax src=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js></script><script async src=//at.alicdn.com/t/font_2032782_8d5kxvn09md.js></script></body></html>
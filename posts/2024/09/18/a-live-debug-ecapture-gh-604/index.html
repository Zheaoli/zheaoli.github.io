<!DOCTYPE html><html lang=en data-theme=auto><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Debug 日志：eCapture GH-604 | Manjusaka</title><meta name=author content=Manjusaka><meta name=copyright content=Manjusaka><meta name=format-detection content="telephone=no"><meta name=theme-color content=ffffff><meta name=description content="Debug 日志系列第二篇，eCapture 的 GH-604， 一个和 Go， Glibc，静态编译相关的问题 太长不看版：在 eCapture 中，由于在静态链接时 glibc 版本的差异，导致在 Ubuntu 下编译的二进制会在特定发行版上 Segment fault"><meta property=og:type content=article><meta property=og:title content="Debug 日志：eCapture GH-604"><meta property=og:url content=https://www.manjusaka.blog/posts/2024/09/18/a-live-debug-ecapture-gh-604/index.html><meta property=og:site_name content=Manjusaka><meta property=og:description content="Debug 日志系列第二篇，eCapture 的 GH-604， 一个和 Go， Glibc，静态编译相关的问题 太长不看版：在 eCapture 中，由于在静态链接时 glibc 版本的差异，导致在 Ubuntu 下编译的二进制会在特定发行版上 Segment fault"><meta property=og:locale content=en_US><meta property=og:image content=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg><meta property=article:published_time content=2024-09-18T14:00:00.000Z><meta property=article:modified_time content=2025-08-24T18:50:50.223Z><meta property=article:author content=Manjusaka><meta property=article:tag content=编程><meta property=article:tag content=Linux><meta property=article:tag content=笔记><meta property=article:tag content=水文><meta name=twitter:card content=summary><meta name=twitter:image content="https://avatars.githubusercontent.com/u/7054676?v=4"><meta name=twitter:creator content=@Manjusaka_Lee><meta name=twitter:site content=https://twitter.com/Manjusaka_Lee><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Debug 日志：eCapture GH-604",
  "url": "https://www.manjusaka.blog/posts/2024/09/18/a-live-debug-ecapture-gh-604/",
  "image": "https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg",
  "datePublished": "2024-09-18T14:00:00.000Z",
  "dateModified": "2025-08-24T18:50:50.223Z",
  "author": [
    {
      "@type": "Person",
      "name": "Manjusaka",
      "url": "https://github.com/Zheaoli"
    }
  ]
}</script><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/7054676?v=4"><link rel=canonical href=https://www.manjusaka.blog/posts/2024/09/18/a-live-debug-ecapture-gh-604/index.html><link rel=preconnect href=//cdn.jsdelivr.net><link rel=preconnect href=//www.google-analytics.com crossorigin=""><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css media=print onload='this.media="all"'><script>(()=>{let t={set:(e,t,a)=>{a&&(a=Date.now()+864e5*a,localStorage.setItem(e,JSON.stringify({value:t,expiry:a})))},get:e=>{var t=localStorage.getItem(e);if(t){var{value:t,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return t;localStorage.removeItem(e)}}},a=(window.btf={saveToLocal:t,getScript:(o,r={})=>new Promise((e,t)=>{let a=document.createElement("script");a.src=o,a.async=!0,Object.entries(r).forEach(([e,t])=>a.setAttribute(e,t)),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),getCSS:(o,r)=>new Promise((e,t)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,r&&(a.id=r),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),addGlobalFn:(e,t,a=!1,o=window)=>{var r;e.startsWith("pjax")||((r=o.globalFn||{})[e]=r[e]||{},r[e][a||Object.keys(r[e]).length]=t,o.globalFn=r)}},()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")}),o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};btf.activateDarkMode=a,btf.activateLightMode=o;var r=t.get("theme"),n=window.matchMedia("(prefers-color-scheme: dark)"),d=window.matchMedia("(prefers-color-scheme: light)"),d=(void 0===r?((!d.matches&&(n.matches||(d=(new Date).getHours())<=6||18<=d)?a:o)(),n.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?a:o)()})):("light"===r?o:a)(),t.get("aside-status"));void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async=async src="https://www.googletagmanager.com/gtag/js?id=UA-154407994-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-154407994-1"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","UA-154407994-1",{page_path:window.location.pathname})},"google_analytics")</script><script>let GLOBAL_CONFIG={root:"/",algolia:{appId:"DL1RURGHTB",indexName:"manjusaka.blog",hitsPerPage:6,languages:{input_placeholder:"Search",hits_empty:"No results found for: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!0,post:!0},runtime:"",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:{limitCount:100,languages:{author:"Author: Manjusaka",link:"Link: ",source:"Source: Manjusaka",info:"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},lightbox:"null",Snackbar:{chs_to_cht:"You have switched to Traditional Chinese",cht_to_chs:"You have switched to Simplified Chinese",day_to_night:"You have switched to Dark Mode",night_to_day:"You have switched to Light Mode",bgLight:"#59C173",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!0,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"Debug 日志：eCapture GH-604",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/assets/font-awesome-animation.min.css media=defer onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/tag_plugins.css media=defer onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@1.0.18/lib/assets/carousel-touch.js></script><meta name=generator content="Hexo 7.3.0"><link rel=alternate href=/atom.xml title=Manjusaka type=application/atom+xml></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>Loading...</div></div></div><script>(()=>{let e=document.getElementById("loading-box"),d=document.body;const t=()=>{e.classList.contains("loaded")||(d.style.overflow="",e.classList.add("loaded"))},o=()=>{d.style.overflow="hidden",e.classList.remove("loaded")};o(),"complete"===document.readyState?t():(window.addEventListener("load",t),document.addEventListener("DOMContentLoaded",t),setTimeout(t,7e3))})()</script><div id=web_bg style="background-image:url('/url(https:/cdn.jsdelivr.net/gh/youngjuning/images@main/1680450445599.png)')"></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class="site-data text-center"><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>104</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>60</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>41</div></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div></div></div><div class="post type-tags" id=body-wrap><header class=post-bg id=page-header style=background-image:url(https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg)><nav id=nav><span id=blog-info><a class=nav-site-title href=/ ><img class=site-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4# image" alt=Logo><span class=site-name>Manjusaka</span></a><a class=nav-page-title href=/ ><span class=site-name>Debug 日志：eCapture GH-604</span><span class=site-name><i class="fa-solid fa-circle-arrow-left"></i><span> Back to Home</span></span></a></span><div id=menus><div id=search-button><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></span><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div><div id=toggle-menu><span class=site-page><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id=post-info><h1 class=post-title>Debug 日志：eCapture GH-604<a class=post-edit-link href=https://github.com/Zheaoli/Zheaoli.github.io/edit/main/source/_posts/a-live-debug-ecapture-gh-604.md rel="external nofollow noreferrer" title=Edit target=_blank><i class="fas fa-pencil-alt"></i></a></h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class=post-meta-label>Created</span><time datetime=2024-09-18T14:00:00.000Z title="Created 2024-09-18 22:00:00">2024-09-18</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/ >编程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/Linux/ >Linux</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>Word Count:</span><span class=word-count>3.1k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>Reading Time:</span><span>14mins</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>Post Views:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class="container post-content" id=article-container><div id=post-outdate-notice data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-08-25 02:50:50&quot;}" hidden></div><p>Debug 日志系列第二篇，eCapture 的 GH-604， 一个和 Go， Glibc，静态编译相关的问题</p><p>太长不看版：在 eCapture 中，由于在静态链接时 glibc 版本的差异，导致在 Ubuntu 下编译的二进制会在特定发行版上 Segment fault</p><span id=more></span><h2 id=开篇><a href=#开篇 class=headerlink title=开篇></a>开篇</h2><p>首先介绍下 eCapture，这个项目是基于 eBPF 做的一套安全工具，核心的能力是可以提供在旁路对于 TLS 流量解密的能力</p><p>在8月25日的时候，社区反馈了一个 bug，编号 GH-604，其核心行为如下</p><p>下载在 GitHub Release 中发布的二进制，在 Arch Linux 下会 Segment Fault，报错大致如下</p><figure class="highlight go"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br></pre></td><td class=code><pre><span class=line><span class=number>2024</span><span class=number>-09</span><span class=number>-18</span>T21:<span class=number>10</span>:<span class=number>47</span>+<span class=number>08</span>:<span class=number>00</span> INF BTF bytecode mode: CORE. btfMode=<span class=number>0</span></span><br><span class=line><span class=number>2024</span><span class=number>-09</span><span class=number>-18</span>T21:<span class=number>10</span>:<span class=number>47</span>+<span class=number>08</span>:<span class=number>00</span> INF module initialization. isReload=<span class=literal>false</span> moduleName=EBPFProbeOPENSSL</span><br><span class=line><span class=number>2024</span><span class=number>-09</span><span class=number>-18</span>T21:<span class=number>10</span>:<span class=number>47</span>+<span class=number>08</span>:<span class=number>00</span> INF Module.Run()</span><br><span class=line>SIGSEGV: segmentation violation</span><br><span class=line>PC=<span class=number>0x7f29ee844696</span> m=<span class=number>5</span> sigcode=<span class=number>1</span> addr=<span class=number>0x1e83c0</span></span><br><span class=line>signal arrived during cgo execution</span><br><span class=line></span><br><span class=line>goroutine <span class=number>19</span> gp=<span class=number>0xc0005b81c0</span> m=<span class=number>5</span> mp=<span class=number>0xc000100008</span> [syscall]:</span><br><span class=line>runtime.cgocall(<span class=number>0x10990e0</span>, <span class=number>0xc0000bca90</span>)</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/runtime/cgocall.<span class=keyword>go</span>:<span class=number>167</span> +<span class=number>0x4b</span> fp=<span class=number>0xc0000bca58</span> sp=<span class=number>0xc0000bca20</span> pc=<span class=number>0x4739ab</span></span><br><span class=line>net._C2func_getaddrinfo(<span class=number>0xc00058e3c0</span>, <span class=number>0x0</span>, <span class=number>0xc0005886f0</span>, <span class=number>0xc00058a0a0</span>)</span><br><span class=line>        _cgo_gotypes.<span class=keyword>go</span>:<span class=number>108</span> +<span class=number>0x55</span> fp=<span class=number>0xc0000bca90</span> sp=<span class=number>0xc0000bca58</span> pc=<span class=number>0x84a7f5</span></span><br><span class=line>net._C_getaddrinfo.func1(<span class=number>0xc00058e3c0</span>, <span class=number>0x0</span>, <span class=number>0xc0005886f0</span>, <span class=number>0xc00058a0a0</span>)</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/net/cgo_unix_cgo.<span class=keyword>go</span>:<span class=number>78</span> +<span class=number>0xeb</span> fp=<span class=number>0xc0000bcb48</span> sp=<span class=number>0xc0000bca90</span> pc=<span class=number>0x84af4b</span></span><br><span class=line>net._C_getaddrinfo(<span class=number>0xc00058e3c0</span>, <span class=number>0x0</span>, <span class=number>0xc0005886f0</span>, <span class=number>0xc00058a0a0</span>)</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/net/cgo_unix_cgo.<span class=keyword>go</span>:<span class=number>78</span> +<span class=number>0x6c</span> fp=<span class=number>0xc0000bcbd0</span> sp=<span class=number>0xc0000bcb48</span> pc=<span class=number>0x84adac</span></span><br><span class=line>net.cgoLookupHostIP(&#123;<span class=number>0x1351556</span>, <span class=number>0x3</span>&#125;, &#123;<span class=number>0x13727d2</span>, <span class=number>0x9</span>&#125;)</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/net/cgo_unix.<span class=keyword>go</span>:<span class=number>181</span> +<span class=number>0x3f9</span> fp=<span class=number>0xc0000bce38</span> sp=<span class=number>0xc0000bcbd0</span> pc=<span class=number>0x7f65b9</span></span><br><span class=line>net.cgoLookupIP.func1()</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/net/cgo_unix.<span class=keyword>go</span>:<span class=number>226</span> +<span class=number>0x85</span> fp=<span class=number>0xc0000bcf00</span> sp=<span class=number>0xc0000bce38</span> pc=<span class=number>0x7f7145</span></span><br><span class=line>net.doBlockingWithCtx[...].func1()</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/net/cgo_unix.<span class=keyword>go</span>:<span class=number>70</span> +<span class=number>0x8f</span> fp=<span class=number>0xc0000bcfe0</span> sp=<span class=number>0xc0000bcf00</span> pc=<span class=number>0x84de4f</span></span><br><span class=line>runtime.goexit(&#123;&#125;)</span><br><span class=line>        /root/.<span class=keyword>go</span>/src/runtime/asm_amd64.s:<span class=number>1700</span> +<span class=number>0x1</span> fp=<span class=number>0xc0000bcfe8</span> sp=<span class=number>0xc0000bcfe0</span> pc=<span class=number>0x482301</span></span><br><span class=line>created by net.doBlockingWithCtx[...] in goroutine <span class=number>18</span></span><br><span class=line>        /root/.<span class=keyword>go</span>/src/net/cgo_unix.<span class=keyword>go</span>:<span class=number>67</span> +<span class=number>0x3c5</span></span><br></pre></td></tr></table></figure><p>我在 Garuda 下能复现同样的问题，由于作者没有 Arch Linux 的环境，那么就由我来接手了</p><p>最开始的排查方向是先利用容器环境进行启动，发现执行正常。那么目前可以初步判断是依赖的二进制版本不同导致的问题，但是 eCapture 依赖的二进制有点多，那么怎么办呢？</p><p>这个时候 issue 的提出者提供了一个关键点，这个问题是 v0.8.1 之后出现的，那么很好办，祭出我们的 <code>git bisect</code> 大法</p><p>最后确定是 938fcffb95e23015af8643ae046c0e912de0a438 带来的问题，我们来看一下代码，这个代码核心的的变更在于</p><ol><li>重构了一部分 Module 的注册逻辑</li><li>引入 Gin 框架来作为 HTTP Configuration 变更的框架</li></ol><p>那么这里我们来调试一下，因为原本的二进制是 strip 了符号信息，我们先关闭符号信息， 然后上 gdb ，获取崩溃时的栈信息，能得到如下信息</p><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br></pre></td><td class=code><pre><span class=line>[Switching to LWP 1772723]</span><br><span class=line>0x00007fffabe44696 in __ctype_init () from /usr/lib/libc.so.6</span><br><span class=line>(gdb) bt</span><br><span class=line>#0  0x00007fffabe44696 in __ctype_init () from /usr/lib/libc.so.6</span><br><span class=line>#1  0x00007fffabf785d1 in __libc_early_init () from /usr/lib/libc.so.6</span><br><span class=line>#2  0x000000000118729f in dl_open_worker_begin ()</span><br><span class=line>#3  0x000000000113a7b8 in _dl_catch_exception ()</span><br><span class=line>#4  0x0000000001186469 in dl_open_worker ()</span><br><span class=line>#5  0x000000000113a7b8 in _dl_catch_exception ()</span><br><span class=line>#6  0x000000000118681b in _dl_open ()</span><br><span class=line>#7  0x000000000113a8f6 in do_dlopen ()</span><br><span class=line>#8  0x000000000113a7b8 in _dl_catch_exception ()</span><br><span class=line>#9  0x000000000113a883 in _dl_catch_error ()</span><br><span class=line>#10 0x000000000113aa74 in __libc_dlopen_mode ()</span><br><span class=line>#11 0x0000000001128eb5 in module_load ()</span><br><span class=line>#12 0x0000000001129315 in __nss_module_get_function ()</span><br><span class=line>#13 0x0000000001118fec in getaddrinfo ()</span><br><span class=line>#14 0x0000000001099119 in _cgo_04fbb8f65a5f_C2func_getaddrinfo (v=0xc00013ca90) at cgo-gcc-prolog:60</span><br><span class=line>#15 0x0000000000481f84 in runtime.asmcgocall () at /root/.go/src/runtime/asm_amd64.s:923</span><br><span class=line>#16 0x000000c0001048c0 in ?? ()</span><br><span class=line>#17 0x000000000048045a in runtime.morestack () at /root/.go/src/runtime/asm_amd64.s:621</span><br><span class=line>#18 0x47681163f543b200 in ?? ()</span><br><span class=line>#19 0x0100000000000016 in ?? ()</span><br><span class=line>#20 0x0000000000800000 in net.(*sysDialer).dialSerial (sd=0x0, ctx=..., ras=..., ~r0=..., ~r1=...) at /root/.go/src/net/dial.go:630</span><br><span class=line>#21 0x0000000000000000 in ?? ()</span><br></pre></td></tr></table></figure><p>我们能看到 <code>net.(*sysDialer).dialSerial</code> 非常显眼，这个函数通常是在使用 net.Dialer ，进行 TCP 的监听时处理的，我们根据这一个信息，对比 code diff，便能确定，这一点是我们所引入 Gin 框架，执行 TCP 监听流程时遇到问题。</p><p>我们再往下看，我们能看到 <code>getaddrinfo</code> 这个函数，这个是执行 DNS Lookup 的痕迹。我们将代码中的 <code>localhost:xx</code> 更改为 IP 地址的形式，如同我们所预料的一样，问题消失了</p><p>那么我们可以判定，这个问题是 Golang 走 CGO 调用 <code>getaddrinfo</code> 时变量导致的问题</p><p>我们可以在开源社区的 Issue 中，查到之前的 Report，参见 <a href=https://github.com/golang/go/issues/30310 rel="external nofollow noreferrer">https://github.com/golang/go/issues/30310</a>，解决方法是可以避免使用 glibc 提供的 DNS lookup 而使用 Go 内置实现的 DNS 来处理。</p><p>在将项目代码构建参数新增 <code>-tags &#39;netgo&#39;</code> 后，问题解决。</p><p>那么这个问题就到词结束了吗？并不是，我们的问题依然存在，到底是什么原因导致我们会出现使用 glibc 的时候有 Segment fault 的发生？</p><p>我们先把我们复现代码最小化</p><figure class="highlight go"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>package</span> main</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> (</span><br><span class=line>    <span class=string>&quot;fmt&quot;</span></span><br><span class=line>    <span class=string>&quot;net&quot;</span></span><br><span class=line>)</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>main</span><span class=params>()</span></span> &#123;</span><br><span class=line>    address := <span class=string>&quot;localhost:8080&quot;</span></span><br><span class=line></span><br><span class=line>    listener, err := net.Listen(<span class=string>&quot;tcp&quot;</span>, address)</span><br><span class=line>    <span class=keyword>if</span> err != <span class=literal>nil</span> &#123;</span><br><span class=line>        fmt.Println(<span class=string>&quot;Error creating listener:&quot;</span>, err)</span><br><span class=line>        <span class=keyword>return</span></span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>defer</span> listener.Close()</span><br><span class=line></span><br><span class=line>    fmt.Printf(<span class=string>&quot;Listening on %s\n&quot;</span>, address)</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> &#123;</span><br><span class=line>        conn, err := listener.Accept()</span><br><span class=line>        <span class=keyword>if</span> err != <span class=literal>nil</span> &#123;</span><br><span class=line>            fmt.Println(<span class=string>&quot;Error accepting connection:&quot;</span>, err)</span><br><span class=line>            <span class=keyword>continue</span></span><br><span class=line>        &#125;</span><br><span class=line></span><br><span class=line>        <span class=keyword>go</span> handleConnection(conn)</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>handleConnection</span><span class=params>(conn net.Conn)</span></span> &#123;</span><br><span class=line>    <span class=keyword>defer</span> conn.Close()</span><br><span class=line></span><br><span class=line>    buffer := <span class=built_in>make</span>([]<span class=type>byte</span>, <span class=number>1024</span>)</span><br><span class=line>    n, err := conn.Read(buffer)</span><br><span class=line>    <span class=keyword>if</span> err != <span class=literal>nil</span> &#123;</span><br><span class=line>        fmt.Println(<span class=string>&quot;Error reading from connection:&quot;</span>, err)</span><br><span class=line>        <span class=keyword>return</span></span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    fmt.Printf(<span class=string>&quot;Received: %s\n&quot;</span>, <span class=type>string</span>(buffer[:n]))</span><br><span class=line></span><br><span class=line>    response := <span class=string>&quot;Hello, client!&quot;</span></span><br><span class=line>    _, err = conn.Write([]<span class=type>byte</span>(response))</span><br><span class=line>    <span class=keyword>if</span> err != <span class=literal>nil</span> &#123;</span><br><span class=line>        fmt.Println(<span class=string>&quot;Error writing to connection:&quot;</span>, err)</span><br><span class=line>        <span class=keyword>return</span></span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>我们先使用，<code>CGO_ENABLED=1 go build</code> 来构建复现代码，然后发现，可以在不同环境下运行。而当我们使用 <code>CGO_ENABLED=1 go build -ldflags &quot;-linkmode=external -extldflags -static&quot;</code> 的参数构建的产物则不可以。为什么呢？我们来对比下汇编</p><p>我们能发现在第一种参数构建的代码，其 <code>getaddrinfo</code> 的部分如下</p><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>00000000004022a0 &lt;getaddrinfo@plt&gt;:</span><br><span class=line>  4022a0:	ff 25 aa 3e 1e 00    	jmp    *0x1e3eaa(%rip)        # 5e6150 &lt;getaddrinfo@GLIBC_2.2.5&gt;</span><br><span class=line>  4022a6:	68 27 00 00 00       	push   $0x27</span><br><span class=line>  4022ab:	e9 70 fd ff ff       	jmp    402020 &lt;_init+0x20&gt;</span><br></pre></td></tr></table></figure><p>哦，熟悉的 PLT 的部分，这一部分是纯动态链接，直接在加载时由链接器来处理。而第二种方式构建的的产物却不一样</p><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br></pre></td><td class=code><pre><span class=line>0000000000528fd0 &lt;getaddrinfo&gt;:</span><br><span class=line>  528fd0:	f3 0f 1e fa          	endbr64</span><br><span class=line>  528fd4:	55                   	push   %rbp</span><br><span class=line>  528fd5:	48 89 e5             	mov    %rsp,%rbp</span><br><span class=line>  528fd8:	41 57                	push   %r15</span><br><span class=line>  528fda:	49 89 d7             	mov    %rdx,%r15</span><br><span class=line>  528fdd:	41 56                	push   %r14</span><br><span class=line>  528fdf:	41 55                	push   %r13</span><br><span class=line>  528fe1:	41 54                	push   %r12</span><br><span class=line>  528fe3:	49 89 f4             	mov    %rsi,%r12</span><br><span class=line>  528fe6:	53                   	push   %rbx</span><br><span class=line>  528fe7:	48 81 ec 38 07 00 00 	sub    $0x738,%rsp</span><br><span class=line>  528fee:	48 89 bd 18 f9 ff ff 	mov    %rdi,-0x6e8(%rbp)</span><br><span class=line>  528ff5:	48 89 8d b0 f8 ff ff 	mov    %rcx,-0x750(%rbp)</span><br><span class=line>  528ffc:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class=line>  529003:	00 00 </span><br><span class=line>  529005:	48 89 45 c8          	mov    %rax,-0x38(%rbp)</span><br><span class=line>  529009:	31 c0                	xor    %eax,%eax</span><br><span class=line>  52900b:	48 c7 85 30 f9 ff ff 	movq   $0x0,-0x6d0(%rbp)</span><br><span class=line>  529012:	00 00 00 00 </span><br><span class=line>  529016:	48 85 ff             	test   %rdi,%rdi</span><br><span class=line>  529019:	0f 84 3a 08 00 00    	je     529859 &lt;getaddrinfo+0x889&gt;</span><br><span class=line>  52901f:	80 3f 2a             	cmpb   $0x2a,(%rdi)</span><br><span class=line>  529022:	0f 84 27 08 00 00    	je     52984f &lt;getaddrinfo+0x87f&gt;</span><br><span class=line>  529028:	4d 85 e4             	test   %r12,%r12</span><br><span class=line>  52902b:	74 0b                	je     529038 &lt;getaddrinfo+0x68&gt;</span><br><span class=line>  52902d:	41 80 3c 24 2a       	cmpb   $0x2a,(%r12)</span><br><span class=line>  529032:	0f 84 7c 0b 00 00    	je     529bb4 &lt;getaddrinfo+0xbe4&gt;</span><br><span class=line>  529038:	4d 85 ff             	test   %r15,%r15</span><br><span class=line>  52903b:	0f 84 4f 08 00 00    	je     529890 &lt;getaddrinfo+0x8c0&gt;</span><br><span class=line>  529041:	41 8b 07             	mov    (%r15),%eax</span><br><span class=line>  529044:	a9 00 f8 ff ff       	test   $0xfffff800,%eax</span><br><span class=line>  529049:	0f 85 6d 19 00 00    	jne    52a9bc &lt;getaddrinfo+0x19ec&gt;</span><br><span class=line>  52904f:	48 83 bd 18 f9 ff ff 	cmpq   $0x0,-0x6e8(%rbp)</span><br></pre></td></tr></table></figure><p>这里省略了很多的汇编，我们可以结合 GDB 的调试来看一下关键信息</p><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line>#0  0x00007fffb0044696 in __GI___ctype_init () at ctype-info.c:31</span><br><span class=line>#1  0x00007fffb01785d1 in __libc_early_init (initial=false) at libc_early_init.c:35</span><br><span class=line>#2  0x000000000059549f in dl_open_worker_begin ()</span><br><span class=line>#3  0x000000000054a5e8 in _dl_catch_exception ()</span><br><span class=line>#4  0x0000000000594669 in dl_open_worker ()</span><br><span class=line>#5  0x000000000054a5e8 in _dl_catch_exception ()</span><br><span class=line>#6  0x0000000000594a1b in _dl_open ()</span><br><span class=line>#7  0x000000000054a726 in do_dlopen ()</span><br><span class=line>#8  0x000000000054a5e8 in _dl_catch_exception ()</span><br><span class=line>#9  0x000000000054a6b3 in _dl_catch_error ()</span><br><span class=line>#10 0x000000000054a8a4 in __libc_dlopen_mode ()</span><br><span class=line>#11 0x0000000000538ce5 in module_load ()</span><br><span class=line>#12 0x0000000000539145 in __nss_module_get_function ()</span><br><span class=line>#13 0x000000000052aa3c in getaddrinfo ()</span><br><span class=line>#14 0x00000000004da549 in _cgo_04fbb8f65a5f_C2func_getaddrinfo (v=0xc0001acdd0) at /tmp/go-build/cgo-gcc-prolog:60</span><br><span class=line>#15 0x0000000000471204 in runtime.asmcgocall () at /root/.go/src/runtime/asm_amd64.s:923</span><br><span class=line>#16 0x000000c0001868c0 in ?? ()</span><br></pre></td></tr></table></figure><p>我们能看到第二种方式（即使用外部链接器，以静态链接方式进行链接）的背后是会用 <code>dl_open</code> 去处理 glibc 的链接</p><p>我们直接跳转到 <code>__ctype_init</code> 看下源码以及汇编，这里第一段汇编是在 Glibc 2.35 下编译产物，第二段是在 Arch Linux 下的 Glibc 2.40 下编译的产物</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=type>void</span></span><br><span class=line>__ctype_init (<span class=type>void</span>)</span><br><span class=line>&#123;</span><br><span class=line>  <span class=type>const</span> <span class=type>uint16_t</span> **bp = __libc_tsd_address (<span class=type>const</span> <span class=type>uint16_t</span> *, CTYPE_B);</span><br><span class=line>  *bp = (<span class=type>const</span> <span class=type>uint16_t</span> *) _NL_CURRENT (LC_CTYPE, _NL_CTYPE_CLASS) + <span class=number>128</span>;</span><br><span class=line>  <span class=type>const</span> <span class=type>int32_t</span> **up = __libc_tsd_address (<span class=type>const</span> <span class=type>int32_t</span> *, CTYPE_TOUPPER);</span><br><span class=line>  *up = ((<span class=type>int32_t</span> *) _NL_CURRENT (LC_CTYPE, _NL_CTYPE_TOUPPER) + <span class=number>128</span>);</span><br><span class=line>  <span class=type>const</span> <span class=type>int32_t</span> **lp = __libc_tsd_address (<span class=type>const</span> <span class=type>int32_t</span> *, CTYPE_TOLOWER);</span><br><span class=line>  *lp = ((<span class=type>int32_t</span> *) _NL_CURRENT (LC_CTYPE, _NL_CTYPE_TOLOWER) + <span class=number>128</span>);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre></td><td class=code><pre><span class=line>000000000055aee0 &lt;__ctype_init&gt;:</span><br><span class=line>  55aee0:	f3 0f 1e fa          	endbr64</span><br><span class=line>  55aee4:	48 c7 c0 80 ff ff ff 	mov    $0xffffffffffffff80,%rax</span><br><span class=line>  55aeeb:	48 c7 c1 f0 ff ff ff 	mov    $0xfffffffffffffff0,%rcx</span><br><span class=line>  55aef2:	64 48 8b 00          	mov    %fs:(%rax),%rax</span><br><span class=line>  55aef6:	48 8b 00             	mov    (%rax),%rax</span><br><span class=line>  55aef9:	48 8b 70 40          	mov    0x40(%rax),%rsi</span><br><span class=line>  55aefd:	48 8d 96 00 01 00 00 	lea    0x100(%rsi),%rdx</span><br><span class=line>  55af04:	64 48 89 11          	mov    %rdx,%fs:(%rcx)</span><br><span class=line>  55af08:	48 8b 78 48          	mov    0x48(%rax),%rdi</span><br><span class=line>  55af0c:	48 c7 c1 e8 ff ff ff 	mov    $0xffffffffffffffe8,%rcx</span><br><span class=line>  55af13:	48 8d 97 00 02 00 00 	lea    0x200(%rdi),%rdx</span><br><span class=line>  55af1a:	64 48 89 11          	mov    %rdx,%fs:(%rcx)</span><br><span class=line>  55af1e:	48 8b 40 58          	mov    0x58(%rax),%rax</span><br><span class=line>  55af22:	48 c7 c2 e0 ff ff ff 	mov    $0xffffffffffffffe0,%rdx</span><br><span class=line>  55af29:	48 05 00 02 00 00    	add    $0x200,%rax</span><br><span class=line>  55af2f:	64 48 89 02          	mov    %rax,%fs:(%rdx)</span><br><span class=line>  55af33:	c3                   	ret</span><br><span class=line>  55af34:	66 2e 0f 1f 84 00 00 	cs nopw 0x0(%rax,%rax,1)</span><br><span class=line>  55af3b:	00 00 00 </span><br><span class=line>  55af3e:	66 90                	xchg   %ax,%ax</span><br></pre></td></tr></table></figure><p>第二段</p><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre></td><td class=code><pre><span class=line>000000000111c270 &lt;__ctype_init&gt;:</span><br><span class=line> 111c270:	f3 0f 1e fa          	endbr64</span><br><span class=line> 111c274:	48 c7 c0 90 ff ff ff 	mov    $0xffffffffffffff90,%rax</span><br><span class=line> 111c27b:	48 c7 c1 e8 ff ff ff 	mov    $0xffffffffffffffe8,%rcx</span><br><span class=line> 111c282:	64 48 8b 00          	mov    %fs:(%rax),%rax</span><br><span class=line> 111c286:	48 8b 00             	mov    (%rax),%rax</span><br><span class=line> 111c289:	48 8b 70 38          	mov    0x38(%rax),%rsi</span><br><span class=line> 111c28d:	48 8d 96 00 01 00 00 	lea    0x100(%rsi),%rdx</span><br><span class=line> 111c294:	64 48 89 11          	mov    %rdx,%fs:(%rcx)</span><br><span class=line> 111c298:	48 8b 78 40          	mov    0x40(%rax),%rdi</span><br><span class=line> 111c29c:	48 c7 c1 e0 ff ff ff 	mov    $0xffffffffffffffe0,%rcx</span><br><span class=line> 111c2a3:	48 8d 97 00 02 00 00 	lea    0x200(%rdi),%rdx</span><br><span class=line> 111c2aa:	64 48 89 11          	mov    %rdx,%fs:(%rcx)</span><br><span class=line> 111c2ae:	48 8b 40 50          	mov    0x50(%rax),%rax</span><br><span class=line> 111c2b2:	48 c7 c2 d8 ff ff ff 	mov    $0xffffffffffffffd8,%rdx</span><br><span class=line> 111c2b9:	48 05 00 02 00 00    	add    $0x200,%rax</span><br><span class=line> 111c2bf:	64 48 89 02          	mov    %rax,%fs:(%rdx)</span><br><span class=line> 111c2c3:	c3                   	ret</span><br><span class=line> 111c2c4:	66 2e 0f 1f 84 00 00 	cs nopw 0x0(%rax,%rax,1)</span><br><span class=line> 111c2cb:	00 00 00 </span><br><span class=line> 111c2ce:	66 90                	xchg   %ax,%ax</span><br></pre></td></tr></table></figure><p>我们能看到两段代码行为基本一致，但是 offset 存在明显差异。这个时候我们对比一下 Glibc 两个版本的代码的差异</p><p>我们能发现，由于 <code>__locale_data</code> 结构的变化，导致 <code>_NL_CTYPE_CLASS</code> 的 offset 在不同版本下存在偏移</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br></pre></td><td class=code><pre><span class=line><span class=comment>//v2.35</span></span><br><span class=line></span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>locale_data</span></span></span><br><span class=line><span class=class>&#123;</span></span><br><span class=line>  <span class=type>const</span> <span class=type>char</span> *name;</span><br><span class=line>  <span class=type>const</span> <span class=type>char</span> *filedata;		<span class=comment>/* Region mapping the file data.  */</span></span><br><span class=line>  <span class=type>off_t</span> filesize;		<span class=comment>/* Size of the file (and the region).  */</span></span><br><span class=line>  <span class=class><span class=keyword>enum</span>				/* <span class=title>Flavor</span> <span class=title>of</span> <span class=title>storage</span> <span class=title>used</span> <span class=title>for</span> <span class=title>those</span>.  */</span></span><br><span class=line><span class=class>  &#123;</span></span><br><span class=line>    ld_malloced,		<span class=comment>/* Both are malloc&#x27;d.  */</span></span><br><span class=line>    ld_mapped,			<span class=comment>/* name is malloc&#x27;d, filedata mmap&#x27;d */</span></span><br><span class=line>    ld_archive			<span class=comment>/* Both point into mmap&#x27;d archive regions.  */</span></span><br><span class=line>  &#125; alloc;</span><br><span class=line></span><br><span class=line>  <span class=comment>/* This provides a slot for category-specific code to cache data computed</span></span><br><span class=line><span class=comment>     about this locale.  That code can set a cleanup function to deallocate</span></span><br><span class=line><span class=comment>     the data.  */</span></span><br><span class=line>  <span class=class><span class=keyword>struct</span></span></span><br><span class=line><span class=class>  &#123;</span></span><br><span class=line>    <span class=type>void</span> (*cleanup) (<span class=keyword>struct</span> __locale_data *);</span><br><span class=line>    <span class=class><span class=keyword>union</span></span></span><br><span class=line><span class=class>    &#123;</span></span><br><span class=line>      <span class=type>void</span> *data;</span><br><span class=line>      <span class=class><span class=keyword>struct</span> <span class=title>lc_time_data</span> *<span class=title>time</span>;</span></span><br><span class=line>      <span class=type>const</span> <span class=class><span class=keyword>struct</span> <span class=title>gconv_fcts</span> *<span class=title>ctype</span>;</span></span><br><span class=line>    &#125;;</span><br><span class=line>  &#125; private;</span><br><span class=line></span><br><span class=line>  <span class=type>unsigned</span> <span class=type>int</span> usage_count;	<span class=comment>/* Counter for users.  */</span></span><br><span class=line></span><br><span class=line>  <span class=type>int</span> use_translit;		<span class=comment>/* Nonzero if the mb*towv*() and wc*tomb()</span></span><br><span class=line><span class=comment>				   functions should use transliteration.  */</span></span><br><span class=line></span><br><span class=line>  <span class=type>unsigned</span> <span class=type>int</span> nstrings;	<span class=comment>/* Number of strings below.  */</span></span><br><span class=line>  <span class=class><span class=keyword>union</span> <span class=title>locale_data_value</span></span></span><br><span class=line><span class=class>  &#123;</span></span><br><span class=line>    <span class=type>const</span> <span class=type>uint32_t</span> *wstr;</span><br><span class=line>    <span class=type>const</span> <span class=type>char</span> *<span class=built_in>string</span>;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> word;		<span class=comment>/* Note endian issues vs 64-bit pointers.  */</span></span><br><span class=line>  &#125;</span><br><span class=line>  values __flexarr;	<span class=comment>/* Items, usually pointers into `filedata&#x27;.  */</span></span><br><span class=line>&#125;;</span><br><span class=line></span><br><span class=line><span class=comment>//v2.40</span></span><br><span class=line></span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>locale_data</span></span></span><br><span class=line><span class=class>&#123;</span></span><br><span class=line>  <span class=type>const</span> <span class=type>char</span> *name;</span><br><span class=line>  <span class=type>const</span> <span class=type>char</span> *filedata;		<span class=comment>/* Region mapping the file data.  */</span></span><br><span class=line>  <span class=type>off_t</span> filesize;		<span class=comment>/* Size of the file (and the region).  */</span></span><br><span class=line>  <span class=class><span class=keyword>enum</span>				/* <span class=title>Flavor</span> <span class=title>of</span> <span class=title>storage</span> <span class=title>used</span> <span class=title>for</span> <span class=title>those</span>.  */</span></span><br><span class=line><span class=class>  &#123;</span></span><br><span class=line>    ld_malloced,		<span class=comment>/* Both are malloc&#x27;d.  */</span></span><br><span class=line>    ld_mapped,			<span class=comment>/* name is malloc&#x27;d, filedata mmap&#x27;d */</span></span><br><span class=line>    ld_archive			<span class=comment>/* Both point into mmap&#x27;d archive regions.  */</span></span><br><span class=line>  &#125; alloc;</span><br><span class=line></span><br><span class=line>  <span class=comment>/* This provides a slot for category-specific code to cache data</span></span><br><span class=line><span class=comment>     computed about this locale.  Type of the data pointed to:</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>     LC_CTYPE   struct lc_ctype_data (_nl_intern_locale_data)</span></span><br><span class=line><span class=comment>     LC_TIME    struct lc_time_data (_nl_init_alt_digit, _nl_init_era_entries)</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>     This data deallocated at the start of _nl_unload_locale.  */</span></span><br><span class=line>  <span class=type>void</span> *private;</span><br><span class=line></span><br><span class=line>  <span class=type>unsigned</span> <span class=type>int</span> usage_count;	<span class=comment>/* Counter for users.  */</span></span><br><span class=line></span><br><span class=line>  <span class=type>int</span> use_translit;		<span class=comment>/* Nonzero if the mb*towv*() and wc*tomb()</span></span><br><span class=line><span class=comment>				   functions should use transliteration.  */</span></span><br><span class=line></span><br><span class=line>  <span class=type>unsigned</span> <span class=type>int</span> nstrings;	<span class=comment>/* Number of strings below.  */</span></span><br><span class=line>  <span class=class><span class=keyword>union</span> <span class=title>locale_data_value</span></span></span><br><span class=line><span class=class>  &#123;</span></span><br><span class=line>    <span class=type>const</span> <span class=type>uint32_t</span> *wstr;</span><br><span class=line>    <span class=type>const</span> <span class=type>char</span> *<span class=built_in>string</span>;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> word;		<span class=comment>/* Note endian issues vs 64-bit pointers.  */</span></span><br><span class=line>  &#125;</span><br><span class=line>  values __flexarr;	<span class=comment>/* Items, usually pointers into `filedata&#x27;.  */</span></span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p>那么我们问题的 Root cause 也就得到了确定，整个问题的因果链如下</p><ol><li>我们项目使用引入 Gin，来作为 HTTP Server</li><li>我们使用 localhost 来作为默认的监听地址</li><li>localhost 在服务端启动监听的时候触发了 DNS Lookup 行为</li><li>CGO_ENABLED=1 的情况下，Golang 默认使用 glibc 中的 <code>getaddrinfo</code> 进行 DNS lookup</li><li>我们项目开启了 <code>-ldflags &quot;-linkmode=external -extldflags -static&quot;</code>，即使用外部链接器，以静态链接方式进行链接），将会使用 <code>dl_open</code> 来处理 glibc，而且这种情况下，<code>__ctype_init</code> 这类方法将会被静态编译至二进制中</li><li>Glibc 中特定字段不同版本的 offset 不一致</li><li>结合 4&amp;5&amp;6, 我们在 Glibc 2.35 （即文中默认的构建机）静态编译后的产物，因为 offset 不一致，在 Glibc 2.40 （即 Arch Linux）下使用时，会出现 segment fault</li></ol><p>问题得证</p><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><p>这个问题变更只有一行，但是查了我很久的时间，反复在 Go 和 Glibc 的源码中横跳。顺便还去复习了 Linker 的很多知识</p><p>这某种意义上是我很喜欢这个行业的原因，因为我们所遇到的每个问题背后的风景，都很值得一看。</p></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class=post-copyright-info><a href=https://github.com/Zheaoli rel="external nofollow noreferrer">Manjusaka</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class=post-copyright-info><a href=https://www.manjusaka.blog/posts/2024/09/18/a-live-debug-ecapture-gh-604/ >https://www.manjusaka.blog/posts/2024/09/18/a-live-debug-ecapture-gh-604/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class=post-copyright-info>All articles on this blog are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel="external nofollow noreferrer">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/%E7%BC%96%E7%A8%8B/ >编程</a><a class=post-meta__tags href=/tags/Linux/ >Linux</a><a class=post-meta__tags href=/tags/%E7%AC%94%E8%AE%B0/ >笔记</a><a class=post-meta__tags href=/tags/%E6%B0%B4%E6%96%87/ >水文</a></div><div class=post-share><div class=social-share data-image=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js defer=defer></script></div></div><div class=ads-wrap><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-7962287588031867 data-ad-slot=2542544532></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class=pagination-post id=pagination><a class=pagination-related href=/posts/2024/10/02/how-to-extend-the-wasi-python-by-using-host-function-cn/ title="如何使用 WASMTIME 来运行 CPython for WASI，然后利用 Python 实现的 HostFunction 来扩展它？"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class=info><div class=info-1><div class=info-item-1>Previous</div><div class=info-item-2>如何使用 WASMTIME 来运行 CPython for WASI，然后利用 Python 实现的 HostFunction 来扩展它？</div></div><div class=info-2><div class=info-item-1>国庆节搞了一个活，利用 wasmtime 来执行编译成 WASM/WASI 字节码的 CPython 虚拟机，并在宿主机一侧利用 Python 实现的 Host Function 来扩展它。 再次声明一下，这个只是我个人想搞的活，没有再任何生产环境中得到验证，just for fun（XDDD 正文首先我们简单介绍一下 WASM/WASI，这里我直接引用一下 AI 生成的 brief summary WebAssembly (WASM) 是一种低级编程语言,可在现代网页浏览器中运行。它提供接近原生的性能。WebAssembly System Interface (WASI) 是 WASM 的一个标准扩展,允许 WASM 程序在浏览器外运行,访问系统资源。这两项技术旨在提高 Web 应用性能,并使 WASM 在更多环境中可用。 而 WASM/WASI 技术路线核心的优势在于 跨平台的兼容性 多语言通过静态编译的支持 Native Sandbox 带来的安全性 所以 WASM/WASI 不仅在浏览器得到了广泛的应用， 现在其应用也逐渐扩展到了服务端。Serverless C...</div></div></div></a><a class=pagination-related href=/posts/2024/08/19/benchmark-for-python-web-framework-2024-part1-en/ title="In 2024, Gevent or asyncio? Part 1"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class=info-1><div class=info-item-1>Next</div><div class=info-item-2>In 2024, Gevent or asyncio? Part 1</div></div><div class=info-2><div class=info-item-1>The choice between Gevent and asyncio has always been a classic question. Here, we’ll use data to help you make a decision. IntroductionProfessor Lin Wei has set a high standard: This graph shows the extreme performance of asyncio and Gevent. We can see that asyncio with uvloop is basically double the performance of Gevent. But is this the case under web frameworks? Let’s conduct an experiment. First, let’s talk about the configuration of the load machine. I chose a D8as_v5 machine on Azure...</div></div></div></a></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class=relatedPosts-list><a class=pagination-related href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2025-04-26</div><div class=info-item-2>Python 3.14: Python 世界的一大步</div></div><div class=info-2><div class=info-item-1>Python 3.14 目前主要的一些主要的特性其实已经固定了，在我看来，Python 3.14 是一个未来很多年的一个核心版本。因为其确定了是时代的 Python调试生态的基准，这篇文章将会来聊聊这个 Python 世界中的史诗级改进 正文在我们日常调试 Python 代码的时候，我们经常会遇到这样一个问题，我们需要采样当前的 Python Runtime 的状态，进而进一步调试我们的 Python 进程 常见的手段莫过于两种 通过 eBPF + UProbe 等手段来触发 通过 process_vm_readv 等 Syscall 来直接整块读取内存 无论这两种方式都有一个核心的问题，我们怎么样来解析内存中的数据？ 用 https://github.com/jschwinger233/perf-examples/blob/main/cpython310_backtrace/bpf.c 来做一个例子，在之前的很多年的时候，我们会怎么做 123456789101112131415161718192021222324252627282930313233343536373839...</div></div></div></a><a class=pagination-related href=/posts/2024/02/10/CVE-2024-21626/ title="简单聊聊 CVE-2024-21626"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/08/15/10/sculpture-7776861_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2024-02-11</div><div class=info-item-2>简单聊聊 CVE-2024-21626</div></div><div class=info-2><div class=info-item-1>本来这篇文章应该在初一凌晨发的，但是拖延癌晚期，所以到现在才发，得反思下了 背景众所周知，容器逃逸并不是什么令人稀奇的问题了（不被逃逸的容器才是稀奇），2月初，runc 社区正式公布了一个船新的逃逸 CVE，参见 https://github.com/opencontainers/runc/security/advisories/GHSA-xr7r-f8xq-vfvv，版本横跨 1.0 到 1.1.11 这个 CVE 的核心特性在于“可以通过镜像分发的方式，成本很低的进行逃逸” 我们先来复现一下这个问题 我自己的环境是这样 看这篇博客的同学可以参考下面方式进行环境准备， 按照自己的发行版确保安装了，Docker, libseccomp, golang 按照下面方式进行环境安装 1234567891011git clone https://github.com/opencontainers/runcgit checkout v1.1.0-rc.1makesudo rm -rf $(which runc)sudo make installsudo systemctl rest...</div></div></div></a><a class=pagination-related href=/posts/2021/11/22/a-litte-introduction-about-nohdr-filed-in-skbuff/ title="聊聊 sk_buff 中一个冷门字段: nohdr"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2021-11-22</div><div class=info-item-2>聊聊 sk_buff 中一个冷门字段: nohdr</div></div><div class=info-2><div class=info-item-1>今天遇到一个很有意思的问题，“nohdr 字段到底有什么用”，在这里写个水文简单记录一下 正文前情提要首先来说，不管介绍再冷门的字段，既然涉及到 SKBUFF ，那么就得先来对 sk_buff 做个简单的介绍 简而言之，sk_buff 是 Linux 网络子系统的核心数据结构，从链路层到我们最终对数据包的操作，背后都离不开 sk_buff sk_buff 要完全讲解基本就相当于把 Linux 网络系统完全讲解了，所以讲完是不可能讲完的，这辈子都不可能的！ 简单聊几个关键，可能会帮助大家理解我们本文提到的冷门字段 nohdr 的关键字段吧 首先来讲，最重要的三个字段：data ，mac 和 nh ，分别代表着当前 sk_buff 的数据区的起始地址，L2 header 的起始地址，L3 Header 的起始地址。用一个图方便大家理解 看了图的同学可能会有点明白了，实际上在内核里，也是一层一层的通过指针偏移，不断的添加新的 header 来处理网络请求。和我们直觉相符。可能有同学会问，我既然知道 L3 Header 的起始地址，IP 之类的 L3 协议的 header 长度是固...</div></div></div></a><a class=pagination-related href=/posts/2023/08/26/a-little-bit-design-about-cpu-burst-in-k8s/ title="关于 CPU Burst 在 K8s 中的一些设计想法"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2023-08-27</div><div class=info-item-2>关于 CPU Burst 在 K8s 中的一些设计想法</div></div><div class=info-2><div class=info-item-1>深夜看群友聊的我实在焦虑，起来随便写个水文压压惊 正文写这篇文章的原因是之前给 runc 提的 CPU Burst 支持的 PR [Carry #3205] libct/cg: add CFS bandwidth burst for CPU 终于开始有了新的动静了，这次换了一个国人的 reviewer，感觉要是运气好能在9月开始合并这个 PR。 如果这个 PR 被合并了，那么在 containerd/nerdctl 等其余项目上支持 CPU Burst 的工作就可以开始了。所以这篇文章就是想记录下我对于 CPU Burst 在 Kubernetes 内实现的一些想法，差不多可以当作自己写正式的 KEP(Kubernetes Enhancement Proposal) 草稿 主要分为两个部分来聊一下 CPU Burst 的一些背景 目前 Kubernetes 对于 CPU 资源切分的设计概要 CPU Burst 在 Kubernetes 中的一些设计想法 CPU Burst 的一些背景聊 CPU Burst 之前必须要先聊一下 Linux 里面关于 CGroup 的一些背景知...</div></div></div></a><a class=pagination-related href=/posts/2023/08/22/a-little-bit-idea-about-unwind/ title=关于用户态栈回溯（Unwind）的一些杂记和想法><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2023-08-23</div><div class=info-item-2>关于用户态栈回溯（Unwind）的一些杂记和想法</div></div><div class=info-2><div class=info-item-1>随手记录一些关于用户态栈回溯（Unwind）的一些杂记和想法。 正文昨晚三点过刚吃完药躺在床上休息的时候，突然想到了 @yihong0618 的之前在群里的一个想法 我在想 eBPF 能不能 trace libpq 的协议，好像还没有人做过 我最开始的一个想法是 现在主流做法还是 ptrace 系的东西（gdb 那套），你要用 eBPF 去 trace libpq 肯定没问题，就和 Grey 用 uprobe 去 trace go 一样，手算 cast。但是这里另外一个问题是 libpq 的符号信息不一定够。我倾向你可以这样试一下，你改一下 libpq 源码，关键地方走 USDT（我看你之前用过） 不过后续我师父出来有了一个提醒 如果目标是 trace libpq.so 的调用情况，那应该目前就可以做到。.so 相比 executable 有几个优势： 它一定有动态符号表 它一定有 .eh_frameuprobe 恰好又是 attach to the binary offset 而不是 process address，所以第一个优势完美匹配 uprobe，甚至绕开了...</div></div></div></a><a class=pagination-related href=/posts/2021/08/24/a-little-problem-about-posix-node-js-execsync/ title="关于 Node.js 中 execSync 的一点问题"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg alt=cover><div class="info text-center"><div class=info-1><div class=info-item-1><i class="far fa-calendar-alt fa-fw"></i> 2021-08-24</div><div class=info-item-2>关于 Node.js 中 execSync 的一点问题</div></div><div class=info-2><div class=info-item-1>很久没写水文了，昨天帮人查了一个 Node.js 中 execSync 这个函数特殊行为的问题，很有趣，所以大概记录下来水一篇文章 背景首先老哥给了一张截图 首先基本问题可以抽象为在 Node.js 中利用 execSync 这个函数执行 ps -Af | grep -q -E -c &quot;\\-\\-user-data-dir=\\.+App&quot; 这样一条命令的时候，Node.js 时不时会报错。具体堆栈大概为 12345678910Uncaught Error: Command failed: ps -Af | grep -q -E -c &quot;\-\-user-data-dir=\.+App&quot; at checkExecSyncError (child_process.js:616:11) at Object.execSync (child_process.js:652:15) &#123; status: 1, signal: null, output: [ null, &lt;Buffer &gt;, &lt;Buffe...</div></div></div></a></div></div><hr class=custom-hr><div id=post-comment><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class=comment-wrap><div><div id=disqus_thread></div></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info text-center"><div class=avatar-img><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info-name>Manjusaka</div><div class=author-info-description>热忱之心不可磨灭</div><div class=site-data><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>104</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>60</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>41</div></a></div><a id=card-info-btn href=https://github.com/Zheaoli rel="external nofollow noreferrer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class=card-info-social-icons><a class=social-icon href=https://github.com/ZheaoLi rel="external nofollow noreferrer" target=_blank title=Github><i class="fab fa-github"></i></a><a class=social-icon href=mailto:me@manjusaka.me rel="external nofollow noreferrer" target=_blank title=Email><i class="fas fa-envelope"></i></a><a class=social-icon href=https://twitter.com/Manjusaka_Lee rel="external nofollow noreferrer" target=_blank title=推特><i class="fab fa-twitter"></i></a><a class=social-icon href=/atom.xml target=_blank title=RSS><i class="fa-solid fa-feed"></i></a></div></div><div class="card-widget card-announcement"><div class=item-headline><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class=announcement_content>This is my Blog</div></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>Contents</span><span class=toc-percentage></span></div><div class="toc-content is-expand"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BC%80%E7%AF%87><span class=toc-number>1.</span> <span class=toc-text>开篇</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-number>2.</span> <span class=toc-text>总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>Recent Posts</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/posts/2025/07/02/tail-call-in-3-14-interpreter-en/ title="Further Performance Evolution in Python 3.14: Tail Call Interpreter"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Further Performance Evolution in Python 3.14: Tail Call Interpreter"></a><div class=content><a class=title href=/posts/2025/07/02/tail-call-in-3-14-interpreter-en/ title="Further Performance Evolution in Python 3.14: Tail Call Interpreter">Further Performance Evolution in Python 3.14: Tail Call Interpreter</a><time datetime=2025-07-02T15:49:00.000Z title="Created 2025-07-02 23:49:00">2025-07-02</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/07/02/tail-call-in-3-14-interpreter/ title="Python 3.14 的进一步性能进化: Tail Call Interpreter"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Python 3.14 的进一步性能进化: Tail Call Interpreter"></a><div class=content><a class=title href=/posts/2025/07/02/tail-call-in-3-14-interpreter/ title="Python 3.14 的进一步性能进化: Tail Call Interpreter">Python 3.14 的进一步性能进化: Tail Call Interpreter</a><time datetime=2025-07-02T15:49:00.000Z title="Created 2025-07-02 23:49:00">2025-07-02</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Python 3.14: Python 世界的一大步"></a><div class=content><a class=title href=/posts/2025/04/26/3-14-is-one-of-the-best-python-version/ title="Python 3.14: Python 世界的一大步">Python 3.14: Python 世界的一大步</a><time datetime=2025-04-26T14:49:00.000Z title="Created 2025-04-26 22:49:00">2025-04-26</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/ title=简单聊聊常见的负载均衡算法><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=/images/pixai-1860500966642493859-3.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单聊聊常见的负载均衡算法></a><div class=content><a class=title href=/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/ title=简单聊聊常见的负载均衡算法>简单聊聊常见的负载均衡算法</a><time datetime=2025-03-23T12:00:00.000Z title="Created 2025-03-23 20:00:00">2025-03-23</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2025/02/03/a-little-thought-about-translation-about-yuru-camp/ title=简单吐槽一下摇曳露营的台配><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单吐槽一下摇曳露营的台配></a><div class=content><a class=title href=/posts/2025/02/03/a-little-thought-about-translation-about-yuru-camp/ title=简单吐槽一下摇曳露营的台配>简单吐槽一下摇曳露营的台配</a><time datetime=2025-02-03T18:00:00.000Z title="Created 2025-02-04 02:00:00">2025-02-04</time></div></div></div></div><div class="card-widget ads-wrap"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7962287588031867 data-ad-slot=1257383027 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id=footer><div class=footer-other><div class=footer-copyright><span class=copyright>&copy;&nbsp;2020 - 2025 By Manjusaka</span></div></div></footer></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title="Reading Mode"><i class="fas fa-book-open"></i></button><button id=translateLink type=button title="Toggle Between Traditional and Simplified Chinese">简</button><button id=darkmode type=button title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id=hide-aside-btn type=button title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id=rightside-config-show><button id=darkmode type=button title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id=translateLink type=button title="Toggle Between Traditional and Simplified Chinese">简</button><button id=readmode type=button title="Reading Mode"><i class="fas fa-book-open"></i></button><button id=go-up type=button title="Back to Top"><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src=https://www.manjusaka.blog/js/utils.js></script><script src=https://www.manjusaka.blog/js/main.js></script><script src=https://www.manjusaka.blog/js/tw_cn.js></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js></script><script src=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js></script><div class=js-pjax><script>(()=>{var e=()=>{var e;0!==(e=document.querySelectorAll("pre > code.mermaid")).length&&e.forEach(e=>{var t=document.createElement("pre"),d=(t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent,document.createElement("div"));d.className="mermaid-wrap",d.appendChild(t),e.parentNode.replaceWith(d)});let t=document.querySelectorAll("#article-container .mermaid-wrap");0!==t.length&&(e=()=>(e=>{window.loadMermaid=!0;document.documentElement.getAttribute("data-theme");e.forEach((e,t)=>{let d=e.firstElementChild;e=`%%{init:{ 'theme':'default'}}%%
`+d.textContent,t=mermaid.render("mermaid-"+t,e);let n=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof t?n(t):t.then(({svg:e})=>n(e))})})(t),btf.addGlobalFn("themeChange",e,"mermaid"),window.loadMermaid?e():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(e))};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{let s="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,o=e=>{window.DISQUS&&window.DISQUS.reset({reload:!0,config:e})};var e=(e,t)=>{s&&(window.shuoshuoComment.destroyDisqus=()=>{e.children.length&&(e.innerHTML="",e.classList.add("no-comment"))}),window.disqus_identifier=s?t:"/posts/2024/09/18/a-live-debug-ecapture-gh-604/",window.disqus_url=s?location.origin+t:"https://www.manjusaka.blog/posts/2024/09/18/a-live-debug-ecapture-gh-604/";function i(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title="Debug 日志：eCapture GH-604"}window.DISQUS?o(i):((t=document.createElement("script")).src="https://manjusakablog.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),document.head.appendChild(t)),btf.addGlobalFn("themeChange",()=>o(i),"disqus")};s?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script defer=defer id=fluttering_ribbon mobile=false src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js></script><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=algolia-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>Search</span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=search-wrap><div id=algolia-search-input></div><hr><div id=algolia-search-results><div id=algolia-hits></div><div id=algolia-pagination></div><div id=algolia-info><div class=algolia-stats></div><div class=algolia-poweredBy></div></div></div></div></div><div id=search-mask></div><script src=https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js></script><script src=https://www.manjusaka.blog/js/search/algolia.js></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var s=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),s.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/12/31/at-the-end-of-2024/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-12-31</span><a class="blog-slider__title" href="/posts/2024/12/31/at-the-end-of-2024/" alt="">本当の僕らをありがとう</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2024/12/31/at-the-end-of-2024/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-02-20</span><a class="blog-slider__title" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">简单聊聊奥特曼中很有趣的细节</a><div class="blog-slider__text">ヒーロが必要なんだよ，金城君。ヒーローが必要なんだ！</div><a class="blog-slider__button" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/29/per-aspera-ad-astra/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/01/30/19/40/gulls-7756481_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-29</span><a class="blog-slider__title" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">Per aspera, Ad astra</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-24</span><a class="blog-slider__title" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">开源可能没你想的那么难</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/Zheaoli/yuque-py/assets/7054676/ea9460a2-e351-4b73-9f82-7aef6cd20c33" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-25</span><a class="blog-slider__title" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">聊聊公益和助学</a><div class="blog-slider__text">很多时候，帮助人不需要那么多理由</div><a class="blog-slider__button" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-28</span><a class="blog-slider__title" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">家庭 Homelab 升级计划: v2</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://user-images.githubusercontent.com/7054676/228287041-c86e7928-0da8-4097-b7ff-e575faa8cf8c.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-19</span><a class="blog-slider__title" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">为什么奥特曼是我的信仰</a><div class="blog-slider__text">優しさを失わないでくれ。弱い者を労り互いに助け合い。</div><a class="blog-slider__button" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/16/how-do-I-build-homelab/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-16</span><a class="blog-slider__title" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">家庭 Homelab 升级计划</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer=defer src=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js></script><script defer=defer data-pjax src=https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js></script><script async src=//at.alicdn.com/t/font_2032782_8d5kxvn09md.js></script></body></html>
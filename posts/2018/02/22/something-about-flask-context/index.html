<!DOCTYPE html><html lang=en data-theme=auto><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Flask 中的 Context 初探 | Manjusaka</title><meta name=author content=Manjusaka><meta name=copyright content=Manjusaka><meta name=format-detection content="telephone=no"><meta name=theme-color content=ffffff><meta name=description content="Flask 中的 Context 初探大家新年好！鉴于今年春晚非常好看，我觉得承受不起，于是来写点辣鸡水文娱乐下大家，这也是之前立的若干 Flag 中的一个 正文做过 Flask 开发的朋友都知道 Flask 中存在着两个概念，一个叫 App Context , 一个叫 Request Context 。 这两个算是 Flask 中很独特的一种机制。 从一个 Flask App 读入配置并启动开始"><meta property=og:type content=article><meta property=og:title content="Flask 中的 Context 初探"><meta property=og:url content=https://www.manjusaka.blog/posts/2018/02/22/something-about-flask-context/index.html><meta property=og:site_name content=Manjusaka><meta property=og:description content="Flask 中的 Context 初探大家新年好！鉴于今年春晚非常好看，我觉得承受不起，于是来写点辣鸡水文娱乐下大家，这也是之前立的若干 Flag 中的一个 正文做过 Flask 开发的朋友都知道 Flask 中存在着两个概念，一个叫 App Context , 一个叫 Request Context 。 这两个算是 Flask 中很独特的一种机制。 从一个 Flask App 读入配置并启动开始"><meta property=og:locale content=en_US><meta property=og:image content=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg><meta property=article:published_time content=2018-02-22T18:54:20.000Z><meta property=article:modified_time content=2024-05-24T19:19:23.509Z><meta property=article:author content=Manjusaka><meta property=article:tag content=编程><meta property=article:tag content=Python><meta property=article:tag content=Flask><meta property=article:tag content=源码阅读><meta name=twitter:card content=summary><meta name=twitter:image content="https://avatars.githubusercontent.com/u/7054676?v=4"><meta name=twitter:creator content=@Manjusaka_Lee><meta name=twitter:site content=https://twitter.com/Manjusaka_Lee><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/7054676?v=4"><link rel=canonical href=https://www.manjusaka.blog/posts/2018/02/22/something-about-flask-context/index.html><link rel=preconnect href=//cdn.jsdelivr.net><link rel=preconnect href=//www.google-analytics.com crossorigin=""><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css media=print onload='this.media="all"'><script async=async src="https://www.googletagmanager.com/gtag/js?id=UA-154407994-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-154407994-1")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"DL1RURGHTB",indexName:"manjusaka.blog",hits:{per_page:6},languages:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}.",hits_stats:"${hits} results found in ${time} ms"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"It has been",messageNext:"days since the last update, the content of the article may be outdated."},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400},copy:{success:"Copy Successful",error:"Copy Error",noSupport:"Browser Not Supported"},relativeDate:{homepage:!0,post:!0},runtime:"days",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:{limitCount:100,languages:{author:"Author: Manjusaka",link:"Link: ",source:"Source: Manjusaka",info:"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},lightbox:"fancybox",Snackbar:{chs_to_cht:"You have switched to Traditional Chinese",cht_to_chs:"You have switched to Simplified Chinese",day_to_night:"You have switched to Dark Mode",night_to_day:"You have switched to Light Mode",bgLight:"#59C173",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!0,islazyload:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"Flask 中的 Context 初探",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-05-25 03:19:23"}</script><script>(e=>{e.saveToLocal={set:(e,t,a)=>{var o;0!==a&&(o=Date.now(),localStorage.setItem(e,JSON.stringify({value:t,expiry:o+864e5*a})))},get:e=>{var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!(Date.now()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=(o,c={})=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},Object.keys(c).forEach(e=>{a.setAttribute(e,c[e])}),document.head.appendChild(a)}),e.getCSS=(o,c=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,c&&(a.id=c),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};var e=saveToLocal.get("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,o=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!t&&!a&&!o,t=(void 0===e?(a?activateLightMode():t?activateDarkMode():(o||c)&&((a=(new Date).getHours())<=6||18<=a?activateDarkMode:activateLightMode)(),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode:activateLightMode)()})):("light"===e?activateLightMode:activateDarkMode)(),saveToLocal.get("aside-status"));void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css media=defer onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css media=defer onload='this.media="all"'><script src=https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js></script><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title=Manjusaka type=application/atom+xml></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>Loading...</div></div></div><script>(()=>{const d=document.getElementById("loading-box"),e=document.body,o={endLoading:()=>{e.style.overflow="",d.classList.add("loaded")},initLoading:()=>{e.style.overflow="hidden",d.classList.remove("loaded")}};o.initLoading(),window.addEventListener("load",()=>{o.endLoading()})})()</script><div id=web_bg></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='onerror=null,src="/img/friend_404.gif"' alt=avatar></div><div class="sidebar-site-data site-data is-center"><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>88</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>51</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>35</div></a></div><hr class=custom-hr><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div></div></div><div class=post id=body-wrap><header class=post-bg id=page-header style=background-image:url(https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg)><nav id=nav><span id=blog-info><a href=/ title=Manjusaka><img class=site-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4# image"><span class=site-name>Manjusaka</span></a></span><div id=menus><div id=search-button><a class="site-page social-icon search" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></li></ul></div><div class=menus_item><a class=site-page href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></div><div class=menus_item><a class=site-page href=/leetcode/ ><i class="fa-fw fas fa-newspaper"></i><span> 刷题</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/weekly/ ><i class="fa-fw fas fa-newspaper"></i><span> 周报</span></a></li></ul></div></div><div id=toggle-menu><a class=site-page href=javascript:void(0); rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id=post-info><h1 class=post-title>Flask 中的 Context 初探<a class=post-edit-link href=https://github.com/Zheaoli/Zheaoli.github.io/edit/main/source/_posts/something-about-flask-context.md rel="external nofollow noreferrer" title="Edited on" target=_blank><i class="fas fa-pencil-alt"></i></a></h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class=post-meta-label>Created</span><time datetime=2018-02-22T18:54:20.000Z title="Created 2018-02-23 02:54:20">2018-02-23</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/ >编程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E7%BC%96%E7%A8%8B/Python/ >Python</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>Word Count:</span><span class=word-count>3.4k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>Reading Time:</span><span>13mins</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title="Flask 中的 Context 初探"><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>Post Views:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class=post-content id=article-container><h1 id=Flask-中的-Context-初探><a href=#Flask-中的-Context-初探 class=headerlink title="Flask 中的 Context 初探"></a>Flask 中的 Context 初探</h1><p>大家新年好！鉴于今年春晚非常好看，我觉得承受不起，于是来写点辣鸡水文娱乐下大家，这也是之前立的若干 Flag 中的一个</p><h1 id=正文><a href=#正文 class=headerlink title=正文></a>正文</h1><p>做过 Flask 开发的朋友都知道 Flask 中存在着两个概念，一个叫 App Context , 一个叫 Request Context 。 这两个算是 Flask 中很独特的一种机制。</p><p>从一个 Flask App 读入配置并启动开始，就进入了 App Context，在其中我们可以访问配置文件、打开资源文件、通过路由规则反向构造 URL。当 WSGI Middleware 调用 Flask App 的时候开始，就进入了 Request Context 。我们可以获取到其中的 HTTP HEADER 等操作，同时也可以进行 SESSION 等操作。</p><p>不过作为辣鸡选手而言，经常分不清为什么会存在这两个 Context ，没事，我们慢慢来说一说。</p><span id=more></span><h2 id=预备知识><a href=#预备知识 class=headerlink title=预备知识></a>预备知识</h2><p>首先要清楚一点，我们要在同一个进程中隔离不同线程的数据，那么我们会优先选择 <code>threading.local</code> ，来实现数据彼此隔离的需求。但是现在有个问题来了，现在我们并发模型可能并不是只有传统意义上的<strong>进程-线程</strong>模型。也有可能是 <strong>coroutine(协程)</strong> 模型。常见的就是 Greenlet/Eventlet 。在这种情况下，<code>threading.local</code> 就没法很好的满足我们的需求。于是 <strong>Werkzeug</strong> 实现了自己的 Local 即 <code>werkzeug.local.Local</code></p><p>那么 <strong>Werkzeug</strong> 自己实现的 Local 和标准的 <code>threading.local</code> 相比有什么不同呢？我们记住最大的不同点在于</p><blockquote><p>前者会在 Greenlet 可用的情况下优先使用 Greenlet 的 ID 而不是线程 ID 以支持 Gevent 或 Eventlet 的调度，后者只支持多线程调度；</p></blockquote><p>Werkzeug 另外还实现了两种数据结构，一个叫 <code>LocalStack</code> ，一个叫做 <code>LocalProxy</code></p><p><code>LocalStack</code> 是基于 <code>Local</code> 实现的一个栈结构。栈的特性就是<strong>后入先出</strong>。当我们进入一个 Context 时，将当前的的对象推入栈中。然后我们也可以获取到栈顶元素。从而获取到当前的上下文信息。</p><p><code>LocalProxy</code> 是代理模式的一种实现。在实例化的时候，传入一个 <code>callable</code> 的参数。然后这个参数被调用后将会返回一个 <code>Local</code> 对象。我们后续的所有操作，比如属性调用，数值计算等，都会转发到这个参数返回的 <code>Local</code> 对象上。</p><p>现在大家可能不太清楚，我们为什么要用 LocalProxy 来进行操作，我们来给大家看一个例子</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>from</span> werkzeug.local <span class=keyword>import</span> LocalStack</span><br><span class=line>test_stack = LocalStack()</span><br><span class=line>test_stack.push(&#123;<span class=string>&#x27;abc&#x27;</span>: <span class=string>&#x27;123&#x27;</span>&#125;)</span><br><span class=line>test_stack.push(&#123;<span class=string>&#x27;abc&#x27;</span>: <span class=string>&#x27;1234&#x27;</span>&#125;)</span><br><span class=line></span><br><span class=line><span class=keyword>def</span> <span class="title function_">get_item</span>():</span><br><span class=line>    <span class=keyword>return</span> test_stack.pop()</span><br><span class=line></span><br><span class=line>item = get_item()</span><br><span class=line></span><br><span class=line><span class=built_in>print</span>(item[<span class=string>&#x27;abc&#x27;</span>])</span><br><span class=line><span class=built_in>print</span>(item[<span class=string>&#x27;abc&#x27;</span>])</span><br><span class=line></span><br></pre></td></tr></table></figure><p>你看我们这里的输出的的值，都是统一的 <code>1234</code> ，但是我们这里想做到的是每次获取的值都是栈顶的最新的元素，那么我们这个时候就应该用 proxy 模式了</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> werkzeug.local <span class=keyword>import</span> LocalStack, LocalProxy</span><br><span class=line>test_stack = LocalStack()</span><br><span class=line>test_stack.push(&#123;<span class=string>&#x27;abc&#x27;</span>: <span class=string>&#x27;123&#x27;</span>&#125;)</span><br><span class=line>test_stack.push(&#123;<span class=string>&#x27;abc&#x27;</span>: <span class=string>&#x27;1234&#x27;</span>&#125;)</span><br><span class=line></span><br><span class=line><span class=keyword>def</span> <span class="title function_">get_item</span>():</span><br><span class=line>    <span class=keyword>return</span> test_stack.pop()</span><br><span class=line></span><br><span class=line>item = LocalProxy(get_item)</span><br><span class=line></span><br><span class=line><span class=built_in>print</span>(item[<span class=string>&#x27;abc&#x27;</span>])</span><br><span class=line><span class=built_in>print</span>(item[<span class=string>&#x27;abc&#x27;</span>])</span><br><span class=line></span><br></pre></td></tr></table></figure><p>你看我们这里就是 Proxy 的妙用。</p><h2 id=Context><a href=#Context class=headerlink title=Context></a>Context</h2><p>由于 Flask 基于 Werkzeug 实现，因此 App Context 以及 Request Context 是基于前文中所说的 LocalStack 实现。</p><p>从命名上，大家应该可以看出，App Context 是代表应用上下文，可能包含各种配置信息，比如日志配置，数据库配置等。而 Request Context 代表一个请求上下文，我们可以获取到当前请求中的各种信息。比如 body 携带的信息。</p><p>这两个上下文的定义是在 <strong>flask.ctx</strong> 文件中，分别是 <code>AppContext</code> 以及 <code>RequestContext</code> 。而构建上下文的操作则是将其推入在 <strong>flask.globals</strong> 文件中定义的 <code>_app_ctx_stack</code> 以及 <code>_request_ctx_stack</code> 中。前面说了 LocalStack 是“线程”（这里可能是传统意义上的线程，也有可能是 Greenlet 这种）隔离的。同时 Flask 每个线程只处理一个请求，因此可以做到请求隔离。</p><p>当 <code>app = Flask(__name__)</code> 构造出一个 Flask App 时，App Context 并不会被自动推入 Stack 中。所以此时 Local Stack 的栈顶是空的，current_app 也是 unbound 状态。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>from</span> flask <span class=keyword>import</span> Flask</span><br><span class=line></span><br><span class=line><span class=keyword>from</span> flask.<span class=built_in>globals</span> <span class=keyword>import</span> _app_ctx_stack, _request_ctx_stack</span><br><span class=line></span><br><span class=line>app = Flask(__name__)</span><br><span class=line></span><br><span class=line>_app_ctx_stack.top</span><br><span class=line>_request_ctx_stack.top</span><br><span class=line>_app_ctx_stack()</span><br><span class=line><span class=comment># &lt;LocalProxy unbound&gt;</span></span><br><span class=line><span class=keyword>from</span> flask <span class=keyword>import</span> current_app</span><br><span class=line>current_app</span><br><span class=line><span class=comment># &lt;LocalProxy unbound&gt;</span></span><br></pre></td></tr></table></figure><p>作为 web 时，当请求进来时，我们开始进行上下文的相关操作。整个流程如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://user-images.githubusercontent.com/7054676/36314635-675c086c-1370-11e8-87f1-819cb9f5f299.png alt=image></p><p>好了现在有点问题：</p><ol><li><p>为什么要区分 App Context 以及 Request Context</p></li><li><p>为什么要用栈结构来实现 Context ？</p></li></ol><p>很久之前看过的松鼠奥利奥老师的博文<a target=_blank rel="noopener external nofollow noreferrer" href=https://blog.tonyseek.com/post/the-context-mechanism-of-flask/ >Flask 的 Context 机制</a> 解答了这个问题</p><blockquote><p>这两个做法给予我们 多个 Flask App 共存 和 非 Web Runtime 中灵活控制 Context 的可能性。</p><p>我们知道对一个 Flask App 调用 app.run() 之后，进程就进入阻塞模式并开始监听请求。此时是不可能再让另一个 Flask App 在主线程运行起来的。那么还有哪些场景需要多个 Flask App 共存呢？前面提到了，一个 Flask App 实例就是一个 WSGI Application，那么 WSGI Middleware 是允许使用组合模式的，比如：</p></blockquote><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>from</span> werkzeug.wsgi <span class=keyword>import</span> DispatcherMiddleware</span><br><span class=line><span class=keyword>from</span> biubiu.app <span class=keyword>import</span> create_app</span><br><span class=line><span class=keyword>from</span> biubiu.admin.app <span class=keyword>import</span> create_app <span class=keyword>as</span> create_admin_app</span><br><span class=line></span><br><span class=line>application = DispatcherMiddleware(create_app(), &#123;</span><br><span class=line>    <span class=string>&#x27;/admin&#x27;</span>: create_admin_app()</span><br><span class=line>&#125;)</span><br><span class=line></span><br></pre></td></tr></table></figure><p>奥利奥老师文中举了一个这样一个例子，Werkzeug 内置的 Middleware 将两个 Flask App 组合成一个一个 WSGI Application。这种情况下两个 App 都同时在运行，只是根据 URL 的不同而将请求分发到不同的 App 上处理。</p><p>但是现在很多朋友有个问题，就是为什么这里不用 Blueprint ？</p><ul><li><p>Blueprint 是在同一个 App 下运行。其挂在 App Context 上的相关信息都是一致的。但是如果要隔离彼此的信息的话，那么用 App Context 进行隔离，会比我们用变量名什么的隔离更为方便</p></li><li><p>Middleware 模式是 WSGI 中允许的特性，换句话来讲，我们将 Flask 和另外一个遵循 WSGI 协议的 web Framework （比如 Django）那么也是可行的。</p></li></ul><p>但是 Flask 的两种 Context 分离更大的意义是为了非 web 应用的场合。Flask 官方文档中有这样一段话</p><blockquote><p>The main reason for the application’s context existence is that in the past a bunch of functionality was attached to the request context for lack of a better solution. Since one of the pillars of Flask’s design is that you can have more than one application in the same Python process.</p></blockquote><p>这句话换句话说 App Context 存在的意义是针对一个进程中有多个 Flask App 场景，这样场景最常见的就是我们用 Flask 来做一些离线脚本的代码。</p><p>好了，我们来聊聊 Flask 非 Web 应用的场景</p><p>比如，我们有个插件叫 Flask-SQLAlchemy<br>然后这里有个使用场景<br>首先我们现在有这样一个代码</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> flask <span class=keyword>import</span> Flask</span><br><span class=line><span class=keyword>from</span> flask_sqlalchemy <span class=keyword>import</span> SQLAlchemy</span><br><span class=line></span><br><span class=line>database = Flask(__name__)</span><br><span class=line>database.config[<span class=string>&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class=string>&#x27;sqlite:////tmp/test.db&#x27;</span></span><br><span class=line>db = SQLAlchemy(database)</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">User</span>(db.Model):</span><br><span class=line>    <span class=built_in>id</span> = db.Column(db.Integer, primary_key=<span class=literal>True</span>)</span><br><span class=line>    username = db.Column(db.String(<span class=number>80</span>), unique=<span class=literal>True</span>, nullable=<span class=literal>False</span>)</span><br><span class=line>    email = db.Column(db.String(<span class=number>120</span>), unique=<span class=literal>True</span>, nullable=<span class=literal>False</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__repr__</span>(<span class=params>self</span>):</span><br><span class=line>        <span class=keyword>return</span> <span class=string>&#x27;&lt;User %r&gt;&#x27;</span> % self.username</span><br></pre></td></tr></table></figure><p>这里你应该注意到最开始的几个关键点，第一个，就是 <code>database.config</code> ，是的没错，Flask-SQLAlchemy 就是从当前的 app 中获取到对应的 config 信息来建立数据库链接。那么传递 app 的方式有两种，第一种，就是直接如上图一样，直接 db = SQLAlchemy(database) ，这个很容易理解，第二种，如果我们不传的话，那么 Flask-SQLAlchemy 中通过 current_app 来获取当前的 app 然后获取对应的 config 建立链接。<br>那么问题来了，为什么会存在第二种这种方法呢</p><p>给个场景吧，现在我两个数据库配置不同的 app 共用一个 Model 那么应该怎么做？其实很简单</p><p>首先写 一个 model 文件，比如就叫 data/user_model.py 吧</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> flask_sqlalchemy <span class=keyword>import</span> SQLAlchemy</span><br><span class=line>db = SQLAlchemy()</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">User</span>(db.Model):</span><br><span class=line>    <span class=built_in>id</span> = db.Column(db.Integer, primary_key=<span class=literal>True</span>)</span><br><span class=line>    username = db.Column(db.String(<span class=number>80</span>), unique=<span class=literal>True</span>, nullable=<span class=literal>False</span>)</span><br><span class=line>    email = db.Column(db.String(<span class=number>120</span>), unique=<span class=literal>True</span>, nullable=<span class=literal>False</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__repr__</span>(<span class=params>self</span>):</span><br><span class=line>        <span class=keyword>return</span> <span class=string>&#x27;&lt;User %r&gt;&#x27;</span> % self.username</span><br></pre></td></tr></table></figure><p>好了，那么在我们的应用文件中，我们便可以这样写</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> data.user_model <span class=keyword>import</span> User</span><br><span class=line>database = Flask(__name__)</span><br><span class=line>database.config[<span class=string>&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class=string>&#x27;sqlite:////tmp/test.db&#x27;</span></span><br><span class=line><span class=keyword>with</span> database.app_context():</span><br><span class=line>    db.init_app(current_app)</span><br><span class=line>    db.create_all()</span><br><span class=line>    admin = User(username=<span class=string>&#x27;admin&#x27;</span>, email=<span class=string>&#x27;admin@example.com&#x27;</span>)</span><br><span class=line>    db.session.add(admin)</span><br><span class=line>    db.session.commit()</span><br><span class=line>    <span class=built_in>print</span>(User.query.filter_by(username=<span class=string>&quot;admin&quot;</span>).first())</span><br><span class=line></span><br><span class=line>database1 = Flask(__name__)</span><br><span class=line>database1.config[<span class=string>&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class=string>&#x27;sqlite:////tmp/test1.db&#x27;</span></span><br><span class=line><span class=keyword>with</span> database1.app_context():</span><br><span class=line>    db.init_app(current_app)</span><br><span class=line>    db.create_all()</span><br><span class=line>    admin = User(username=<span class=string>&#x27;admin_test&#x27;</span>, email=<span class=string>&#x27;admin@example.com&#x27;</span>)</span><br><span class=line>    db.session.add(admin)</span><br><span class=line>    db.session.commit()</span><br><span class=line>    <span class=built_in>print</span>(User.query.filter_by(username=<span class=string>&quot;admin&quot;</span>).first())</span><br></pre></td></tr></table></figure><p>你看这样是不是就好懂了一些，通过 app context ，我们 Flask-SQLAlchemy 可以通过 current_app 来获取当前 app ，继而获取相关的 config 信息</p><p>这个例子还不够妥当，我们现在再来换一个例子</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> flask <span class=keyword>import</span> Flask, current_app</span><br><span class=line><span class=keyword>import</span> logging</span><br><span class=line></span><br><span class=line>app = Flask(<span class=string>&quot;app1&quot;</span>)</span><br><span class=line>app2 = Flask(<span class=string>&quot;app2&quot;</span>)</span><br><span class=line></span><br><span class=line>app.config.logger = logging.getLogger(<span class=string>&quot;app1.logger&quot;</span>)</span><br><span class=line>app2.config.logger = logging.getLogger(<span class=string>&quot;app2.logger&quot;</span>)</span><br><span class=line></span><br><span class=line>app.logger.addHandler(logging.FileHandler(<span class=string>&quot;app_log.txt&quot;</span>))</span><br><span class=line>app2.logger.addHandler(logging.FileHandler(<span class=string>&quot;app2_log.txt&quot;</span>))</span><br><span class=line></span><br><span class=line><span class=keyword>with</span> app.app_context():</span><br><span class=line>    <span class=keyword>with</span> app2.app_context():</span><br><span class=line>        <span class=keyword>try</span>:</span><br><span class=line>            <span class=keyword>raise</span> ValueError(<span class=string>&quot;app2 error&quot;</span>)</span><br><span class=line>        <span class=keyword>except</span> Exception <span class=keyword>as</span> e:</span><br><span class=line>            current_app.config.logger.exception(e)</span><br><span class=line>    <span class=keyword>try</span>:</span><br><span class=line>        <span class=keyword>raise</span> ValueError(<span class=string>&quot;app1 error&quot;</span>)</span><br><span class=line>    <span class=keyword>except</span> Exception <span class=keyword>as</span> e:</span><br><span class=line>        current_app.config.logger.exception(e)</span><br></pre></td></tr></table></figure><p>好了，这段代码很清晰了，含义很清晰，就是通过获取当前上下文中的 app 中的 logger 来输出日志。同时这段代码也很清晰的说明了，我们为什么要用栈这样一种数据结构来维护上下文。</p><p>首先看一下 <code>app_context()</code> 的源码</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>def</span> <span class="title function_">app_context</span>(<span class=params>self</span>):</span><br><span class=line>    <span class=string>&quot;&quot;&quot;Binds the application only.  For as long as the application is bound</span></span><br><span class=line><span class=string>    to the current context the :data:`flask.current_app` points to that</span></span><br><span class=line><span class=string>    application.  An application context is automatically created when a</span></span><br><span class=line><span class=string>    request context is pushed if necessary.</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>    Example usage::</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>        with app.app_context():</span></span><br><span class=line><span class=string>            ...</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>    .. versionadded:: 0.9</span></span><br><span class=line><span class=string>    &quot;&quot;&quot;</span></span><br><span class=line>    <span class=keyword>return</span> AppContext(self)</span><br></pre></td></tr></table></figure><p>嗯，很简单，只是构建一个 AppContext 对象返回，然后我们看看相关的代码</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">AppContext</span>(<span class="title class_ inherited__">object</span>):</span><br><span class=line>    <span class=string>&quot;&quot;&quot;The application context binds an application object implicitly</span></span><br><span class=line><span class=string>    to the current thread or greenlet, similar to how the</span></span><br><span class=line><span class=string>    :class:`RequestContext` binds request information.  The application</span></span><br><span class=line><span class=string>    context is also implicitly created if a request context is created</span></span><br><span class=line><span class=string>    but the application is not on top of the individual application</span></span><br><span class=line><span class=string>    context.</span></span><br><span class=line><span class=string>    &quot;&quot;&quot;</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__init__</span>(<span class=params>self, app</span>):</span><br><span class=line>        self.app = app</span><br><span class=line>        self.url_adapter = app.create_url_adapter(<span class=literal>None</span>)</span><br><span class=line>        self.g = app.app_ctx_globals_class()</span><br><span class=line></span><br><span class=line>        <span class=comment># Like request context, app contexts can be pushed multiple times</span></span><br><span class=line>        <span class=comment># but there a basic &quot;refcount&quot; is enough to track them.</span></span><br><span class=line>        self._refcnt = <span class=number>0</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">push</span>(<span class=params>self</span>):</span><br><span class=line>        <span class=string>&quot;&quot;&quot;Binds the app context to the current context.&quot;&quot;&quot;</span></span><br><span class=line>        self._refcnt += <span class=number>1</span></span><br><span class=line>        <span class=keyword>if</span> <span class=built_in>hasattr</span>(sys, <span class=string>&#x27;exc_clear&#x27;</span>):</span><br><span class=line>            sys.exc_clear()</span><br><span class=line>        _app_ctx_stack.push(self)</span><br><span class=line>        appcontext_pushed.send(self.app)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">pop</span>(<span class=params>self, exc=_sentinel</span>):</span><br><span class=line>        <span class=string>&quot;&quot;&quot;Pops the app context.&quot;&quot;&quot;</span></span><br><span class=line>        <span class=keyword>try</span>:</span><br><span class=line>            self._refcnt -= <span class=number>1</span></span><br><span class=line>            <span class=keyword>if</span> self._refcnt &lt;= <span class=number>0</span>:</span><br><span class=line>                <span class=keyword>if</span> exc <span class=keyword>is</span> _sentinel:</span><br><span class=line>                    exc = sys.exc_info()[<span class=number>1</span>]</span><br><span class=line>                self.app.do_teardown_appcontext(exc)</span><br><span class=line>        <span class=keyword>finally</span>:</span><br><span class=line>            rv = _app_ctx_stack.pop()</span><br><span class=line>        <span class=keyword>assert</span> rv <span class=keyword>is</span> self, <span class=string>&#x27;Popped wrong app context.  (%r instead of %r)&#x27;</span> \</span><br><span class=line>            % (rv, self)</span><br><span class=line>        appcontext_popped.send(self.app)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__enter__</span>(<span class=params>self</span>):</span><br><span class=line>        self.push()</span><br><span class=line>        <span class=keyword>return</span> self</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__exit__</span>(<span class=params>self, exc_type, exc_value, tb</span>):</span><br><span class=line>        self.pop(exc_value)</span><br><span class=line></span><br><span class=line>        <span class=keyword>if</span> BROKEN_PYPY_CTXMGR_EXIT <span class=keyword>and</span> exc_type <span class=keyword>is</span> <span class=keyword>not</span> <span class=literal>None</span>:</span><br><span class=line>            reraise(exc_type, exc_value, tb)</span><br></pre></td></tr></table></figure><p>emmmm，首先 <code>push</code> 方法就是将自己推入 <code>_app_ctx_stack</code> ，而 <code>pop</code> 方法则是将自己从栈顶推出。然后我们看到两个方法含义就很明确了，在进入上下文管理器的时候，将自己推入栈，然后退出上下文管理器的时候，将自己推出。</p><p>我们都知道栈的一个性质就是，后入先出，栈顶的永远是最新插入进去的元素。而看一下我们 <code>current_app</code> 的源码</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>def</span> <span class="title function_">_find_app</span>():</span><br><span class=line>    top = _app_ctx_stack.top</span><br><span class=line>    <span class=keyword>if</span> top <span class=keyword>is</span> <span class=literal>None</span>:</span><br><span class=line>        <span class=keyword>raise</span> RuntimeError(_app_ctx_err_msg)</span><br><span class=line>    <span class=keyword>return</span> top.app</span><br><span class=line>    </span><br><span class=line>current_app = LocalProxy(_find_app)</span><br><span class=line></span><br></pre></td></tr></table></figure><p>嗯，很明了了，就是获取当前栈顶的元素，然后进行相关操作。</p><p>嗯，通过这样对于栈的不断操作，就能让 <code>current_app</code> 获取到元素是我们当前上下文中的 app 。</p><h2 id=额外的讲解-g><a href=#额外的讲解-g class=headerlink title="额外的讲解: g"></a>额外的讲解: g</h2><p>g 也是我们常用的几个全局变量之一。在最开始这个变量是挂载在 Request Context 下的。但是在 0.10 以后，g 就是挂载在 App Context 下的。可能有同学不太清楚为什么要这么做。</p><p>首先，说一下 g 用来干什么</p><p>官方在上下文这一张里有这一段说明</p><blockquote><p>The application context is created and destroyed as necessary. It never moves between threads and it will not be shared between requests. As such it is the perfect place to store database connection information and other things. The internal stack object is called flask._app_ctx_stack. Extensions are free to store additional information on the topmost level, assuming they pick a sufficiently unique name and should put their information there, instead of on the flask.g object which is reserved for user code.</p></blockquote><p>大意就是说，数据库配置和其余的重要配置信息，就挂载 App 对象上。但是如果是一些用户代码，比如你不想一层层函数传数据的话，然后有一些变量需要传递，那么可以挂在 g 上。</p><p>同时前面说了，Flask 并不仅仅可以当做一个 Web Framework 使用，同时也可以用于一些非 web 的场合下。在这种情况下，如果 g 是属于 Request Context 的话，那么我们要使用 g 的话，那么就需要手动构建一个请求，这无疑是不合理的。</p><h2 id=最后><a href=#最后 class=headerlink title=最后></a>最后</h2><p>大年三十写这篇文章，现在发出来，我的辣鸡也是无人可救了。Flask 的上下文机制是其最重要的特性之一。通过合理的利用上下文机制，我们可以再更多的场合下去更好的利用 flask 。嗯，本次的辣鸡文章写作活动就到此结束吧。希望大家不会扔我臭鸡蛋！然后新年快乐！</p></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class=post-copyright-info><a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/Zheaoli>Manjusaka</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class=post-copyright-info><a href=https://www.manjusaka.blog/posts/2018/02/22/something-about-flask-context/ >https://www.manjusaka.blog/posts/2018/02/22/something-about-flask-context/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class=post-copyright-info>All articles in this blog are licensed under <a target=_blank rel="noopener external nofollow noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/%E7%BC%96%E7%A8%8B/ >编程</a><a class=post-meta__tags href=/tags/Python/ >Python</a><a class=post-meta__tags href=/tags/Flask/ >Flask</a><a class=post-meta__tags href=/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/ >源码阅读</a></div><div class=post_share><div class=social-share data-image=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js defer=defer></script></div></div><div class=ads-wrap><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-7962287588031867 data-ad-slot=2542544532></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class=pagination-post id=pagination><div class="prev-post pull-left"><a href=/posts/2018/02/22/logging-process-safe/ title="日常辣鸡水文:关于 logging 的进程安全问题"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class=pagination-info><div class=label>Previous</div><div class=prev_info>日常辣鸡水文:关于 logging 的进程安全问题</div></div></a></div><div class="next-post pull-right"><a href=/posts/2017/12/28/what-the-fuck-supvisor/ title="Supervisor 的一个隐藏坑"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class=pagination-info><div class=label>Next</div><div class=next_info>Supervisor 的一个隐藏坑</div></div></a></div></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class=relatedPosts-list><div><a href=/posts/2018/02/22/a-little-idea-about-sanic/ title="日常辣鸡水文:一个关于 Sanic 的小问题的思考"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2018-02-23</div><div class=title>日常辣鸡水文:一个关于 Sanic 的小问题的思考</div></div></a></div><div><a href=/posts/2018/02/22/logging-process-safe/ title="日常辣鸡水文:关于 logging 的进程安全问题"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2018-02-23</div><div class=title>日常辣鸡水文:关于 logging 的进程安全问题</div></div></a></div><div><a href=/posts/2016/08/09/reading-the-fucking-flask-source-code-Part1/ title="菜鸟阅读 Flask 源码系列（1）：Flask的router初探"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/16/46/sea-7772372_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2016-08-09</div><div class=title>菜鸟阅读 Flask 源码系列（1）：Flask的router初探</div></div></a></div><div><a href=/posts/2018/02/22/something-about-decorator/ title="怎么样去理解 Python 中的装饰器"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2018-02-23</div><div class=title>怎么样去理解 Python 中的装饰器</div></div></a></div><div><a href=/posts/2017/08/13/what-the-fuck-about-flask-part1/ title="你所不知道的 Flask Part1:Route 初探"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2017-08-13</div><div class=title>你所不知道的 Flask Part1:Route 初探</div></div></a></div><div><a href=/posts/2018/02/22/why-i-dont-recommend-sanic/ title="Sanic 的若干吐槽"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2018-02-23</div><div class=title>Sanic 的若干吐槽</div></div></a></div></div></div><hr class=custom-hr><div id=post-comment><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class=comment-wrap><div><div id=disqus_thread></div></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=is-center><div class=avatar-img><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/7054676?v=4" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info__name>Manjusaka</div><div class=author-info__description>热忱之心不可磨灭</div></div><div class="card-info-data site-data is-center"><a href=/archives/ ><div class=headline>Articles</div><div class=length-num>88</div></a><a href=/tags/ ><div class=headline>Tags</div><div class=length-num>51</div></a><a href=/categories/ ><div class=headline>Categories</div><div class=length-num>35</div></a></div><a id=card-info-btn target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/Zheaoli><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class=social-icon href=https://github.com/ZheaoLi rel="external nofollow noreferrer" target=_blank title=Github><i class="fab fa-github"></i></a><a class=social-icon href=mailto:me@manjusaka.me rel="external nofollow noreferrer" target=_blank title=Email><i class="fas fa-envelope"></i></a><a class=social-icon href=https://twitter.com/Manjusaka_Lee rel="external nofollow noreferrer" target=_blank title=推特><i class="fab fa-twitter"></i></a><a class=social-icon href=/atom.xml target=_blank title=RSS><i class="fa-solid fa-feed"></i></a></div></div><div class="card-widget card-announcement"><div class=item-headline><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class=announcement_content>This is my Blog</div></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>Contents</span><span class=toc-percentage></span></div><div class="toc-content is-expand"><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#Flask-%E4%B8%AD%E7%9A%84-Context-%E5%88%9D%E6%8E%A2><span class=toc-number>1.</span> <span class=toc-text>Flask 中的 Context 初探</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E6%AD%A3%E6%96%87><span class=toc-number>2.</span> <span class=toc-text>正文</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86><span class=toc-number>2.1.</span> <span class=toc-text>预备知识</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Context><span class=toc-number>2.2.</span> <span class=toc-text>Context</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%A2%9D%E5%A4%96%E7%9A%84%E8%AE%B2%E8%A7%A3-g><span class=toc-number>2.3.</span> <span class=toc-text>额外的讲解: g</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9C%80%E5%90%8E><span class=toc-number>2.4.</span> <span class=toc-text>最后</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>Recent Post</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/posts/2024/05/24/a-tour-to-make-a-nes-simulator-nametable-caculate/ title="实现 NES 中的一些笔记：nametable 的 mirror 计算"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="实现 NES 中的一些笔记：nametable 的 mirror 计算"></a><div class=content><a class=title href=/posts/2024/05/24/a-tour-to-make-a-nes-simulator-nametable-caculate/ title="实现 NES 中的一些笔记：nametable 的 mirror 计算">实现 NES 中的一些笔记：nametable 的 mirror 计算</a><time datetime=2024-05-24T17:00:00.000Z title="Created 2024-05-25 01:00:00">2024-05-25</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2024/05/11/where-are-my-package/ title="SRE 日志：我的包去哪了？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="SRE 日志：我的包去哪了？"></a><div class=content><a class=title href=/posts/2024/05/11/where-are-my-package/ title="SRE 日志：我的包去哪了？">SRE 日志：我的包去哪了？</a><time datetime=2024-05-11T17:00:00.000Z title="Created 2024-05-12 01:00:00">2024-05-12</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2024/02/20/a-simple-discussion-about-the-ultraman/ title=简单聊聊奥特曼中很有趣的细节><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt=简单聊聊奥特曼中很有趣的细节></a><div class=content><a class=title href=/posts/2024/02/20/a-simple-discussion-about-the-ultraman/ title=简单聊聊奥特曼中很有趣的细节>简单聊聊奥特曼中很有趣的细节</a><time datetime=2024-02-20T09:00:00.000Z title="Created 2024-02-20 17:00:00">2024-02-20</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2024/02/10/CVE-2024-21626/ title="简单聊聊 CVE-2024-21626"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="简单聊聊 CVE-2024-21626"></a><div class=content><a class=title href=/posts/2024/02/10/CVE-2024-21626/ title="简单聊聊 CVE-2024-21626">简单聊聊 CVE-2024-21626</a><time datetime=2024-02-10T20:00:00.000Z title="Created 2024-02-11 04:00:00">2024-02-11</time></div></div><div class=aside-list-item><a class=thumbnail href=/posts/2024/01/03/a-simple-introduction-about-python-jit/ title="简单聊聊 Python 3.13 的 JIT 方案"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="简单聊聊 Python 3.13 的 JIT 方案"></a><div class=content><a class=title href=/posts/2024/01/03/a-simple-introduction-about-python-jit/ title="简单聊聊 Python 3.13 的 JIT 方案">简单聊聊 Python 3.13 的 JIT 方案</a><time datetime=2024-01-03T18:30:00.000Z title="Created 2024-01-04 02:30:00">2024-01-04</time></div></div></div></div><div class="card-widget ads-wrap"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7962287588031867 data-ad-slot=1257383027 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id=footer style="background:0 0"><div id=footer-wrap><div class=copyright>&copy;2020 - 2024 By Manjusaka</div><div class=framework-info><span>Framework </span><a target=_blank rel="noopener external nofollow noreferrer" href=https://hexo.io>Hexo</a><span class=footer-separator>|</span><span>Theme </span><a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/jerryc127/hexo-theme-butterfly>Butterfly</a></div></div></footer></div><div id=rightside><div id=rightside-config-hide></div><div id=rightside-config-show><button id=darkmode type=button title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id=translateLink type=button title="Toggle Between Traditional Chinese And Simplified Chinese">简</button><button id=readmode type=button title="Read Mode"><i class="fas fa-book-open"></i></button><button id=go-up type=button title="Back To Top"><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src=https://www.manjusaka.blog/js/utils.js></script><script src=https://www.manjusaka.blog/js/main.js></script><script src=https://www.manjusaka.blog/js/tw_cn.js></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js></script><script src=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class=js-pjax><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0!==e.length){const n=()=>{window.loadMermaid=!0;const r="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach((e,t)=>{const n=e.firstElementChild;e="%%{init:{ 'theme':'"+r+"'}}%%\n"+n.textContent;const d=mermaid.render("mermaid-"+t,e);"string"==typeof d?(t=d,n.insertAdjacentHTML("afterend",t)):d.then(({svg:e})=>{n.insertAdjacentHTML("afterend",e)})})};var t=()=>{window.loadMermaid?n():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(n)};btf.addGlobalFn("themeChange",n,"mermaid"),window.pjax?t():document.addEventListener("DOMContentLoaded",t)}})()</script><script>(()=>{function t(){this.page.url="https://www.manjusaka.blog/posts/2018/02/22/something-about-flask-context/",this.page.identifier="/posts/2018/02/22/something-about-flask-context/",this.page.title="Flask 中的 Context 初探"}const e=()=>{window.DISQUS&&window.DISQUS.reset({reload:!0,config:t})};btf.addGlobalFn("themeChange",e,"disqus");var a=()=>{var t;window.DISQUS?e():((t=document.createElement("script")).src="https://manjusakablog.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),document.head.appendChild(t))};a()})()</script></div><script defer=defer id=fluttering_ribbon mobile=false src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js></script><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=algolia-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>Search</span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=search-wrap><div id=algolia-search-input></div><hr><div id=algolia-search-results><div id=algolia-hits></div><div id=algolia-pagination></div><div id=algolia-info><div class=algolia-stats></div><div class=algolia-poweredBy></div></div></div></div></div><div id=search-mask></div><script src=https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js></script><script src=https://www.manjusaka.blog/js/search/algolia.js></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var s=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),s.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/06/01/14/superb-fairywren-7770904_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-02-20</span><a class="blog-slider__title" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">简单聊聊奥特曼中很有趣的细节</a><div class="blog-slider__text">ヒーロが必要なんだよ，金城君。ヒーローが必要なんだ！</div><a class="blog-slider__button" href="/posts/2024/02/20/a-simple-discussion-about-the-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/29/per-aspera-ad-astra/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-29</span><a class="blog-slider__title" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">Per aspera, Ad astra</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/12/29/per-aspera-ad-astra/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-24</span><a class="blog-slider__title" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">开源可能没你想的那么难</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="/posts/2023/10/24/open-source-is-simple-than-you-think/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/Zheaoli/yuque-py/assets/7054676/ea9460a2-e351-4b73-9f82-7aef6cd20c33" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-25</span><a class="blog-slider__title" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">聊聊公益和助学</a><div class="blog-slider__text">很多时候，帮助人不需要那么多理由</div><a class="blog-slider__button" href="/posts/2023/06/25/love-and-hope-is-all-we-need/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-12-28</span><a class="blog-slider__title" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">家庭 Homelab 升级计划: v2</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/12/28/how-do-I-build-homelab-part2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://user-images.githubusercontent.com/7054676/228287041-c86e7928-0da8-4097-b7ff-e575faa8cf8c.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-19</span><a class="blog-slider__title" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">为什么奥特曼是我的信仰</a><div class="blog-slider__text">優しさを失わないでくれ。弱い者を労り互いに助け合い。</div><a class="blog-slider__button" href="/posts/2023/06/19/why-do-I-love-ultraman/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="/posts/2023/06/16/how-do-I-build-homelab/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/50/daisy-7766609_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-16</span><a class="blog-slider__title" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">家庭 Homelab 升级计划</a><div class="blog-slider__text">人生嘛，Homelab 图个乐子</div><a class="blog-slider__button" href="/posts/2023/06/16/how-do-I-build-homelab/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer=defer src=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js></script><script defer=defer data-pjax src=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js></script><script async src=//at.alicdn.com/t/font_2032782_8d5kxvn09md.js></script></body></html>
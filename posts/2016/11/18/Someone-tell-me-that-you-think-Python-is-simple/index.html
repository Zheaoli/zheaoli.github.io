<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>听说你会 Python ？ - Manjusaka</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Manjusaka"><meta name="msapplication-TileImage" content="https://user-images.githubusercontent.com/7054676/56820343-2fe1b580-687e-11e9-8f6f-778df3a8eafd.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Manjusaka"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="前言最近觉得 Python 太“简单了”，于是在师父川爷面前放肆了一把：“我觉得 Python 是世界上最简单的语言！”。于是川爷嘴角闪过了一丝轻蔑的微笑（内心 OS：Naive！，作为一个 Python 开发者，我必须要给你一点人生经验，不然你不知道天高地厚！）于是川爷给我了一份满分 100 分的题，然后这篇文章就是记录下做这套题所踩过的坑。"><meta property="og:type" content="blog"><meta property="og:title" content="听说你会 Python ？"><meta property="og:url" content="http://manjusaka.itscoder.com/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/"><meta property="og:site_name" content="Manjusaka"><meta property="og:description" content="前言最近觉得 Python 太“简单了”，于是在师父川爷面前放肆了一把：“我觉得 Python 是世界上最简单的语言！”。于是川爷嘴角闪过了一丝轻蔑的微笑（内心 OS：Naive！，作为一个 Python 开发者，我必须要给你一点人生经验，不然你不知道天高地厚！）于是川爷给我了一份满分 100 分的题，然后这篇文章就是记录下做这套题所踩过的坑。"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://manjusaka.itscoder.com/img/og_image.png"><meta property="article:published_time" content="2016-11-18T14:37:43.000Z"><meta property="article:modified_time" content="2022-03-06T12:08:02.856Z"><meta property="article:author" content="Manjusaka"><meta property="article:tag" content="Python"><meta property="article:tag" content="编程"><meta property="article:tag" content="黑魔法"><meta property="article:tag" content="编程技巧"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://manjusaka.itscoder.com/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/"},"headline":"听说你会 Python ？","image":["http://manjusaka.itscoder.com/img/og_image.png"],"datePublished":"2016-11-18T14:37:43.000Z","dateModified":"2022-03-06T12:08:02.856Z","author":{"@type":"Person","name":"Manjusaka"},"publisher":{"@type":"Organization","name":"Manjusaka","logo":{"@type":"ImageObject","url":"https://user-images.githubusercontent.com/7054676/56820277-0a54ac00-687e-11e9-9f34-f79089938638.png"}},"description":"前言最近觉得 Python 太“简单了”，于是在师父川爷面前放肆了一把：“我觉得 Python 是世界上最简单的语言！”。于是川爷嘴角闪过了一丝轻蔑的微笑（内心 OS：Naive！，作为一个 Python 开发者，我必须要给你一点人生经验，不然你不知道天高地厚！）于是川爷给我了一份满分 100 分的题，然后这篇文章就是记录下做这套题所踩过的坑。"}</script><link rel="canonical" href="http://manjusaka.itscoder.com/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/"><link rel="icon" href="https://user-images.githubusercontent.com/7054676/56820343-2fe1b580-687e-11e9-8f6f-778df3a8eafd.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?56ca085ae4b8a4667f041cdd04856321";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-154407994-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-154407994-1');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Manjusaka" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://user-images.githubusercontent.com/7054676/56820277-0a54ac00-687e-11e9-9f34-f79089938638.png" alt="Manjusaka" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/.">主页</a><a class="navbar-item" href="/archives">文章</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/atom.xml">订阅</a><a class="navbar-item" href="/weekly">周报</a><a class="navbar-item" href="/resume">我的简历</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Zheaoli"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-11-18T14:37:43.000Z" title="11/18/2016, 2:37:43 PM">2016-11-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-03-06T12:08:02.856Z" title="3/6/2022, 12:08:02 PM">2022-03-06</time></span><span class="level-item"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a><span> / </span><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B/Python/">Python</a></span><span class="level-item">23 minutes read (About 3392 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">听说你会 Python ？</h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近觉得 Python 太“简单了”，于是在师父川爷面前放肆了一把：“我觉得 Python 是世界上最简单的语言！”。于是川爷嘴角闪过了一丝轻蔑的微笑（内心 OS：Naive！，作为一个 Python 开发者，我必须要给你一点人生经验，不然你不知道天高地厚！）于是川爷给我了一份满分 100 分的题，然后这篇文章就是记录下做这套题所踩过的坑。</p>
<span id="more"></span>

<h2 id="1-列表生成器"><a href="#1-列表生成器" class="headerlink" title="1.列表生成器"></a>1.列表生成器</h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>下面的代码会报错，为什么？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    gen = (x <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">10</span>))  <span class="comment"># gen=(x for _ in range(10))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">list</span>(A.gen))</span><br></pre></td></tr></table></figure>

<h3 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h3><p>这个问题是变量作用域问题，在 <code>gen=(x for _ in xrange(10))</code> 中 <code>gen</code> 是一个 <code>generator</code> ,在 <code>generator</code> 中变量有自己的一套作用域，与其余作用域空间相互隔离。因此，将会出现这样的 <code>NameError: name &#39;x&#39; is not defined</code> 的问题，那么解决方案是什么呢？答案是：用 lambda 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    gen = (<span class="keyword">lambda</span> x: (x <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">10</span>)))(x)  <span class="comment"># gen=(x for _ in range(10))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">list</span>(A.gen))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或者这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    gen = (A.x <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">10</span>))  <span class="comment"># gen=(x for _ in range(10))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">list</span>(A.gen))</span><br></pre></td></tr></table></figure>

<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>感谢评论区几位提出的意见，这里我给一份官方文档的说明吧：<br>The scope of names defined in a class block is limited to the class block; it does not extend to the code blocks of methods – this includes comprehensions and generator expressions since they are implemented using a function scope. This means that the following will fail:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    a = <span class="number">42</span></span><br><span class="line">    b = <span class="built_in">list</span>(a + i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br></pre></td></tr></table></figure>

<p>参考链接 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/executionmodel.html#naming-and-binding">Python2 Execution-Model:Naming-and-Binding</a> ， <a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/executionmodel.html#resolution-of-name">Python3 Execution-Model:Resolution-of-Names</a>。据说这是 PEP 227 中新增的提案，我回去会进一步详细考证。再次拜谢评论区 @没头脑很着急 @涂伟忠 @Cholerae 三位的勘误指正。</p>
<h2 id="2-装饰器"><a href="#2-装饰器" class="headerlink" title="2.装饰器"></a>2.装饰器</h2><h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>我想写一个类装饰器用来度量函数/方法运行时间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Timeit</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func</span>):</span><br><span class="line">        self._wrapped = func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kws</span>):</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        result = self._wrapped(*args, **kws)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;elapsed time is %s &quot;</span> % (time.time() - start_time))</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>这个装饰器能够运行在普通函数上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Timeit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;invoking function func&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    func()  <span class="comment"># output: elapsed time is 1.00044410133</span></span><br></pre></td></tr></table></figure>

<p>但是运行在方法上会报错，为什么？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @Timeit</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;invoking method func&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = A()</span><br><span class="line">    a.func()  <span class="comment"># Boom!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果我坚持使用类装饰器，应该如何修改？</p>
<h3 id="答案-1"><a href="#答案-1" class="headerlink" title="答案"></a>答案</h3><p>使用类装饰器后，在调用 <code>func</code> 函数的过程中其对应的 instance 并不会传递给 <code>__call__</code> 方法，造成其 <code>mehtod unbound</code> ,那么解决方法是什么呢？描述符赛高</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timeit</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func</span>):</span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;invoking Timer&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">lambda</span> *args, **kwargs: self.func(instance, *args, **kwargs)</span><br></pre></td></tr></table></figure>

<h2 id="3-Python-调用机制"><a href="#3-Python-调用机制" class="headerlink" title="3.Python 调用机制"></a>3.Python 调用机制</h2><h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>我们知道 <code>__call__</code> 方法可以用来重载圆括号调用，好的，以为问题就这么简单？Naive！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;invoking __call__ from A!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    a = A()</span><br><span class="line">    a()  <span class="comment"># output: invoking __call__ from A</span></span><br></pre></td></tr></table></figure>

<p>现在我们可以看到 <code>a()</code> 似乎等价于 <code>a.__call__()</code> ,看起来很 Easy 对吧，好的，我现在想作死，又写出了如下的代码，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a.__call__ = <span class="keyword">lambda</span>: <span class="string">&quot;invoking __call__ from lambda&quot;</span></span><br><span class="line">a.__call__()</span><br><span class="line"><span class="comment"># output:invoking __call__ from lambda</span></span><br><span class="line">a()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># output:invoking __call__ from A!</span></span><br></pre></td></tr></table></figure>

<p>请大佬们解释下，为什么 <code>a()</code> 没有调用出 <code>a.__call__()</code> (此题由 USTC 王子博前辈提出)</p>
<h3 id="答案-2"><a href="#答案-2" class="headerlink" title="答案"></a>答案</h3><p>原因在于，在 Python 中，新式类（ new class )的内建特殊方法，和实例的属性字典是相互隔离的，具体可以看看 Python 官方<a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/datamodel.html#special-method-lookup-for-new-style-classes">文档</a>对于这一情况的说明</p>
<blockquote>
<p>For new-style classes, implicit invocations of special methods are only guaranteed to work correctly if defined on an object’s type, not in the object’s instance dictionary. That behaviour is the reason why the following code raises an exception (unlike the equivalent example with old-style classes):</p>
</blockquote>
<p>同时官方也给出了一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = C()</span><br><span class="line">c.__len__ = <span class="keyword">lambda</span>: <span class="number">5</span></span><br><span class="line"><span class="built_in">len</span>(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment">#  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span></span><br><span class="line"><span class="comment"># TypeError: object of type &#x27;C&#x27; has no len()</span></span><br></pre></td></tr></table></figure>

<p>回到我们的例子上来，当我们在执行 <code>a.__call__=lambda:&quot;invoking __call__ from lambda&quot;</code> 时，的确在我们在 <code>a.__dict__</code> 中新增加了一个 key 为 <code>__call__</code> 的 item，但是当我们执行 <code>a()</code> 时，因为涉及特殊方法的调用，因此我们的调用过程不会从 <code>a.__dict__</code> 中寻找属性，而是从 <code>tyee(a).__dict__</code> 中寻找属性。因此，就会出现如上所述的情况。</p>
<h2 id="4-描述符"><a href="#4-描述符" class="headerlink" title="4.描述符"></a>4.描述符</h2><h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>我想写一个 Exam 类，其属性 math 为 [0,100] 的整数，若赋值时不在此范围内则抛出异常，我决定用描述符来实现这个需求。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grade</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> self._score</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            self._score = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;grade must be between 0 and 100&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exam</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    math = Grade()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, math</span>):</span><br><span class="line">        self.math = math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    niche = Exam(math=<span class="number">90</span>)</span><br><span class="line">    <span class="built_in">print</span>(niche.math)</span><br><span class="line">    <span class="comment"># output : 90</span></span><br><span class="line">    snake = Exam(math=<span class="number">75</span>)</span><br><span class="line">    <span class="built_in">print</span>(snake.math)</span><br><span class="line">    <span class="comment"># output : 75</span></span><br><span class="line">    snake.math = <span class="number">120</span></span><br><span class="line">    <span class="comment"># output: ValueError:grade must be between 0 and 100!</span></span><br></pre></td></tr></table></figure>
<p>看起来一切正常。不过这里面有个巨大的问题，尝试说明是什么问题<br>为了解决这个问题，我改写了 Grade 描述符如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grad</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._grade_pool = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> self._grade_pool.get(instance, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            _grade_pool = self.__dict__.setdefault(<span class="string">&#x27;_grade_pool&#x27;</span>, &#123;&#125;)</span><br><span class="line">            _grade_pool[instance] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;fuck&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>不过这样会导致更大的问题，请问该怎么解决这个问题？</p>
<h3 id="答案-3"><a href="#答案-3" class="headerlink" title="答案"></a>答案</h3><p>1.第一个问题的其实很简单，如果你再运行一次 <code>print(niche.math)</code> 你就会发现，输出值是 <code>75</code> ，那么这是为什么呢？这就要先从 Python 的调用机制说起了。我们如果调用一个属性，那么其顺序是优先从实例的 <code>__dict__</code> 里查找，然后如果没有查找到的话，那么一次查询类字典，父类字典，直到彻底查不到为止。好的，现在回到我们的问题，我们发现，在我们的类 <code>Exam</code> 中，其 <code>self.math</code> 的调用过程是，首先在实例化后的实例的 <code>__dict__</code> 中进行查找，没有找到，接着往上一级，在我们的类 <code>Exam</code> 中进行查找，好的找到了，返回。那么这意味着，我们对于 <code>self.math</code> 的所有操作都是对于类变量 <code>math</code> 的操作。因此造成变量污染的问题。那么该则怎么解决呢？很多同志可能会说，恩，在 <code>__set__</code> 函数中将值设置到具体的实例字典不就行了。<br>那么这样可不可以呢？答案是，很明显不得行啊，至于为什么，就涉及到我们 Python 描述符的机制了，描述符指的是实现了描述符协议的特殊的类，三个描述符协议指的是 <code>__get__</code> , ‘<strong>set</strong>‘ , <code>__delete__</code>  以及 Python 3.6 中新增的 <code>__set_name__</code> 方法，其中实现了 <code>__get__</code> 以及 <code>__set__</code> / <code>__delete__</code> / <code>__set_name__</code> 的是 <strong>Data descriptors</strong> ，而只实现了 <code>__get__</code> 的是 <code>Non-Data descriptor</code> 。那么有什么区别呢，前面说了， <strong>我们如果调用一个属性，那么其顺序是优先从实例的 <code>__dict__</code> 里查找，然后如果没有查找到的话，那么一次查询类字典，父类字典，直到彻底查不到为止。</strong> 但是，这里没有考虑描述符的因素进去，如果将描述符因素考虑进去，那么正确的表述应该是<strong>我们如果调用一个属性，那么其顺序是优先从实例的 <code>__dict__</code> 里查找，然后如果没有查找到的话，那么一次查询类字典，父类字典，直到彻底查不到为止。其中如果在类实例字典中的该属性是一个 <code>Data descriptors</code> ，那么无论实例字典中存在该属性与否，无条件走描述符协议进行调用，在类实例字典中的该属性是一个 <code>Non-Data descriptors</code> ，那么优先调用实例字典中的属性值而不触发描述符协议，如果实例字典中不存在该属性值，那么触发 <code>Non-Data descriptor</code> 的描述符协议</strong>。回到之前的问题，我们即使在 <code>__set__</code> 将具体的属性写入实例字典中，但是由于类字典中存在着 <code>Data descriptors</code> ，因此，我们在调用 <code>math</code> 属性时，依旧会触发描述符协议。</p>
<p>2.经过改良的做法，利用 <code>dict</code> 的 key 唯一性，将具体的值与实例进行绑定，但是同时带来了内存泄露的问题。那么为什么会造成内存泄露呢，首先复习下我们的 <code>dict</code> 的特性，<code>dict</code> 最重要的一个特性，就是凡可 hash 的对象皆可为 key ，<code>dict</code> 通过利用的 hash 值的唯一性（严格意义上来讲并不是唯一，而是其 hash 值碰撞几率极小，近似认定其唯一）来保证 key 的不重复性，同时（敲黑板，重点来了），<code>dict</code> 中的 <code>key</code> 引用是强引用类型，会造成对应对象的引用计数的增加，可能造成对象无法被 gc ，从而产生内存泄露。那么这里该怎么解决呢？两种方法<br>第一种：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grad</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> weakref</span><br><span class="line">        self._grade_pool = weakref.WeakKeyDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> self._grade_pool.get(instance, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            _grade_pool = self.__dict__.setdefault(<span class="string">&#x27;_grade_pool&#x27;</span>, &#123;&#125;)</span><br><span class="line">            _grade_pool[instance] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;fuck&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>weakref 库中的 <code>WeakKeyDictionary</code> 所产生的字典的 key 对于对象的引用是弱引用类型，其不会造成内存引用计数的增加，因此不会造成内存泄露。同理，如果我们为了避免 value 对于对象的强引用，我们可以使用 <code>WeakValueDictionary</code> 。<br>第二种：在 Python 3.6 中，实现的 PEP 487 提案，为描述符新增加了一个协议，我们可以用其来绑定对应的对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grad</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            instance.__dict__[self.key] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;fuck&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set_name__</span>(<span class="params">self, owner, name</span>):</span><br><span class="line">        self.key = name</span><br></pre></td></tr></table></figure>

<p>这道题涉及的东西比较多，这里给出一点参考链接，<a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/datamodel.html#invoking-descriptors">invoking-descriptors</a> , <a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/descriptor.html">Descriptor HowTo Guide</a> , <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0487/">PEP 487</a> , [what`s new in Python 3.6](<a target="_blank" rel="noopener" href="https://docs.python.org/3.6/whatsnew/3.6.html#pep-487-descriptor-protocol-enhancements">https://docs.python.org/3.6/whatsnew/3.6.html#pep-487-descriptor-protocol-enhancements</a>) 。</p>
<h2 id="5-Python-继承机制"><a href="#5-Python-继承机制" class="headerlink" title="5.Python 继承机制"></a>5.Python 继承机制</h2><h3 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h3><p>试求出以下代码的输出结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Init</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        self.val = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add2</span>(<span class="title class_ inherited__">Init</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="built_in">super</span>(Add2, self).__init__(val)</span><br><span class="line">        self.val += <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mul5</span>(<span class="title class_ inherited__">Init</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="built_in">super</span>(Mul5, self).__init__(val)</span><br><span class="line">        self.val *= <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pro</span>(Mul5, Add2):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Incr</span>(<span class="title class_ inherited__">Pro</span>):</span><br><span class="line">    csup = <span class="built_in">super</span>(Pro)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        self.csup.__init__(val)</span><br><span class="line">        self.val += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Incr(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(p.val)</span><br></pre></td></tr></table></figure>

<h3 id="答案-4"><a href="#答案-4" class="headerlink" title="答案"></a>答案</h3><p>输出是 36 ，具体可以参考 <a target="_blank" rel="noopener" href="https://www.python.org/doc/newstyle/">New-style Classes</a> , <a target="_blank" rel="noopener" href="https://docs.python.org/2/tutorial/classes.html#multiple-inheritance">multiple-inheritance</a></p>
<h2 id="6-Python-特殊方法"><a href="#6-Python-特殊方法" class="headerlink" title="6. Python 特殊方法"></a>6. Python 特殊方法</h2><h3 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h3><p>我写了一个通过重载 <strong>new</strong> 方法来实现单例模式的类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance:</span><br><span class="line">            <span class="keyword">return</span> cls._instance</span><br><span class="line">        cls._isntance = cv = <span class="built_in">object</span>.__new__(cls, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sin1 = Singleton()</span><br><span class="line">sin2 = Singleton()</span><br><span class="line"><span class="built_in">print</span>(sin1 <span class="keyword">is</span> sin2)</span><br><span class="line"><span class="comment"># output: True</span></span><br></pre></td></tr></table></figure>

<p>现在我有一堆类要实现为单例模式，所以我打算照葫芦画瓢写一个元类，这样可以让代码复用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingleMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">cls, name, bases, <span class="built_in">dict</span></span>):</span><br><span class="line">        cls._instance = <span class="literal">None</span></span><br><span class="line">        __new__o = cls.__new__</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">if</span> cls._instance:</span><br><span class="line">                <span class="keyword">return</span> cls._instance</span><br><span class="line">            cls._instance = cv = __new__o(cls, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> cv</span><br><span class="line"></span><br><span class="line">        cls.__new__ = __new__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __metaclass__ = SingleMeta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a1 = A()  <span class="comment"># what`s the fuck</span></span><br></pre></td></tr></table></figure>

<p>哎呀，好气啊，为啥这会报错啊，我明明之前用这种方法给 <code>__getattribute__</code> 打补丁的，下面这段代码能够捕获一切属性调用并打印参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TraceAttribute</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">cls, name, bases, <span class="built_in">dict</span></span>):</span><br><span class="line">        __getattribute__o = cls.__getattribute__</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__getattribute__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;__getattribute__:&#x27;</span>, args, kwargs)</span><br><span class="line">            <span class="keyword">return</span> __getattribute__o(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        cls.__getattribute__ = __getattribute__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):  <span class="comment"># Python 3 是 class A(object,metaclass=TraceAttribute):</span></span><br><span class="line">    __metaclass__ = TraceAttribute</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.a</span><br><span class="line"><span class="comment"># output: __getattribute__:(&#x27;a&#x27;,)&#123;&#125;</span></span><br><span class="line">a.b</span><br></pre></td></tr></table></figure>
<p>试解释为什么给 <strong>getattribute</strong> 打补丁成功，而 <strong>new</strong> 打补丁失败。<br>如果我坚持使用元类给 <strong>new</strong> 打补丁来实现单例模式，应该怎么修改？</p>
<h3 id="答案-5"><a href="#答案-5" class="headerlink" title="答案"></a>答案</h3><p>其实这是最气人的一点，类里的 <code>__new__</code> 是一个 <code>staticmethod</code> 因此替换的时候必须以 <code>staticmethod</code> 进行替换。答案如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingleMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">cls, name, bases, <span class="built_in">dict</span></span>):</span><br><span class="line">        cls._instance = <span class="literal">None</span></span><br><span class="line">        __new__o = cls.__new__</span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">if</span> cls._instance:</span><br><span class="line">                <span class="keyword">return</span> cls._instance</span><br><span class="line">            cls._instance = cv = __new__o(cls, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> cv</span><br><span class="line"></span><br><span class="line">        cls.__new__ = __new__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __metaclass__ = SingleMeta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A() <span class="keyword">is</span> A())  <span class="comment"># output: True</span></span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>感谢师父大人的一套题让我开启新世界的大门，恩，博客上没法艾特，只能传递心意了。说实话 Python 的动态特性可以让其用众多 <code>black magic</code> 去实现一些很舒服的功能，当然这也对我们对语言特性及坑的掌握也变得更严格了，愿各位 Pythoner 没事阅读官方文档，早日达到<strong>装逼如风，常伴吾身</strong>的境界。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>听说你会 Python ？</p><p><a href="http://manjusaka.itscoder.com/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/">http://manjusaka.itscoder.com/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Manjusaka</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2016-11-18</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-03-06</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a><a class="link-muted mr-2" rel="tag" href="/tags/%E7%BC%96%E7%A8%8B/">编程</a><a class="link-muted mr-2" rel="tag" href="/tags/%E9%BB%91%E9%AD%94%E6%B3%95/">黑魔法</a><a class="link-muted mr-2" rel="tag" href="/tags/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/">编程技巧</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61fe2890d7b259001917a0b2&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/2016/12/15/A-Simple-Object-Model/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">用 Python 实现一个最简单的对象模型</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/2016/10/25/Declarative-API-Design-in-Swift/"><span class="level-item">Swift 声明式程序设计</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://manjusaka.itscoder.com/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/';
            this.page.identifier = '/posts/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'manjusakablog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://user-images.githubusercontent.com/7054676/56820343-2fe1b580-687e-11e9-8f6f-778df3a8eafd.png" alt="Manjusaka"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Manjusaka</p><p class="is-size-6 is-block">Stay simple &amp;&amp; Stay Naive</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">63</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">28</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">46</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Zheaoli"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Manjusaka_Lee"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Telegram" href="https://t.me/ManjusakaL"><i class="fab fa-telegram"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前言"><span class="level-left"><span class="level-item">1</span><span class="level-item">前言</span></span></a></li><li><a class="level is-mobile" href="#1-列表生成器"><span class="level-left"><span class="level-item">2</span><span class="level-item">1.列表生成器</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#描述"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">描述</span></span></a></li><li><a class="level is-mobile" href="#答案"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">答案</span></span></a></li><li><a class="level is-mobile" href="#补充"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">补充</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2-装饰器"><span class="level-left"><span class="level-item">3</span><span class="level-item">2.装饰器</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#描述-1"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">描述</span></span></a></li><li><a class="level is-mobile" href="#答案-1"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">答案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3-Python-调用机制"><span class="level-left"><span class="level-item">4</span><span class="level-item">3.Python 调用机制</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#描述-2"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">描述</span></span></a></li><li><a class="level is-mobile" href="#答案-2"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">答案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#4-描述符"><span class="level-left"><span class="level-item">5</span><span class="level-item">4.描述符</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#描述-3"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">描述</span></span></a></li><li><a class="level is-mobile" href="#答案-3"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">答案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#5-Python-继承机制"><span class="level-left"><span class="level-item">6</span><span class="level-item">5.Python 继承机制</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#描述-4"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">描述</span></span></a></li><li><a class="level is-mobile" href="#答案-4"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">答案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#6-Python-特殊方法"><span class="level-left"><span class="level-item">7</span><span class="level-item">6. Python 特殊方法</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#描述-5"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">描述</span></span></a></li><li><a class="level is-mobile" href="#答案-5"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">答案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#结语"><span class="level-left"><span class="level-item">8</span><span class="level-item">结语</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://pythonhunter.org/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">捕蛇者说</span></span><span class="level-right"><span class="level-item tag">pythonhunter.org</span></span></a></li><li><a class="level is-mobile" href="https://laike9m.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">laike9m&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">laike9m.com</span></span></a></li><li><a class="level is-mobile" href="https://darkof.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Adam Wen&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">darkof.me</span></span></a></li><li><a class="level is-mobile" href="https://www.kawabangga.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">卡瓦邦噶</span></span><span class="level-right"><span class="level-item tag">www.kawabangga.com</span></span></a></li><li><a class="level is-mobile" href="http://ice1000.org/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">千里冰封</span></span><span class="level-right"><span class="level-item tag">ice1000.org</span></span></a></li><li><a class="level is-mobile" href="https://leiysky.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leiysky</span></span><span class="level-right"><span class="level-item tag">leiysky.github.io</span></span></a></li><li><a class="level is-mobile" href="https://xuanwo.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">漩涡的博客</span></span><span class="level-right"><span class="level-item tag">xuanwo.io</span></span></a></li><li><a class="level is-mobile" href="http://jaeger.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">写代码的猴子</span></span><span class="level-right"><span class="level-item tag">jaeger.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="https://www.kilerd.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">你好，耳先生</span></span><span class="level-right"><span class="level-item tag">www.kilerd.me</span></span></a></li><li><a class="level is-mobile" href="http://brucezz.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">小天</span></span><span class="level-right"><span class="level-item tag">brucezz.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://yongyu.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">用语</span></span><span class="level-right"><span class="level-item tag">yongyu.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://showzeng.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">showzeng</span></span><span class="level-right"><span class="level-item tag">showzeng.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://extremej.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">extremej</span></span><span class="level-right"><span class="level-item tag">extremej.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://melodyxxx.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">melodyxxx</span></span><span class="level-right"><span class="level-item tag">melodyxxx.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://melo.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">melo</span></span><span class="level-right"><span class="level-item tag">melo.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://hymane.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">hymane</span></span><span class="level-right"><span class="level-item tag">hymane.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://imxie.itscoder.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">imxie</span></span><span class="level-right"><span class="level-item tag">imxie.itscoder.com</span></span></a></li><li><a class="level is-mobile" href="http://www.iamlj.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Jing&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">www.iamlj.com</span></span></a></li><li><a class="level is-mobile" href="https://xiaxichen.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">夏溪辰</span></span><span class="level-right"><span class="level-item tag">xiaxichen.com</span></span></a></li><li><a class="level is-mobile" href="https://ymkiux.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ymkiux</span></span><span class="level-right"><span class="level-item tag">ymkiux.github.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E7%94%9F/"><span class="level-start"><span class="level-item">人生</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E7%94%9F/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E9%97%B4%E4%B8%96/"><span class="level-start"><span class="level-item">人间世</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/%E8%BE%93%E5%85%A5%E6%B3%95/"><span class="level-start"><span class="level-item">输入法</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/%E8%BE%93%E5%85%A5%E6%B3%95/Rime/"><span class="level-start"><span class="level-item">Rime</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/"><span class="level-start"><span class="level-item">生活</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81/"><span class="level-start"><span class="level-item">电子产品</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%A4%BE%E4%BC%9A/"><span class="level-start"><span class="level-item">社会</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%A4%BE%E4%BC%9A/PKU/"><span class="level-start"><span class="level-item">PKU</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">编程</span></span><span class="level-end"><span class="level-item tag">50</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Linux/Kernel/"><span class="level-start"><span class="level-item">Kernel</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/PEP484/"><span class="level-start"><span class="level-item">PEP484</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/leetcode/"><span class="level-start"><span class="level-item">leetcode</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/leetcode/%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">刷题</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E6%B0%B4%E6%96%87/"><span class="level-start"><span class="level-item">水文</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E6%B0%B4%E6%96%87/%E8%AE%BA%E6%96%87/"><span class="level-start"><span class="level-item">论文</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">网络编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E7%BF%BB%E8%AF%91/"><span class="level-start"><span class="level-item">翻译</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E9%9A%8F%E6%83%B3/"><span class="level-start"><span class="level-item">随想</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/"><span class="level-start"><span class="level-item">总结</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/%E7%A7%80%E6%81%A9%E7%88%B1/"><span class="level-start"><span class="level-item">秀恩爱</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E7%94%9F/"><span class="level-start"><span class="level-item">人生</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E7%94%9F/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E9%97%B4%E4%B8%96/"><span class="level-start"><span class="level-item">人间世</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/%E8%BE%93%E5%85%A5%E6%B3%95/"><span class="level-start"><span class="level-item">输入法</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/%E8%BE%93%E5%85%A5%E6%B3%95/Rime/"><span class="level-start"><span class="level-item">Rime</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/"><span class="level-start"><span class="level-item">生活</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81/"><span class="level-start"><span class="level-item">电子产品</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%A4%BE%E4%BC%9A/"><span class="level-start"><span class="level-item">社会</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%A4%BE%E4%BC%9A/PKU/"><span class="level-start"><span class="level-item">PKU</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">编程</span></span><span class="level-end"><span class="level-item tag">50</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Linux/Kernel/"><span class="level-start"><span class="level-item">Kernel</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/PEP484/"><span class="level-start"><span class="level-item">PEP484</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/Python/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/leetcode/"><span class="level-start"><span class="level-item">leetcode</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/leetcode/%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">刷题</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E6%B0%B4%E6%96%87/"><span class="level-start"><span class="level-item">水文</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E6%B0%B4%E6%96%87/%E8%AE%BA%E6%96%87/"><span class="level-start"><span class="level-item">论文</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">网络编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E7%BF%BB%E8%AF%91/"><span class="level-start"><span class="level-item">翻译</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B/%E9%9A%8F%E6%83%B3/"><span class="level-start"><span class="level-item">随想</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/"><span class="level-start"><span class="level-item">总结</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/%E6%80%BB%E7%BB%93/%E7%A7%80%E6%81%A9%E7%88%B1/"><span class="level-start"><span class="level-item">秀恩爱</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">July 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/02/"><span class="level-start"><span class="level-item">February 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">December 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">November 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">October 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">September 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">August 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/07/"><span class="level-start"><span class="level-item">July 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Apple/"><span class="tag">Apple</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Flask/"><span class="tag">Flask</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Node-js/"><span class="tag">Node.js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Objective-C/"><span class="tag">Objective-C</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PEP/"><span class="tag">PEP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PEP484/"><span class="tag">PEP484</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PKU/"><span class="tag">PKU</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">26</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SystemTap/"><span class="tag">SystemTap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unix/"><span class="tag">Unix</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/async/"><span class="tag">async</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/eBPF/"><span class="tag">eBPF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leetcode/"><span class="tag">leetcode</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"><span class="tag">云原生</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F/"><span class="tag">人生</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E9%97%B4%E4%B8%96/"><span class="tag">人间世</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"><span class="tag">分布式</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%B7%E9%A2%98/"><span class="tag">刷题</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%8F%E7%A8%8B/"><span class="tag">协程</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%90%90%E6%A7%BD/"><span class="tag">吐槽</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/"><span class="tag">工具</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="tag">并发编程</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%80%BB%E7%BB%93/"><span class="tag">总结</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%98%E9%87%91%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92/"><span class="tag">掘金翻译计划</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%AE%B0/"><span class="tag">杂记</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B0%B4%E6%96%87/"><span class="tag">水文</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><span class="tag">源码剖析</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><span class="tag">源码阅读</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81/"><span class="tag">电子产品</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A4%BE%E4%BC%9A/"><span class="tag">社会</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A7%80%E6%81%A9%E7%88%B1/"><span class="tag">秀恩爱</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AC%94%E8%AE%B0/"><span class="tag">笔记</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B/"><span class="tag">编程</span><span class="tag">49</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/"><span class="tag">编程技巧</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="tag">网络编程</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BA%E6%96%87/"><span class="tag">论文</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AF%84%E6%B5%8B/"><span class="tag">评测</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BE%93%E5%85%A5%E6%B3%95/"><span class="tag">输入法</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E6%83%B3/"><span class="tag">随想</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E7%AC%94/"><span class="tag">随笔</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%BB%91%E9%AD%94%E6%B3%95/"><span class="tag">黑魔法</span><span class="tag">2</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://user-images.githubusercontent.com/7054676/56820277-0a54ac00-687e-11e9-9f34-f79089938638.png" alt="Manjusaka" height="28"></a><p class="is-size-7"><span>&copy; 2022 Manjusaka</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Zheaoli/manjusaka-blog"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>